var LeaferUI=function(t){"use strict";const e={imageSuffix:"leaf"},s={},i={RUNTIME:"runtime",LEAF:"leaf",TASK:"task",CNAVAS:"canvas",IMAGE:"image",types:{},create(t){const{types:e}=r;return e[t]?e[t]++:(e[t]=1,0)}},r=i,n={within:(t,e,s)=>(t<e&&(t=e),t>s&&(t=s),t),fourNumber(t){let e,s,i,r;if(t instanceof Array)switch(t.length){case 4:return t;case 2:e=i=t[0],s=r=t[1];break;case 3:e=t[0],s=r=t[1],i=t[2];break;case 1:t=t[0];break;default:t=0}return void 0===e?[t,t,t,t]:[e,s,i,r]},formatRotation:(t,e)=>(t%=360,e?t<0&&(t+=360):(t>180&&(t-=360),t<-180&&(t+=360)),t),getGapRotation(t,e){if(e>1){const s=Math.abs(t%e);(s<1||s>e-1)&&(t=Math.round(t/e)*e)}return t},formatSkew:t=>n.within(t,-90,90)},o=Math.PI/180,a=2*Math.PI,h=Math.PI/2,{sin:l,cos:d,acos:c,atan:u,sqrt:_,PI:p}=Math,g={};function f(){return{a:1,b:0,c:0,d:1,e:0,f:0}}const y={defaultMatrix:{a:1,b:0,c:0,d:1,e:0,f:0},tempMatrix:{},set(t,e=1,s=0,i=0,r=1,n=0,o=0){t.a=e,t.b=s,t.c=i,t.d=r,t.e=n,t.f=o},get:f,copy(t,e){t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t.e=e.e,t.f=e.f},translate(t,e,s){t.e+=e,t.f+=s},translateInner(t,e,s){t.e+=t.a*e+t.c*s,t.f+=t.b*e+t.d*s},scale(t,e,s=e){t.a*=e,t.b*=e,t.c*=s,t.d*=s},scaleOfOuter(t,e,s,i=s){v.toInnerPoint(t,e,g),v.scaleOfInner(t,g,s,i)},scaleOfInner(t,e,s,i=s){v.translateInner(t,e.x,e.y),v.scale(t,s,i),v.translateInner(t,-e.x,-e.y)},rotate(t,e){const s=d(e*=o),i=l(e),{a:r,b:n,c:a,d:h}=t;t.a=r*s-n*i,t.b=r*i+n*s,t.c=a*s-h*i,t.d=a*i+h*s},rotateOfOuter(t,e,s){v.toInnerPoint(t,e,g),v.rotateOfInner(t,g,s)},rotateOfInner(t,e,s){v.translateInner(t,e.x,e.y),v.rotate(t,s),v.translateInner(t,-e.x,-e.y)},skew(t,e,s){const{a:i,b:r,c:n,d:a}=t;s&&(s*=o,t.a=i+n*s,t.b=r+a*s),e&&(e*=o,t.c=n+i*e,t.d=a+r*e)},skewOfOuter(t,e,s,i){v.toInnerPoint(t,e,g),v.skewOfInner(t,g,s,i)},skewOfInner(t,e,s,i){v.translateInner(t,e.x,e.y),v.skew(t,s,i),v.translateInner(t,-e.x,-e.y)},multiply(t,e){const{a:s,b:i,c:r,d:n,e:o,f:a}=t;t.a=e.a*s+e.b*r,t.b=e.a*i+e.b*n,t.c=e.c*s+e.d*r,t.d=e.c*i+e.d*n,t.e=e.e*s+e.f*r+o,t.f=e.e*i+e.f*n+a},preMultiply(t,e){const{a:s,b:i,c:r,d:n,e:o,f:a}=t;1===e.a&&0===e.b&&0===e.c&&1===e.d||(t.a=s*e.a+i*e.c,t.b=s*e.b+i*e.d,t.c=r*e.a+n*e.c,t.d=r*e.b+n*e.d),t.e=o*e.a+a*e.c+e.e,t.f=o*e.b+a*e.d+e.f},divide(t,e){v.preMultiply(t,v.tempInvert(e))},tempInvert(t){const{tempMatrix:e}=v;return v.copy(e,t),v.invert(e),e},invert(t){const{a:e,b:s,c:i,d:r,e:n,f:o}=t,a=1/(e*r-s*i);t.a=r*a,t.b=-s*a,t.c=-i*a,t.d=e*a,t.e=-(n*r-o*i)*a,t.f=-(o*e-n*s)*a},toOuterPoint(t,e,s,i){const{x:r,y:n}=e;s||(s=e),s.x=r*t.a+n*t.c,s.y=r*t.b+n*t.d,i||(s.x+=t.e,s.y+=t.f)},toInnerPoint(t,e,s,i){const{x:r,y:n}=e,{a:o,b:a,c:h,d:l}=t,d=1/(o*l-a*h);if(s||(s=e),s.x=(r*l-n*h)*d,s.y=(n*o-r*a)*d,!i){const{e:e,f:i}=t;s.x-=(e*l-i*h)*d,s.y-=(i*o-e*a)*d}},decompose(t){const{a:e,b:s,c:i,d:r}=t;let n=e,a=r,h=0,l=0,d=0;if(s||i){const t=e*r-s*i,g=e*i+s*r;if(s){const i=e*e+s*s;n=_(i),a=t/n;const r=e/n;h=s>0?c(r):-c(r),l=u(g/i)/o}else{const e=i*i+r*r;a=_(e),n=t/a;const s=i/a;h=p/2-(r>0?c(-s):-c(s)),d=u(g/e)/o}h/=o}return{x:t.e,y:t.f,scaleX:n,scaleY:a,rotation:h,skewX:l,skewY:d}},reset(t){v.set(t)}},v=y,{toInnerPoint:m,toOuterPoint:w}=y,{sin:x,cos:E,abs:b,sqrt:B,atan2:C}=Math,R={defaultPoint:{x:0,y:0},tempPoint:{},tempRadiusPoint:{},set(t,e=0,s=0){t.x=e,t.y=s},setRadius(t,e,s){t.radiusX=e,t.radiusY=void 0===s?e:s},copy(t,e){t.x=e.x,t.y=e.y},move(t,e,s){t.x+=e,t.y+=s},rotate(t,e,s){s||(s=T.defaultPoint);const i=E(e*o),r=x(e*o),n=t.x-s.x,a=t.y-s.y;t.x=s.x+n*i-a*r,t.y=s.y+n*r+a*i},tempToInnerOf(t,e){const{tempPoint:s}=T;return T.copy(s,t),m(e,s,s),s},tempToOuterOf(t,e){const{tempPoint:s}=T;return T.copy(s,t),w(e,s,s),s},tempToInnerRadiusPointOf(t,e){const{tempRadiusPoint:s}=T;return T.copy(s,t),T.toInnerRadiusPointOf(t,e,s),s},toInnerRadiusPointOf(t,e,s){s||(s=t),m(e,t,s),s.radiusX=Math.abs(t.radiusX/e.scaleX),s.radiusY=Math.abs(t.radiusY/e.scaleY)},toInnerOf(t,e,s){m(e,t,s)},toOuterOf(t,e,s){w(e,t,s)},getCenter:(t,e)=>({x:t.x+(e.x-t.x)/2,y:t.y+(e.y-t.y)/2}),getDistance(t,e){const s=b(e.x-t.x),i=b(e.y-t.y);return B(s*s+i*i)},getAngle:(t,e)=>T.getAtan2(t,e)/o,getChangeAngle(t,e,s,i){i||(i=e);let r=T.getAngle(t,e);const n=T.getAngle(s,i)-r;return n<-180?n+360:n},getAtan2:(t,e)=>C(e.y-t.y,e.x-t.x),getDistancePoint(t,e,s){const i=T.getAtan2(t,e);return{x:t.x+E(i)*s,y:t.y+x(i)*s}},reset(t){T.reset(t)}},T=R;class k{constructor(t,e){"object"==typeof t?R.copy(this,t):R.set(this,t,e)}set(t,e){R.set(this,t,e)}copy(t){return R.copy(this,t),this}clone(){return new k(this)}rotate(t,e){return R.rotate(this,t,e),this}toInnerOf(t,e){return R.toInnerOf(this,t,e),this}toOuterOf(t,e){return R.toOuterOf(this,t,e),this}getCenter(t){return R.getCenter(this,t)}getDistance(t){return R.getDistance(this,t)}getAngle(t){return R.getAngle(this,t)}getAtan2(t){return R.getAtan2(this,t)}reset(){R.reset(this)}}class P{constructor(t,e,s,i,r,n){"object"==typeof t?y.copy(this,t):y.set(this,t,e,s,i,r,n)}set(t,e,s,i,r,n){y.set(this,t,e,s,i,r,n)}copy(t){return y.copy(this,t),this}clone(){return new P(this)}translate(t,e){return y.translate(this,t,e),this}translateInner(t,e){return y.translateInner(this,t,e),this}scale(t,e){return y.scale(this,t,e),this}scaleOfOuter(t,e,s){return y.scaleOfOuter(this,t,e,s),this}scaleOfInner(t,e,s){return y.scaleOfInner(this,t,e,s),this}rotate(t){return y.rotate(this,t),this}rotateOfOuter(t,e){return y.rotateOfOuter(this,t,e),this}rotateOfInner(t,e){return y.rotateOfInner(this,t,e),this}skew(t,e){return y.skew(this,t,e),this}skewOfOuter(t,e,s){return y.skewOfOuter(this,t,e,s),this}skewOfInner(t,e,s){return y.skewOfInner(this,t,e,s),this}multiply(t){return y.multiply(this,t),this}preMultiply(t){return y.preMultiply(this,t),this}divide(t){return y.divide(this,t),this}invert(){return y.invert(this),this}toOuterPoint(t,e,s){y.toOuterPoint(this,t,e,s)}toInnerPoint(t,e,s){y.toInnerPoint(this,t,e,s)}decompose(){return y.decompose(this)}reset(){y.reset(this)}}const L={tempPointBounds:{},setPoint(t,e,s){t.minX=t.maxX=e,t.minY=t.maxY=s},addPoint(t,e,s){t.minX=e<t.minX?e:t.minX,t.minY=s<t.minY?s:t.minY,t.maxX=e>t.maxX?e:t.maxX,t.maxY=s>t.maxY?s:t.maxY},addBounds(t,e,s,i,r){O(t,e,s),O(t,e+i,s+r)},copy(t,e){t.minX=e.minX,t.minY=e.minY,t.maxX=e.maxX,t.maxY=e.maxY},add(t,e){t.minX=e.minX<t.minX?e.minX:t.minX,t.minY=e.minY<t.minY?e.minY:t.minY,t.maxX=e.maxX>t.maxX?e.maxX:t.maxX,t.maxY=e.maxY>t.maxY?e.maxY:t.maxY},toBounds(t,e){e.x=t.minX,e.y=t.minY,e.width=t.maxX-t.minX,e.height=t.maxY-t.minY}},{addPoint:O}=L,{tempPointBounds:S,setPoint:D,addPoint:M,toBounds:I}=L,{toOuterPoint:A}=y;let W,U,N,F;const z={},Y={},X={tempBounds:{},set(t,e=0,s=0,i=0,r=0){t.x=e,t.y=s,t.width=i,t.height=r},copy(t,e){t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height},copyAndSpread(t,e,s,i){i||(i=s),H.set(t,e.x-s,e.y-i,e.width+2*s,e.height+2*i)},right:t=>t.x+t.width,bottom:t=>t.y+t.height,move(t,e,s){t.x+=e,t.y+=s},getByMove:(t,e,s)=>(t=Object.assign({},t),H.move(t,e,s),t),toOffsetOutBounds(t,e,s){e?V(e,t):e=t,s?(e.offsetX=-(H.right(s)-t.x),e.offsetY=-(H.bottom(s)-t.y)):(e.offsetX=t.x+t.width,e.offsetY=t.y+t.height),H.move(e,-e.offsetX,-e.offsetY)},scale(t,e,s){s||(s=e),t.x&&(t.x*=e),t.y&&(t.y*=s),t.width*=e,t.height*=s},tempToOuterOf:(t,e)=>(H.copy(H.tempBounds,t),H.toOuterOf(H.tempBounds,e),H.tempBounds),getOuterOf:(t,e)=>(t=Object.assign({},t),H.toOuterOf(t,e),t),toOuterOf(t,e,s){if(s||(s=t),0===e.b&&0===e.c){const{a:i,d:r}=e;i>0?(s.width=t.width*i,s.x=e.e+t.x*i):(s.width=t.width*-i,s.x=e.e+t.x*i-s.width),r>0?(s.height=t.height*r,s.y=e.f+t.y*r):(s.height=t.height*-r,s.y=e.f+t.y*r-s.height)}else z.x=t.x,z.y=t.y,A(e,z,Y),D(S,Y.x,Y.y),z.x=t.x+t.width,A(e,z,Y),M(S,Y.x,Y.y),z.y=t.y+t.height,A(e,z,Y),M(S,Y.x,Y.y),z.x=t.x,A(e,z,Y),M(S,Y.x,Y.y),I(S,s)},getFitMatrix(t,e){const s=Math.min(1,Math.min(t.width/e.width,t.height/e.height));return new P(s,0,0,s,-Math.ceil(e.x*s),-Math.ceil(e.y*s))},getSpread(t,e,s){const i={};return H.copyAndSpread(i,t,e,s),i},spread(t,e,s){H.copyAndSpread(t,t,e,s)},ceil(t){t.x=Math.floor(t.x),t.y=Math.floor(t.y),t.width=Math.ceil(t.width),t.height=Math.ceil(t.height)},unsign(t){t.width<0&&(t.x+=t.width,t.width=-t.width),t.height<0&&(t.y+=t.height,t.height=-t.height)},add(t,e){W=t.x+t.width,U=t.y+t.height,N=e.x+e.width,F=e.y+e.height,W=W>N?W:N,U=U>F?U:F,t.x=t.x<e.x?t.x:e.x,t.y=t.y<e.y?t.y:e.y,t.width=W-t.x,t.height=U-t.y},addList(t,e){H.setByListWithHandle(t,e,void 0,!0)},setByList(t,e,s=!1){H.setByListWithHandle(t,e,void 0,s)},addListWithHandle(t,e,s){H.setByListWithHandle(t,e,s,!0)},setByListWithHandle(t,e,s,i=!1){let r,n=!0;for(let o=0,a=e.length;o<a;o++)r=s?s(e[o]):e[o],r&&(r.width||r.height)&&(n?(n=!1,i||V(t,r)):j(t,r));n&&H.reset(t)},setByPoints(t,e){e.forEach(((t,e)=>{0===e?D(S,t.x,t.y):M(S,t.x,t.y)})),I(S,t)},hitRadiusPoint:(t,e,s)=>(s&&(e=R.tempToInnerRadiusPointOf(e,s)),e.x>=t.x-e.radiusX&&e.x<=t.x+t.width+e.radiusX&&e.y>=t.y-e.radiusY&&e.y<=t.y+t.height+e.radiusY),hitPoint:(t,e,s)=>(s&&(e=R.tempToInnerOf(e,s)),e.x>=t.x&&e.x<=t.x+t.width&&e.y>=t.y&&e.y<=t.y+t.height),hit:(t,e,s)=>(s&&(e=H.tempToOuterOf(e,s)),!(t.y+t.height<e.y||e.y+e.height<t.y||t.x+t.width<e.x||e.x+e.width<t.x)),includes:(t,e,s)=>(s&&(e=H.tempToOuterOf(e,s)),t.x<=e.x&&t.y<=e.y&&t.x+t.width>=e.x+e.width&&t.y+t.height>=e.y+e.height),getIntersectData(t,e,s){s&&(e=H.tempToOuterOf(e,s));let{x:i,y:r,width:n,height:o}=e;return W=i+n,U=r+o,N=t.x+t.width,F=t.y+t.height,i=i>t.x?i:t.x,r=r>t.y?r:t.y,W=W<N?W:N,U=U<F?U:F,n=W-i,o=U-r,{x:i,y:r,width:n,height:o}},intersect(t,e,s){H.copy(t,H.getIntersectData(t,e,s))},isSame:(t,e)=>t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height,isEmpty:t=>0===t.x&&0===t.y&&0===t.width&&0===t.height,reset(t){H.set(t)}},H=X,{add:j,copy:V}=H;class G{constructor(t,e,s,i){"object"==typeof t?X.copy(this,t):X.set(this,t,e,s,i)}set(t,e,s,i){X.set(this,t,e,s,i)}copy(t){return X.copy(this,t),this}clone(){return new G(this)}scale(t,e){return X.scale(this,t,e),this}toOuterOf(t,e){return X.toOuterOf(this,t,e),this}getFitMatrix(t){return X.getFitMatrix(this,t)}spread(t){return X.spread(this,t),this}ceil(){return X.ceil(this),this}unsign(){return X.unsign(this),this}add(t){return X.add(this,t),this}addList(t){return X.setByList(this,t,!0),this}setByList(t,e){return X.setByList(this,t,e),this}addListWithHandle(t,e){return X.setByListWithHandle(this,t,e,!0),this}setByListWithHandle(t,e,s){return X.setByListWithHandle(this,t,e,s),this}setByPoints(t){return X.setByPoints(this,t),this}hitPoint(t,e){return X.hitPoint(this,t,e)}hitRadiusPoint(t,e){return X.hitRadiusPoint(this,t,e)}hit(t,e){return X.hit(this,t,e)}includes(t,e){return X.includes(this,t,e)}intersect(t,e){return X.intersect(this,t,e),this}getIntersect(t,e){return new G(X.getIntersectData(this,t,e))}isSame(t){return X.isSame(this,t)}isEmpty(){return X.isEmpty(this)}reset(){X.reset(this)}}class K{constructor(t,e,s,i,r,n){"object"==typeof t?this.copy(t):this.set(t,e,s,i,r,n)}set(t=0,e=0,s=0,i=0,r=0,n=0){this.top=t,this.right=e,this.bottom=s,this.left=i,this.width=r,this.height=n}copy(t){const{top:e,right:s,bottom:i,left:r,width:n,height:o}=t;this.set(e,s,i,r,n,o)}getBoundsFrom(t){const{top:e,right:s,bottom:i,left:r,width:n,height:o}=this;return new G(r,e,n||t.width-r-s,o||t.height-e-i)}}const q={0:1,1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,9:1,".":1,e:1,E:1};class Z{constructor(t){this.repeatMap={},this.name=t}static get(t){return new Z(t)}static set filter(t){t?"string"==typeof t&&(t=[t]):t=[],this.filterList=t}static set exclude(t){t?"string"==typeof t&&(t=[t]):t=[],this.excludeList=t}log(...t){if(Q.enable){if(Q.filterList.length&&Q.filterList.every((t=>t!==this.name)))return;if(Q.excludeList.length&&Q.excludeList.some((t=>t===this.name)))return;console.log("%c"+this.name,"color:#21ae62",...t)}}warn(...t){Q.enable&&console.warn(this.name,...t)}repeat(t,...e){this.repeatMap[t]||(this.warn("repeat:"+t,...e),this.repeatMap[t]=!0)}error(...t){try{throw new Error}catch(e){console.error(this.name,...t,e)}}}Z.filterList=[],Z.excludeList=[];const Q=Z,$=Z.get("RunTime");class J{static start(t,e){const s=i.create(i.RUNTIME);return tt.currentId=tt.idMap[s]=e?performance.now():Date.now(),tt.currentName=tt.nameMap[s]=t,tt.nameToIdMap[t]=s,s}static end(t,e){const s=tt.idMap[t],i=tt.nameMap[t];tt.idMap[t]=tt.nameMap[t]=tt.nameToIdMap[i]=void 0,e?$.log(i,performance.now()-s,"µs"):$.log(i,Date.now()-s,"ms")}static endOfName(t,e){const s=tt.nameToIdMap[t];void 0!==s&&tt.end(s,e)}}J.idMap={},J.nameMap={},J.nameToIdMap={};const tt=J,et=Z.get("UICreator"),st={list:{},register(t){const{__tag:e}=t.prototype;it[e]?et.repeat(e):it[e]=t},get(t,e,s,i,r,n){const o=new it[t](e);return void 0!==s&&(o.x=s,i&&(o.y=i),r&&(o.width=r),n&&(o.height=n)),o}},{list:it}=st,rt=Z.get("EventCreator"),nt={nameList:{},register(t){let e;Object.keys(t).forEach((s=>{e=t[s],"string"==typeof e&&(ot[e]?rt.repeat(e):ot[e]=t)}))},changeName(t,e){const s=ot[t];if(s){const i=Object.keys(s).find((e=>s[e]===t));i&&(s[i]=e,ot[e]=s)}},has(t){return!!this.nameList[t]},get:(t,...e)=>new ot[t](...e)},{nameList:ot}=nt;class at{constructor(){this.list=[]}add(t){t.manager=this,this.list.push(t)}get(t){let e;const{list:i}=this;for(let s=0,r=i.length;s<r;s++)if(e=i[s],e.recycled&&e.isSameSize(t))return e.recycled=!1,e.manager||(e.manager=this),e;const r=s.canvas(t);return this.add(r),r}recycle(t){t.recycled||(t.clear(),t.recycled=!0)}clearRecycled(){let t;const e=[];for(let s=0,i=this.list.length;s<i;s++)t=this.list[s],t.recycled?t.destroy():e.push(t);this.list=e}clear(){this.list.forEach((t=>{t.destroy()})),this.list.length=0}destroy(){this.clear()}}class ht{get length(){return this.list.length}constructor(t){this.reset(),t&&(t instanceof Array?this.pushList(t):this.push(t))}has(t){return t&&void 0!==this.keys[t.innerId]}indexAt(t){return this.list[t]}indexOf(t){const e=this.keys[t.innerId];return void 0===e?-1:e}pushList(t){t.forEach((t=>{this.push(t)}))}unshift(t){const{keys:e}=this;void 0===e[t.innerId]&&(this.list.unshift(t),Object.keys(e).forEach((t=>{void 0!==e[t]&&e[t]++})),e[t.innerId]=0)}push(t){const{list:e,keys:s}=this;void 0===s[t.innerId]&&(e.push(t),s[t.innerId]=e.length-1)}sort(t){const{list:e}=this;t?e.sort(((t,e)=>e.__level-t.__level)):e.sort(((t,e)=>t.__level-e.__level))}remove(t){const{list:e}=this;let s;for(let i=0,r=e.length;i<r;i++)void 0!==s?this.keys[e[i].innerId]=i-1:e[i].innerId===t.innerId&&(s=i,delete this.keys[t.innerId]);void 0!==s&&e.splice(s,1)}forEach(t){this.list.forEach(t)}clone(){const t=new ht;return this.list.forEach((e=>{t.push(e)})),t}reset(){this.list=[],this.keys={}}destroy(){this.list=null}}class lt{get length(){return this._length}constructor(t){this._length=0,this.reset(),t&&(t instanceof Array?this.pushList(t):this.push(t))}has(t){return void 0!==this.keys[t.innerId]}without(t){return void 0===this.keys[t.innerId]}sort(t){const{levels:e}=this;t?e.sort(((t,e)=>e-t)):e.sort(((t,e)=>t-e))}pushList(t){t.forEach((t=>{this.push(t)}))}push(t){const{keys:e,levelMap:s}=this;e[t.innerId]||(e[t.innerId]=1,s[t.__level]?s[t.__level].push(t):(s[t.__level]=[t],this.levels.push(t.__level)),this._length++)}forEach(t){let e;this.levels.forEach((s=>{e=this.levelMap[s];for(let s=0,i=e.length;s<i;s++)t(e[s])}))}reset(){this.levelMap={},this.keys={},this.levels=[],this._length=0}destroy(){this.levelMap=null}}class dt extends at{constructor(){super(...arguments),this.pathTypeList=new ht,this.imageTypeList=new ht}getImageType(t,e){return this.imageTypeList.push(t),s.hitCanvas(e)}getPathType(t){return this.pathTypeList.push(t),s.hitCanvas()}clearImageType(){this.__clearLeafList(this.imageTypeList)}clearPathType(){this.__clearLeafList(this.pathTypeList)}__clearLeafList(t){t.length&&(t.forEach((t=>{t.__hitCanvas&&(t.__hitCanvas.destroy(),t.__hitCanvas=null)})),t.reset())}clear(){this.clearPathType(),this.clearImageType()}}const ct={default:(t,e)=>(ut(e,t),ut(t,e),t),assign(t,e){let s;Object.keys(e).forEach((i=>{var r;s=e[i],(null==s?void 0:s.constructor)===Object&&(null===(r=t[i])||void 0===r?void 0:r.constructor)===Object?ut(t[i],e[i]):t[i]=e[i]}))},copyAttrs:(t,e,s)=>(s.forEach((s=>{void 0!==e[s]&&(t[s]=e[s])})),t),clone:t=>JSON.parse(JSON.stringify(t))},{assign:ut}=ct;class _t{constructor(t){this.__leaf=t}__get(t){if(this.__input){const e=this.__input[t];if(void 0!==e)return e}return this[t]}__setInput(t,e){this.__input||(this.__input={}),this.__input[t]=e}__getInput(t){if(this.__input){const e=this.__input[t];if(void 0!==e)return e}return this["_"+t]}__removeInput(t){this.__input&&void 0!==this.__input[t]&&(this.__input[t]=void 0)}__getInputData(){const t={tag:this.__leaf.tag},{__input:e}=this;let s,i;for(let r in this)s=r.substring(1),void 0!==this[s]&&(i=e?e[s]:void 0,t[s]=void 0===i?this[r]:i);return t}__setMiddle(t,e){this.__middle||(this.__middle={}),this.__middle[t]=e}__getMiddle(t){return this.__middle&&this.__middle[t]}__checkSingle(){"pass-through"===this.blendMode?this.__leaf.__hasEraser||this.isEraser?this.__single=!0:this.__single&&(this.__single=!1):this.__single=!0}destroy(){this.__input=this.__middle=null}}const pt={mineType:t=>!t||t.startsWith("image")?t:("jpg"===t&&(t="jpeg"),"image/"+t),fileType(t){const e=t.split(".");return e[e.length-1]}};function gt(t,e,s,i){var r,n=arguments.length,o=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,s,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(o=(n<3?r(o):n>3?r(e,s,o):r(e,s))||o);return n>3&&o&&Object.defineProperty(e,s,o),o}function ft(t,e,s,i){return new(s||(s=Promise))((function(r,n){function o(t){try{h(i.next(t))}catch(t){n(t)}}function a(t){try{h(i.throw(t))}catch(t){n(t)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,a)}h((i=i.apply(t,e||[])).next())}))}function yt(t){return(e,s)=>{t||(t=s);const i={get(){return this.context[t]},set(e){this.context[t]=e}};Object.defineProperty(e,s,i)}}"function"==typeof SuppressedError&&SuppressedError;const vt=[];function mt(){return(t,e)=>{vt.push(e)}}const wt=[];class xt{set blendMode(t){"normal"===t&&(t="source-over"),this.context.globalCompositeOperation=t}get blendMode(){return this.context.globalCompositeOperation}set dashPattern(t){this.context.setLineDash(t||wt)}get dashPattern(){return this.context.getLineDash()}__bindContext(){let t;vt.forEach((e=>{t=this.context[e],t&&(this[e]=t.bind(this.context))})),this.textBaseline="alphabetic"}setTransform(t,e,s,i,r,n){}resetTransform(){}getTransform(){}save(){}restore(){}transform(t,e,s,i,r,n){"object"==typeof t?this.context.transform(t.a,t.b,t.c,t.d,t.e,t.f):this.context.transform(t,e,s,i,r,n)}translate(t,e){}scale(t,e){}rotate(t){}fill(t,e){}stroke(t){}clip(t,e){}fillRect(t,e,s,i){}strokeRect(t,e,s,i){}clearRect(t,e,s,i){}drawImage(t,e,s,i,r,n,o,a,h){switch(arguments.length){case 9:if(e<0){const t=-e/i*a;i+=e,e=0,n+=t,a-=t}if(s<0){const t=-s/r*h;r+=s,s=0,o+=t,h-=t}this.context.drawImage(t,e,s,i,r,n,o,a,h);break;case 5:this.context.drawImage(t,e,s,i,r);break;case 3:this.context.drawImage(t,e,s)}}beginPath(){}moveTo(t,e){}lineTo(t,e){}bezierCurveTo(t,e,s,i,r,n){}quadraticCurveTo(t,e,s,i){}closePath(){}arc(t,e,s,i,r,n){}arcTo(t,e,s,i,r){}ellipse(t,e,s,i,r,n,o,a){}rect(t,e,s,i){}roundRect(t,e,s,i,r){}createConicGradient(t,e,s){}createLinearGradient(t,e,s,i){}createPattern(t,e){}createRadialGradient(t,e,s,i,r,n){}fillText(t,e,s,i){}measureText(t){}strokeText(t,e,s,i){}destroy(){this.context=null}}gt([yt("imageSmoothingEnabled")],xt.prototype,"smooth",void 0),gt([yt("imageSmoothingQuality")],xt.prototype,"smoothLevel",void 0),gt([yt("globalAlpha")],xt.prototype,"opacity",void 0),gt([yt()],xt.prototype,"fillStyle",void 0),gt([yt()],xt.prototype,"strokeStyle",void 0),gt([yt("lineWidth")],xt.prototype,"strokeWidth",void 0),gt([yt("lineCap")],xt.prototype,"strokeCap",void 0),gt([yt("lineJoin")],xt.prototype,"strokeJoin",void 0),gt([yt("lineDashOffset")],xt.prototype,"dashOffset",void 0),gt([yt()],xt.prototype,"miterLimit",void 0),gt([yt()],xt.prototype,"shadowBlur",void 0),gt([yt()],xt.prototype,"shadowColor",void 0),gt([yt()],xt.prototype,"shadowOffsetX",void 0),gt([yt()],xt.prototype,"shadowOffsetY",void 0),gt([yt()],xt.prototype,"filter",void 0),gt([yt()],xt.prototype,"font",void 0),gt([yt()],xt.prototype,"fontKerning",void 0),gt([yt()],xt.prototype,"fontStretch",void 0),gt([yt()],xt.prototype,"fontVariantCaps",void 0),gt([yt()],xt.prototype,"textAlign",void 0),gt([yt()],xt.prototype,"textBaseline",void 0),gt([yt()],xt.prototype,"textRendering",void 0),gt([yt()],xt.prototype,"wordSpacing",void 0),gt([yt()],xt.prototype,"letterSpacing",void 0),gt([yt()],xt.prototype,"direction",void 0),gt([mt()],xt.prototype,"setTransform",null),gt([mt()],xt.prototype,"resetTransform",null),gt([mt()],xt.prototype,"getTransform",null),gt([mt()],xt.prototype,"save",null),gt([mt()],xt.prototype,"restore",null),gt([mt()],xt.prototype,"translate",null),gt([mt()],xt.prototype,"scale",null),gt([mt()],xt.prototype,"rotate",null),gt([mt()],xt.prototype,"fill",null),gt([mt()],xt.prototype,"stroke",null),gt([mt()],xt.prototype,"clip",null),gt([mt()],xt.prototype,"fillRect",null),gt([mt()],xt.prototype,"strokeRect",null),gt([mt()],xt.prototype,"clearRect",null),gt([mt()],xt.prototype,"beginPath",null),gt([mt()],xt.prototype,"moveTo",null),gt([mt()],xt.prototype,"lineTo",null),gt([mt()],xt.prototype,"bezierCurveTo",null),gt([mt()],xt.prototype,"quadraticCurveTo",null),gt([mt()],xt.prototype,"closePath",null),gt([mt()],xt.prototype,"arc",null),gt([mt()],xt.prototype,"arcTo",null),gt([mt()],xt.prototype,"ellipse",null),gt([mt()],xt.prototype,"rect",null),gt([mt()],xt.prototype,"roundRect",null),gt([mt()],xt.prototype,"createConicGradient",null),gt([mt()],xt.prototype,"createLinearGradient",null),gt([mt()],xt.prototype,"createPattern",null),gt([mt()],xt.prototype,"createRadialGradient",null),gt([mt()],xt.prototype,"fillText",null),gt([mt()],xt.prototype,"measureText",null),gt([mt()],xt.prototype,"strokeText",null);const Et=new G,bt={width:1,height:1,pixelRatio:1},Bt=Z.get("LeaferCanvasBase"),Ct=["width","height","pixelRatio"];class Rt extends xt{get pixelWidth(){return this.width*this.pixelRatio}get pixelHeight(){return this.height*this.pixelRatio}get allowBackgroundColor(){return this.view&&this.parentView}constructor(t,s){super(),this.worldTransform={},t||(t=bt),t.pixelRatio||(t.pixelRatio=e.devicePixelRatio),this.manager=s,this.innerId=i.create(i.CNAVAS);const{width:r,height:n,pixelRatio:o}=t;this.autoLayout=!r||!n,this.pixelRatio=o,this.config=t,this.init()}init(){}__createContext(){this.context=this.view.getContext("2d"),this.__bindContext()}toBlob(t,s){return new Promise((i=>{const r=this.getSaveCanvas(t);e.origin.canvasToBolb(r.view,t,s).then((t=>{r.recycle(),i(t)})).catch((t=>{Bt.error(t),i(null)}))}))}toDataURL(t,s){const i=this.getSaveCanvas(t),r=e.origin.canvasToDataURL(i.view,t,s);return i.recycle(),r}saveAs(t,s){return new Promise((i=>{const r=this.getSaveCanvas(pt.fileType(t));e.origin.canvasSaveAs(r.view,t,s).then((()=>{r.recycle(),i(!0)})).catch((t=>{Bt.error(t),i(!1)}))}))}getSaveCanvas(t){const{backgroundColor:e,bounds:s}=this,i=this.getSameCanvas();return["jpg","jpeg"].includes(t)&&i.fillWorld(s,"#FFFFFF"),e&&i.fillWorld(s,e),i.copyWorld(this),i}resize(t){if(this.isSameSize(t))return;let e;this.context&&!this.unreal&&this.width&&(e=this.getSameCanvas(),e.copyWorld(this)),ct.copyAttrs(this,t,Ct),this.bounds=new G(0,0,this.width,this.height),this.pixelRatio||(this.pixelRatio=1),this.unreal||(this.updateViewSize(),this.smooth=this.config.smooth),this.updateClientBounds(),this.context&&!this.unreal&&e&&(this.clearWorld(e.bounds),this.copyWorld(e),e.recycle())}updateViewSize(){}updateClientBounds(){}startAutoLayout(t,e){}stopAutoLayout(){}setCursor(t){}setWorld(t,e,s){const{pixelRatio:i}=this,r=this.worldTransform;if(e)if(s)this.setTransform(r.a=t.a*i,r.b=t.b*i,r.c=t.c*i,r.d=t.d*i,r.e=(t.e+e.e)*i,r.f=(t.f+e.f)*i);else{const{a:s,b:n,c:o,d:a,e:h,f:l}=e;this.setTransform(r.a=(t.a*s+t.b*o)*i,r.b=(t.a*n+t.b*a)*i,r.c=(t.c*s+t.d*o)*i,r.d=(t.c*n+t.d*a)*i,r.e=(t.e*s+t.f*o+h)*i,r.f=(t.e*n+t.f*a+l)*i)}else this.setTransform(r.a=t.a*i,r.b=t.b*i,r.c=t.c*i,r.d=t.d*i,r.e=t.e*i,r.f=t.f*i)}useWorldTransform(t){t&&(this.worldTransform=t);const e=this.worldTransform;e&&this.setTransform(e.a,e.b,e.c,e.d,e.e,e.f)}setStroke(t,e,s){e&&(this.strokeWidth=e),t&&(this.strokeStyle=t),s&&this.setStrokeOptions(s)}setStrokeOptions(t){this.strokeCap=t.strokeCap,this.strokeJoin=t.strokeJoin,this.dashPattern=t.dashPattern,this.dashOffset=t.dashOffset,this.miterLimit=t.miterLimit}saveBlendMode(t){this.savedBlendMode=this.blendMode,this.blendMode=t}restoreBlendMode(){this.blendMode=this.savedBlendMode}hitFill(t,e){return e?this.context.isPointInPath(t.x,t.y,e):this.context.isPointInPath(t.x,t.y)}hitStroke(t,e){return this.strokeWidth=e,this.context.isPointInStroke(t.x,t.y)}setWorldShadow(t,e,s,i){const{pixelRatio:r}=this;this.shadowOffsetX=t*r,this.shadowOffsetY=e*r,this.shadowBlur=s*r,this.shadowColor=i||"black"}setWorldBlur(t){const{pixelRatio:e}=this;this.filter=`blur(${t*e}px)`}copyWorld(t,e,s,i){if(i&&(this.blendMode=i),e){const{pixelRatio:i}=this;s||(s=e),this.drawImage(t.view,e.x*i,e.y*i,e.width*i,e.height*i,s.x*i,s.y*i,s.width*i,s.height*i)}else this.drawImage(t.view,0,0);i&&(this.blendMode="source-over")}copyWorldToInner(t,e,s,i){if(i&&(this.blendMode=i),e.b||e.c)this.save(),this.resetTransform(),this.copyWorld(t,e,X.tempToOuterOf(s,e)),this.restore();else{const{pixelRatio:i}=this;this.drawImage(t.view,e.x*i,e.y*i,e.width*i,e.height*i,s.x,s.y,s.width,s.height)}i&&(this.blendMode="source-over")}copyWorldByReset(t,e,s,i){this.resetTransform(),this.copyWorld(t,e,s,i),this.useWorldTransform()}useMask(t,e,s){this.copyWorld(t,e,s,"destination-in")}useEraser(t,e,s){this.copyWorld(t,e,s,"destination-out")}fillWorld(t,e,s){s&&(this.blendMode=s),this.fillStyle=e,Et.copy(t).scale(this.pixelRatio),this.fillRect(Et.x,Et.y,Et.width,Et.height),s&&(this.blendMode="source-over")}strokeWorld(t,e,s){s&&(this.blendMode=s),this.strokeStyle=e,Et.copy(t).scale(this.pixelRatio),this.strokeRect(Et.x,Et.y,Et.width,Et.height),s&&(this.blendMode="source-over")}clearWorld(t,e){Et.copy(t).scale(this.pixelRatio),e&&Et.ceil(),this.clearRect(Et.x,Et.y,Et.width,Et.height)}clipWorld(t,e){this.beginPath(),Et.copy(t).scale(this.pixelRatio),e&&Et.ceil(),this.rect(Et.x,Et.y,Et.width,Et.height),this.clip()}clear(){const{pixelRatio:t}=this;this.clearRect(0,0,this.width*t,this.height*t)}isSameSize(t){return this.width===t.width&&this.height===t.height&&this.pixelRatio===t.pixelRatio}getSameCanvas(t){const{width:e,height:i,pixelRatio:r}=this,n={width:e,height:i,pixelRatio:r},o=this.manager?this.manager.get(n):s.canvas(n);return o.save(),t&&o.useWorldTransform(Object.assign({},this.worldTransform)),o}getBiggerCanvas(t,e){let{width:i,height:r,pixelRatio:n}=this;t&&(i+=t),e&&(r+=e);const o={width:i,height:r,pixelRatio:n},a=this.manager?this.manager.get(o):s.canvas(o);return a.save(),a}recycle(){this.recycled||(this.restore(),this.manager?this.manager.recycle(this):this.destroy())}updateRender(){}unrealCanvas(){}destroy(){this.manager=this.view=this.parentView=null}}const Tt={creator:{},parse(t,e){},convertToCanvasData(t,e){}},kt={N:21,D:22,X:23,G:24,F:25,O:26,P:27,U:28},Pt=Object.assign({M:1,m:10,L:2,l:20,H:3,h:30,V:4,v:40,C:5,c:50,S:6,s:60,Q:7,q:70,T:8,t:80,A:9,a:90,Z:11,z:11,R:12},kt),Lt={M:3,m:3,L:3,l:3,H:2,h:2,V:2,v:2,C:7,c:7,S:5,s:5,Q:5,q:5,T:3,t:3,A:8,a:8,Z:1,z:1,N:5,D:9,X:6,G:9,F:5,O:7,P:4,U:6},Ot={m:10,l:20,H:3,h:30,V:4,v:40,c:50,S:6,s:60,q:70,T:8,t:80,A:9,a:90},St=Object.assign(Object.assign({},Ot),kt),Dt=Pt,Mt={};for(let t in Dt)Mt[Dt[t]]=t;const It={};for(let t in Dt)It[Dt[t]]=Lt[t];const At={drawRoundRect(t,e,s,i,r,o){let[a,h,l,d]=n.fourNumber(o);const c=Math.min(i/2,r/2);a>c&&(a=c),h>c&&(h=c),l>c&&(l=c),d>c&&(d=c),a?t.moveTo(e+a,s):t.moveTo(e,s),h?t.arcTo(e+i,s,e+i,s+r,h):t.lineTo(e+i,s),l?t.arcTo(e+i,s+r,e,s+r,l):t.lineTo(e+i,s+r),d?t.arcTo(e,s+r,e,s,d):t.lineTo(e,s+r),a?t.arcTo(e,s,e+i,s,a):t.lineTo(e,s)}},{sin:Wt,cos:Ut,atan2:Nt,ceil:Ft,abs:zt,PI:Yt,sqrt:Xt,pow:Ht}=Math,{setPoint:jt,addPoint:Vt}=L,{set:Gt}=R,{M:Kt,L:qt,C:Zt,Q:Qt,Z:$t}=Pt,Jt={},te={points(t,e,s,i){if(t.push(Kt,e[0],e[1]),s&&e.length>5){let r,n,o,a,h,l,d,c,u,_,p,g,f,y=e.length;const v=!0===s?.5:s;i&&(y=(e=[e[y-2],e[y-1],...e,e[0],e[1],e[2],e[3]]).length);for(let s=2;s<y-2;s+=2)r=e[s-2],n=e[s-1],o=e[s],a=e[s+1],h=e[s+2],l=e[s+3],p=Xt(Ht(o-r,2)+Ht(a-n,2)),g=Xt(Ht(h-o,2)+Ht(l-a,2)),f=p+g,p=v*p/f,g=v*g/f,h-=r,l-=n,d=o-p*h,c=a-p*l,2===s?i||t.push(Qt,d,c,o,a):t.push(Zt,u,_,d,c,o,a),u=o+g*h,_=a+g*l;i||t.push(Qt,u,_,e[y-2],e[y-1])}else for(let s=2,i=e.length;s<i;s+=2)t.push(qt,e[s],e[s+1]);i&&t.push($t)},rect(t,e,s,i,r){Tt.creator.path=t,Tt.creator.moveTo(e,s).lineTo(e+i,s).lineTo(e+i,s+r).lineTo(e,s+r).lineTo(e,s)},roundRect(t,e,s,i,r,n){Tt.creator.path=[],At.drawRoundRect(Tt.creator,e,s,i,r,n),t.push(...Tt.convertToCanvasData(Tt.creator.path,!0))},arcTo(t,e,s,i,r,n,l,d,c,u,_){const p=i-e,g=r-s,f=n-i,y=l-r;let v=Nt(g,p),m=Nt(y,f),w=m-v;if(w<0&&(w+=a),w===Yt||zt(p+g)<1e-12||zt(f+y)<1e-12)return t&&t.push(qt,i,r),c&&(jt(c,e,s),Vt(c,i,r)),_&&Gt(_,e,s),void(u&&Gt(u,i,r));const x=p*y-f*g<0,E=x?-1:1,b=d/Ut(w/2),B=i+b*Ut(v+w/2+h*E),C=r+b*Wt(v+w/2+h*E);return v-=h*E,m-=h*E,ie(t,B,C,d,d,0,v/o,m/o,x,c,u,_)},arc:(t,e,s,i,r,n,o,a,h,l)=>ie(t,e,s,i,i,0,r,n,o,a,h,l),ellipse(t,e,s,i,r,n,l,d,c,u,_,p){const g=n*o,f=Wt(g),y=Ut(g);let v=l*o,m=d*o;v>Yt&&(v-=a),m<0&&(m+=a);let w=m-v;w<0?w+=a:w>a&&(w-=a),c&&(w-=a);const x=Ft(zt(w/h)),E=w/x,b=Wt(E/4),B=8/3*b*b/Wt(E/2);m=v+E;let C,R,T,k,P,L,O,S,D=Ut(v),M=Wt(v),I=T=y*i*D-f*r*M,A=k=f*i*D+y*r*M,W=e+T,U=s+k;t&&t.push(qt,W,U),u&&jt(u,W,U),p&&Gt(p,W,U);for(let n=0;n<x;n++)C=Ut(m),R=Wt(m),T=y*i*C-f*r*R,k=f*i*C+y*r*R,P=e+I-B*(y*i*M+f*r*D),L=s+A-B*(f*i*M-y*r*D),O=e+T+B*(y*i*R+f*r*C),S=s+k+B*(f*i*R-y*r*C),t&&t.push(Zt,P,L,O,S,e+T,s+k),u&&se(e+I,s+A,P,L,O,S,e+T,s+k,u,!0),I=T,A=k,D=C,M=R,v=m,m+=E;_&&Gt(_,e+T,s+k)},quadraticCurveTo(t,e,s,i,r,n,o){t.push(Zt,(e+2*i)/3,(s+2*r)/3,(n+2*i)/3,(o+2*r)/3,n,o)},toTwoPointBoundsByQuadraticCurve(t,e,s,i,r,n,o,a){se(t,e,(t+2*s)/3,(e+2*i)/3,(r+2*s)/3,(n+2*i)/3,r,n,o,a)},toTwoPointBounds(t,e,s,i,r,n,o,a,h,l){const d=[];let c,u,_,p,g,f,y,v,m=t,w=s,x=r,E=o;for(let t=0;t<2;++t)if(1==t&&(m=e,w=i,x=n,E=a),c=-3*m+9*w-9*x+3*E,u=6*m-12*w+6*x,_=3*w-3*m,Math.abs(c)<1e-12){if(Math.abs(u)<1e-12)continue;p=-_/u,0<p&&p<1&&d.push(p)}else y=u*u-4*_*c,v=Math.sqrt(y),y<0||(g=(-u+v)/(2*c),0<g&&g<1&&d.push(g),f=(-u-v)/(2*c),0<f&&f<1&&d.push(f));l?Vt(h,t,e):jt(h,t,e),Vt(h,o,a);for(let l=0,c=d.length;l<c;l++)ee(d[l],t,e,s,i,r,n,o,a,Jt),Vt(h,Jt.x,Jt.y)},getPointAndSet(t,e,s,i,r,n,o,a,h,l){const d=1-t,c=d*d*d,u=3*d*d*t,_=3*d*t*t,p=t*t*t;l.x=c*e+u*i+_*n+p*a,l.y=c*s+u*r+_*o+p*h},getPoint(t,e,s,i,r,n,o,a,h){const l={};return ee(t,e,s,i,r,n,o,a,h,l),l}},{getPointAndSet:ee,toTwoPointBounds:se,ellipse:ie}=te,{sin:re,cos:ne,sqrt:oe,atan2:ae}=Math,{ellipse:he}=te,le={ellipticalArc(t,e,s,i,r,n,h,l,d,c,u){const _=(d-e)/2,p=(c-s)/2,g=n*o,f=re(g),y=ne(g),v=-y*_-f*p,m=-y*p+f*_,w=i*i,x=r*r,E=m*m,b=v*v,B=w*x-w*E-x*b;let C=0;if(B<0){const t=oe(1-B/(w*x));i*=t,r*=t}else C=(h===l?-1:1)*oe(B/(w*E+x*b));const R=C*i*m/r,T=-C*r*v/i,k=ae((m-T)/r,(v-R)/i),P=ae((-m-T)/r,(-v-R)/i);let L=P-k;0===l&&L>0?L-=a:1===l&&L<0&&(L+=a);const O=e+_+y*R-f*T,S=s+p+f*R+y*T,D=L<0?1:0;u?he(t,O,S,i,r,n,k/o,P/o,D):i!==r||n?t.push(Pt.G,O,S,i,r,n,k/o,P/o,D):t.push(Pt.O,O,S,i,k/o,P/o,D)}},{M:de,m:ce,L:ue,l:_e,H:pe,h:ge,V:fe,v:ye,C:ve,c:me,S:we,s:xe,Q:Ee,q:be,T:Be,t:Ce,A:Re,a:Te,Z:ke,z:Pe,N:Le,D:Oe,X:Se,G:De,F:Me,O:Ie,P:Ae,U:We}=Pt,{rect:Ue,roundRect:Ne,arcTo:Fe,arc:ze,ellipse:Ye,quadraticCurveTo:Xe}=te,{ellipticalArc:He}=le,je=Z.get("PathConvert"),Ve={},Ge={current:{dot:0},stringify(t){let e,s,i,r=0,n=t.length,o="";for(;r<n;){s=t[r],e=It[s],o+=s===i?" ":Mt[s];for(let s=1;s<e;s++)o+=t[r+s],s===e-1||(o+=" ");i=s,r+=e}return o},parse(t,e){let s,i,r,n="";const o=[],a=e?St:Ot;for(let e=0,h=t.length;e<h;e++)i=t[e],q[i]?("."===i&&(Ke.dot++,Ke.dot>1&&(qe(o,n),n="")),n+=i):Pt[i]?(n&&(qe(o,n),n=""),Ke.name=Pt[i],Ke.length=Lt[i],Ke.index=0,qe(o,Ke.name),!s&&a[i]&&(s=!0)):"-"===i||"+"===i?"e"===r||"E"===r?n+=i:(n&&qe(o,n),n=i):n&&(qe(o,n),n=""),r=i;return n&&qe(o,n),s?Ge.toCanvasData(o,e):o},toCanvasData(t,e){let s,i,r,n,o,a=0,h=0,l=0,d=0,c=0,u=t.length;const _=[];for(;c<u;){switch(r=t[c],r){case ce:t[c+1]+=a,t[c+2]+=h;case de:a=t[c+1],h=t[c+2],_.push(de,a,h),c+=3;break;case ge:t[c+1]+=a;case pe:a=t[c+1],_.push(ue,a,h),c+=2;break;case ye:t[c+1]+=h;case fe:h=t[c+1],_.push(ue,a,h),c+=2;break;case _e:t[c+1]+=a,t[c+2]+=h;case ue:a=t[c+1],h=t[c+2],_.push(ue,a,h),c+=3;break;case xe:t[c+1]+=a,t[c+2]+=h,t[c+3]+=a,t[c+4]+=h,r=we;case we:o=n===ve||n===we,l=o?2*a-s:t[c+1],d=o?2*h-i:t[c+2],s=t[c+1],i=t[c+2],a=t[c+3],h=t[c+4],_.push(ve,l,d,s,i,a,h),c+=5;break;case me:t[c+1]+=a,t[c+2]+=h,t[c+3]+=a,t[c+4]+=h,t[c+5]+=a,t[c+6]+=h,r=ve;case ve:s=t[c+3],i=t[c+4],a=t[c+5],h=t[c+6],_.push(ve,t[c+1],t[c+2],s,i,a,h),c+=7;break;case Ce:t[c+1]+=a,t[c+2]+=h,r=Be;case Be:o=n===Ee||n===Be,s=o?2*a-s:t[c+1],i=o?2*h-i:t[c+2],e?Xe(_,a,h,s,i,t[c+1],t[c+2]):_.push(Ee,s,i,t[c+1],t[c+2]),a=t[c+1],h=t[c+2],c+=3;break;case be:t[c+1]+=a,t[c+2]+=h,t[c+3]+=a,t[c+4]+=h,r=Ee;case Ee:s=t[c+1],i=t[c+2],e?Xe(_,a,h,s,i,t[c+3],t[c+4]):_.push(Ee,s,i,t[c+3],t[c+4]),a=t[c+3],h=t[c+4],c+=5;break;case Te:t[c+6]+=a,t[c+7]+=h;case Re:He(_,a,h,t[c+1],t[c+2],t[c+3],t[c+4],t[c+5],t[c+6],t[c+7],e),a=t[c+6],h=t[c+7],c+=8;break;case Pe:case ke:_.push(ke),c++;break;case Le:a=t[c+1],h=t[c+2],e?Ue(_,a,h,t[c+3],t[c+4]):Ze(_,t,c,5),c+=5;break;case Oe:a=t[c+1],h=t[c+2],e?Ne(_,a,h,t[c+3],t[c+4],[t[c+5],t[c+6],t[c+7],t[c+8]]):Ze(_,t,c,9),c+=9;break;case Se:a=t[c+1],h=t[c+2],e?Ne(_,a,h,t[c+3],t[c+4],t[c+5]):Ze(_,t,c,6),c+=6;break;case De:Ye(e?_:Ze(_,t,c,9),t[c+1],t[c+2],t[c+3],t[c+4],t[c+5],t[c+6],t[c+7],t[c+8],null,Ve),a=Ve.x,h=Ve.y,c+=9;break;case Me:e?Ye(_,t[c+1],t[c+2],t[c+3],t[c+4],0,0,360,!1):Ze(_,t,c,5),a=t[c+1]+t[c+3],h=t[c+2],c+=5;break;case Ie:ze(e?_:Ze(_,t,c,7),t[c+1],t[c+2],t[c+3],t[c+4],t[c+5],t[c+6],null,Ve),a=Ve.x,h=Ve.y,c+=7;break;case Ae:e?ze(_,t[c+1],t[c+2],t[c+3],0,360,!1):Ze(_,t,c,4),a=t[c+1]+t[c+3],h=t[c+2],c+=4;break;case We:Fe(e?_:Ze(_,t,c,6),a,h,t[c+1],t[c+2],t[c+3],t[c+4],t[c+5],null,Ve),a=Ve.x,h=Ve.y,c+=6;break;default:return je.error(`command: ${r} [index:${c}]`,t),_}n=r}return _},copyData(t,e,s,i){for(let r=s,n=s+i;r<n;r++)t.push(e[r])},pushData(t,e){Ke.index===Ke.length&&(Ke.index=1,t.push(Ke.name)),t.push(Number(e)),Ke.index++,Ke.dot=0}},{current:Ke,pushData:qe,copyData:Ze}=Ge,{M:Qe,L:$e,C:Je,Q:ts,Z:es,N:ss,D:is,X:rs,G:ns,F:os,O:as,P:hs,U:ls}=Pt,ds={},cs={beginPath(t){t.length=0},moveTo(t,e,s){t.push(Qe,e,s)},lineTo(t,e,s){t.push($e,e,s)},bezierCurveTo(t,e,s,i,r,n,o){t.push(Je,e,s,i,r,n,o)},quadraticCurveTo(t,e,s,i,r){t.push(ts,e,s,i,r)},closePath(t){t.push(es)},rect(t,e,s,i,r){t.push(ss,e,s,i,r)},roundRect(t,e,s,i,r,o){if("number"==typeof o)t.push(rs,e,s,i,r,o);else{const a=n.fourNumber(o);a?t.push(is,e,s,i,r,...a):t.push(ss,e,s,i,r)}},ellipse(t,e,s,i,r,n,o,a,h){void 0===n?t.push(os,e,s,i,r):(void 0===o&&(o=0),void 0===a&&(a=360),t.push(ns,e,s,i,r,n,o,a,h?1:0))},arc(t,e,s,i,r,n,o){void 0===r?t.push(hs,e,s,i):(void 0===n&&(n=360),t.push(as,e,s,i,r,n,o?1:0))},arcTo(t,e,s,i,r,n){t.push(ls,e,s,i,r,n)},drawEllipse(t,e,s,i,r,n,o,a,h){void 0===n&&(n=0),void 0===o&&(o=0),void 0===a&&(a=360),te.ellipse(null,e,s,i,r,n,o,a,h,null,null,ds),t.push(Qe,ds.x,ds.y),us(t,e,s,i,r,n,o,a,h)},drawArc(t,e,s,i,r,n,o){void 0===r&&(r=0),void 0===n&&(n=360),te.arc(null,e,s,i,r,n,o,null,null,ds),t.push(Qe,ds.x,ds.y),_s(t,e,s,i,r,n,o)},drawPoints(t,e,s,i){te.points(t,e,s,i)}},{ellipse:us,arc:_s}=cs,{moveTo:ps,lineTo:gs,quadraticCurveTo:fs,bezierCurveTo:ys,closePath:vs,beginPath:ms,rect:ws,roundRect:xs,ellipse:Es,arc:bs,arcTo:Bs,drawEllipse:Cs,drawArc:Rs,drawPoints:Ts}=cs;class ks{constructor(t){this.path=t?"string"==typeof t?Tt.parse(t):t:[]}beginPath(){return ms(this.path),this}moveTo(t,e){return ps(this.path,t,e),this}lineTo(t,e){return gs(this.path,t,e),this}bezierCurveTo(t,e,s,i,r,n){return ys(this.path,t,e,s,i,r,n),this}quadraticCurveTo(t,e,s,i){return fs(this.path,t,e,s,i),this}closePath(){return vs(this.path),this}rect(t,e,s,i){return ws(this.path,t,e,s,i),this}roundRect(t,e,s,i,r){return xs(this.path,t,e,s,i,r),this}ellipse(t,e,s,i,r,n,o,a){return Es(this.path,t,e,s,i,r,n,o,a),this}arc(t,e,s,i,r,n){return bs(this.path,t,e,s,i,r,n),this}arcTo(t,e,s,i,r){return Bs(this.path,t,e,s,i,r),this}drawEllipse(t,e,s,i,r,n,o,a){return Cs(this.path,t,e,s,i,r,n,o,a),this}drawArc(t,e,s,i,r,n){return Rs(this.path,t,e,s,i,r,n),this}drawPoints(t,e,s){return Ts(this.path,t,e,s),this}}const{M:Ps,L:Ls,C:Os,Q:Ss,Z:Ds,N:Ms,D:Is,X:As,G:Ws,F:Us,O:Ns,P:Fs,U:zs}=Pt,Ys=Z.get("PathDrawer"),Xs={drawPathByData(t,e){if(!e)return;let s,i=0,r=e.length;for(;i<r;)switch(s=e[i],s){case Ps:t.moveTo(e[i+1],e[i+2]),i+=3;break;case Ls:t.lineTo(e[i+1],e[i+2]),i+=3;break;case Os:t.bezierCurveTo(e[i+1],e[i+2],e[i+3],e[i+4],e[i+5],e[i+6]),i+=7;break;case Ss:t.quadraticCurveTo(e[i+1],e[i+2],e[i+3],e[i+4]),i+=5;break;case Ds:t.closePath(),i+=1;break;case Ms:t.rect(e[i+1],e[i+2],e[i+3],e[i+4]),i+=5;break;case Is:t.roundRect(e[i+1],e[i+2],e[i+3],e[i+4],[e[i+5],e[i+6],e[i+7],e[i+8]]),i+=9;break;case As:t.roundRect(e[i+1],e[i+2],e[i+3],e[i+4],e[i+5]),i+=6;break;case Ws:t.ellipse(e[i+1],e[i+2],e[i+3],e[i+4],e[i+5]*o,e[i+6]*o,e[i+7]*o,e[i+8]),i+=9;break;case Us:t.ellipse(e[i+1],e[i+2],e[i+3],e[i+4],0,0,a,!1),i+=5;break;case Ns:t.arc(e[i+1],e[i+2],e[i+3],e[i+4]*o,e[i+5]*o,e[i+6]),i+=7;break;case Fs:t.arc(e[i+1],e[i+2],e[i+3],0,a,!1),i+=4;break;case zs:t.arcTo(e[i+1],e[i+2],e[i+3],e[i+4],e[i+5]),i+=6;break;default:return void Ys.error(`command: ${s} [index:${i}]`,e)}}},{M:Hs,L:js,C:Vs,Q:Gs,Z:Ks,N:qs,D:Zs,X:Qs,G:$s,F:Js,O:ti,P:ei,U:si}=Pt,{toTwoPointBounds:ii,toTwoPointBoundsByQuadraticCurve:ri,arcTo:ni,arc:oi,ellipse:ai}=te,{add:hi,copy:li,addPoint:di,setPoint:ci,addBounds:ui,toBounds:_i}=L,pi=Z.get("PathBounds");let gi,fi,yi;const vi={},mi={},wi={},xi={toBounds(t,e){xi.toTwoPointBounds(t,mi),_i(mi,e)},toTwoPointBounds(t,e){if(!t||!t.length)return ci(e,0,0);let s,i,r,n,o,a=0,h=0,l=0;const d=t.length;for(;a<d;)switch(s=t[a],0===a&&(s===Ks||s===Vs||s===Gs?ci(e,h,l):ci(e,t[a+1],t[a+2])),s){case Hs:case js:h=t[a+1],l=t[a+2],di(e,h,l),a+=3;break;case Vs:n=t[a+5],o=t[a+6],ii(h,l,t[a+1],t[a+2],t[a+3],t[a+4],n,o,vi),hi(e,vi),h=n,l=o,a+=7;break;case Gs:i=t[a+1],r=t[a+2],n=t[a+3],o=t[a+4],ri(h,l,i,r,n,o,vi),hi(e,vi),h=n,l=o,a+=5;break;case Ks:a+=1;break;case qs:h=t[a+1],l=t[a+2],ui(e,h,l,t[a+3],t[a+4]),a+=5;break;case Zs:case Qs:h=t[a+1],l=t[a+2],ui(e,h,l,t[a+3],t[a+4]),a+=s===Zs?9:6;break;case $s:ai(null,t[a+1],t[a+2],t[a+3],t[a+4],t[a+5],t[a+6],t[a+7],t[a+8],vi,wi),0===a?li(e,vi):hi(e,vi),h=wi.x,l=wi.y,a+=9;break;case Js:h=t[a+1],l=t[a+2],fi=t[a+3],yi=t[a+4],ui(e,h-fi,l-yi,2*fi,2*yi),h+=fi,a+=5;break;case ti:oi(null,t[a+1],t[a+2],t[a+3],t[a+4],t[a+5],t[a+6],vi,wi),0===a?li(e,vi):hi(e,vi),h=wi.x,l=wi.y,a+=7;break;case ei:h=t[a+1],l=t[a+2],gi=t[a+3],ui(e,h-gi,l-gi,2*gi,2*gi),h+=gi,a+=4;break;case si:ni(null,h,l,t[a+1],t[a+2],t[a+3],t[a+4],t[a+5],vi,wi),0===a?li(e,vi):hi(e,vi),h=wi.x,l=wi.y,a+=6;break;default:return void pi.error(`command: ${s} [index:${a}]`,t)}}},Ei={smooth:(t,e,s)=>t};Tt.creator=new ks,Tt.parse=Ge.parse,Tt.convertToCanvasData=Ge.toCanvasData;const{drawRoundRect:bi}=At;function Bi(t){!function(t){t&&!t.roundRect&&(t.roundRect=function(t,e,s,i,r){bi(this,t,e,s,i,r)})}(t)}const Ci=Z.get("TaskProcessor");class Ri{constructor(t){this.parallel=!0,this.time=1,this.id=i.create(i.TASK),this.task=t}run(){return ft(this,void 0,void 0,(function*(){try{this.task&&!this.isComplete&&this.parent.running&&(yield this.task())}catch(t){Ci.error(t)}}))}complete(){this.isComplete=!0,this.parent=null,this.task=null}cancel(){this.isCancel=!0,this.complete()}}class Ti{get total(){return this.list.length+this.delayNumber}get finishedIndex(){return this.isComplete?0:this.index+this.parallelSuccessNumber}get remain(){return this.isComplete?this.total:this.total-this.finishedIndex}get percent(){const{total:t}=this;let e=0,s=0;for(let i=0;i<t;i++)i<=this.finishedIndex?(s+=this.list[i].time,i===this.finishedIndex&&(e=s)):e+=this.list[i].time;return this.isComplete?1:s/e}constructor(t){this.config={parallel:6},this.list=[],this.running=!1,this.isComplete=!0,this.index=0,this.delayNumber=0,t&&ct.assign(this.config,t),this.empty()}add(t,e){let s,i,r,n;const o=new Ri(t);return o.parent=this,"number"==typeof e?n=e:e&&(i=e.parallel,s=e.start,r=e.time,n=e.delay),r&&(o.time=r),!1===i&&(o.parallel=!1),void 0===n?this.push(o,s):(this.delayNumber++,setTimeout((()=>{this.delayNumber--,this.push(o,s)}),n)),this.isComplete=!1,o}push(t,e){this.list.push(t),!1===e||this.timer||(this.timer=setTimeout((()=>this.start())))}empty(){this.index=0,this.parallelSuccessNumber=0,this.list=[],this.parallelList=[]}start(){this.running||(this.running=!0,this.isComplete=!1,this.run())}pause(){clearTimeout(this.timer),this.timer=null,this.running=!1}resume(){this.start()}skip(){this.index++,this.resume()}stop(){this.isComplete=!0,this.list.forEach((t=>{t.isComplete||t.cancel()})),this.pause(),this.empty()}run(){this.running&&(this.setParallelList(),this.parallelList.length>1?this.runParallelTasks():this.remain?this.runTask():this.onComplete())}runTask(){const t=this.list[this.index];t?t.run().then((()=>{this.onTask(t),this.index++,this.nextTask()})).catch((t=>{this.onError(t)})):this.nextTask()}runParallelTasks(){this.parallelList.forEach((t=>this.runParallelTask(t)))}runParallelTask(t){t.run().then((()=>{this.onTask(t),this.fillParallelTask()})).catch((t=>{this.onParallelError(t)}))}nextTask(){this.total===this.finishedIndex?this.onComplete():this.timer=setTimeout((()=>this.run()))}setParallelList(){let t;this.parallelList=[],this.parallelSuccessNumber=0;let e=this.index+this.config.parallel;e>this.list.length&&(e=this.list.length);for(let s=this.index;s<e&&(t=this.list[s],t.parallel);s++)this.parallelList.push(t)}fillParallelTask(){let t;const e=this.parallelList;this.parallelSuccessNumber++,e.pop();const s=e.length,i=this.finishedIndex+s;if(e.length){if(!this.running)return;i<this.total&&(t=this.list[i],t&&t.parallel&&(e.push(t),this.runParallelTask(t)))}else this.index+=this.parallelSuccessNumber,this.parallelSuccessNumber=0,this.nextTask()}onComplete(){this.stop(),this.config.onComplete&&this.config.onComplete()}onTask(t){t.complete(),this.config.onTask&&this.config.onTask()}onParallelError(t){this.parallelList.forEach((t=>{t.parallel=!1})),this.parallelList.length=0,this.parallelSuccessNumber=0,this.onError(t)}onError(t){this.pause(),this.config.onError&&this.config.onError(t)}destroy(){this.stop()}}const ki={map:{},recycledList:[],tasker:new Ti,patternTasker:new Ti,get isComplete(){return Pi.tasker.isComplete&&Pi.patternTasker.isComplete},get(t){let e=Pi.map[t.url];return e||(e=s.image(t),Pi.map[t.url]=e),e.use++,e},recycle(t){t.use--,setTimeout((()=>{t.use||Pi.recycledList.push(t)}))},clearRecycled(){const t=Pi.recycledList;t.length&&(t.forEach((t=>{!t.use&&t.url&&(delete Pi.map[t.url],t.destroy())})),t.length=0)},destroy(){Pi.map={}}},Pi=ki,{IMAGE:Li,create:Oi}=i;class Si{get url(){return this.config.url}get completed(){return this.ready||!!this.error}constructor(t){this.use=0,this.waitComplete=[],this.innerId=Oi(Li),this.config=t||{url:""};const{url:e}=t;e.startsWith("data:")?e.startsWith("data:image/svg")&&(this.isSVG=!0):e.includes(".svg")&&(this.isSVG=!0),"svg"===this.config.format&&(this.isSVG=!0)}load(t,s){return this.loading||(this.loading=!0,ki.tasker.add((()=>ft(this,void 0,void 0,(function*(){return yield e.origin.loadImage(this.url).then((t=>{this.ready=!0,this.width=t.naturalWidth||t.width,this.height=t.naturalHeight||t.height,this.view=t,this.onComplete(!0)})).catch((t=>{this.error=t,this.onComplete(!1)}))}))))),this.waitComplete.push(t,s),this.waitComplete.length-2}unload(t,e){const s=this.waitComplete;if(e){const e=s[t+1];e&&e({type:"stop"})}s[t]=s[t+1]=void 0}onComplete(t){let e;this.waitComplete.forEach(((s,i)=>{e=i%2,s&&(t?e||s(this):e&&s(this.error))})),this.waitComplete.length=0,this.loading=!1}getCanvas(t,s,i,r){t||(t=this.width),s||(s=this.height);const n=e.origin.createCanvas(t,s),o=n.getContext("2d");return i&&(o.globalAlpha=i),o.drawImage(this.view,0,0,t,s),n}destroy(){this.config={url:""},this.waitComplete.length=0}}class Di{constructor(t,e){this.bubbles=!1,this.type=t,e&&(this.target=e)}stopDefault(){this.isStopDefault=!0}stopNow(){this.isStopNow=!0,this.isStop=!0}stop(){this.isStop=!0}}class Mi extends Di{constructor(t,e,s){super(t,e),this.parent=s,this.child=e}}Mi.ADD="child.add",Mi.REMOVE="child.remove";class Ii extends Di{constructor(t,e,s,i,r){super(t,e),this.attrName=s,this.oldValue=i,this.newValue=r}}Ii.CHANGE="property.change";class Ai extends Di{constructor(t,e){super(t),Object.assign(this,e)}}Ai.LOAD="image.load",Ai.LOADED="image.loaded",Ai.ERROR="image.error";class Wi extends Di{get bigger(){if(!this.old)return!0;const{width:t,height:e}=this.old;return this.width>=t&&this.height>=e}get smaller(){return!this.bigger}get samePixelRatio(){return!this.old||this.pixelRatio===this.old.pixelRatio}constructor(t,e){"object"==typeof t?(super(Wi.RESIZE),Object.assign(this,t)):super(t),this.old=e}}Wi.RESIZE="resize";class Ui extends Di{constructor(t,e){super(t),e&&Object.assign(this,e)}}Ui.START="transform.start",Ui.CHANGE="transform.change",Ui.END="transform.end",Ui.BEFORE_START="transform.before_start",Ui.BEFORE_CHANGE="transform.before_change",Ui.BEFORE_END="transform.before_end";class Ni extends Di{constructor(t,e){super(t),this.data=e}}Ni.REQUEST="watch.request",Ni.DATA="watch.data";class Fi extends Di{constructor(t,e,s){super(t),e&&(this.data=e,this.times=s)}}Fi.CHECK_UPDATE="layout.check_update",Fi.REQUEST="layout.request",Fi.START="layout.start",Fi.BEFORE="layout.before",Fi.LAYOUT="layout.layout",Fi.AFTER="layout.after",Fi.AGAIN="layout.again",Fi.END="layout.end";class zi extends Di{}zi.FRAME="animate.frame";class Yi extends Di{constructor(t,e,s,i){super(t),e&&(this.times=e),s&&(this.renderBounds=s,this.renderOptions=i)}}Yi.REQUEST="render.request",Yi.START="render.start",Yi.BEFORE="render.before",Yi.RENDER="render",Yi.AFTER="render.after",Yi.AGAIN="render.again",Yi.END="render.end";class Xi extends Di{}Xi.START="leafer.start",Xi.BEFORE_READY="leafer.before_ready",Xi.READY="leafer.ready",Xi.AFTER_READY="leafer.after_ready",Xi.VIEW_READY="leafer.view_ready",Xi.VIEW_COMPLETED="leafer.view_completed",Xi.STOP="leafer.stop",Xi.RESTART="leafer.restart",Xi.END="leafer.end";const Hi={},ji={isHoldSpaceKey:()=>ji.isHold("Space"),isHold:t=>Hi[t],setDownCode(t){Hi[t]||(Hi[t]=!0)},setUpCode(t){Hi[t]=!1}},Vi={LEFT:1,RIGHT:2,MIDDLE:4,defaultLeft(t){t.buttons||(t.buttons=1)},left:t=>1===t.buttons,right:t=>2===t.buttons,middle:t=>4===t.buttons};class Gi extends Di{get spaceKey(){return ji.isHoldSpaceKey()}get left(){return Vi.left(this)}get right(){return Vi.right(this)}get middle(){return Vi.middle(this)}constructor(t){super(t.type),this.bubbles=!0,Object.assign(this,t)}getInner(t){return t||(t=this.current),t.getInnerPoint(this)}getLocal(t){return t||(t=this.current),t.getLocalPoint(this)}static changeName(t,e){nt.changeName(t,e)}}function Ki(t,e,s){Object.defineProperty(t,e,s)}function qi(t,e){return Object.getOwnPropertyDescriptor(t,e)}function Zi(t,e,s,i){const r={get(){return this.__getAttr(e)},set(t){this.__setAttr(e,t)},configurable:!0,enumerable:!0};Ki(t,e,Object.assign(r,i||{})),pr(t,e,s)}function Qi(t){return(e,s)=>{Zi(e,s,t)}}function $i(t){return(e,s)=>{Zi(e,s,t,{set(t){this.__setAttr(s,t),this.__layout.positionChanged||this.__layout.positionChange()}})}}function Ji(t){return(e,s)=>{Zi(e,s,t,{set(t){this.__setAttr(s,t),this.__layout.scaleChanged||this.__layout.scaleChange()}})}}function tr(t){return(e,s)=>{Zi(e,s,t,{set(t){this.__setAttr(s,t),this.__layout.rotationChanged||this.__layout.rotationChange()}})}}function er(t){return(e,s)=>{Zi(e,s,t,{set(t){this.__setAttr(s,t),this.__layout.boxChanged||this.__layout.boxChange(),this.__.around&&(this.__layout.positionChanged||this.__layout.positionChange())}})}}const sr=er;function ir(t){return(e,s)=>{Zi(e,s,t,{set(t){this.__setAttr(s,t),this.__layout.strokeChanged||this.__layout.strokeChange()}})}}const rr=ir;function nr(t){return(e,s)=>{Zi(e,s,t,{set(t){this.__setAttr(s,t),this.__layout.renderChanged||this.__layout.renderChange()}})}}function or(t){return(e,s)=>{Zi(e,s,t,{set(t){this.__setAttr(s,t),this.__layout.surfaceChanged||this.__layout.surfaceChange()}})}}function ar(t){return(e,s)=>{Zi(e,s,t,{set(t){this.__setAttr(s,t),this.__layout.opacityChanged||this.__layout.opacityChange()}})}}function hr(t){return(e,s)=>{Zi(e,s,t,{set(t){this.__setAttr(s,t),this.__layout.surfaceChanged||this.__layout.surfaceChange(),this.waitParent((()=>{this.parent.__layout.childrenSortChange()}))}})}}function lr(t){return(e,s)=>{Zi(e,s,t,{set(t){this.__setAttr(s,t),this.__layout.boxChanged||this.__layout.boxChange(),this.waitParent((()=>{this.parent.__updateMask(t)}))}})}}function dr(t){return(e,s)=>{Zi(e,s,t,{set(t){this.__setAttr(s,t),this.waitParent((()=>{this.parent.__updateEraser(t)}))}})}}function cr(t){return(e,s)=>{Zi(e,s,t,{set(t){this.__setAttr(s,t),Z.showHitView&&(this.__layout.surfaceChanged||this.__layout.surfaceChange()),this.leafer&&this.leafer.updateCursor()}})}}function ur(t){return(e,s)=>{Zi(e,s,t,{set(t){this.__setAttr(s,t),this.leafer&&this.leafer.updateCursor()}})}}function _r(t){return(e,s)=>{Ki(e,"__DataProcessor",{get:()=>t})}}function pr(t,e,s){const i=t.__DataProcessor.prototype,r="_"+e,n=function(t){return"set"+t.charAt(0).toUpperCase()+t.slice(1)}(e),o={get(){const t=this[r];return void 0===t?s:t},set(t){this[r]=t},configurable:!0,enumerable:!0};void 0===s?o.get=function(){return this[r]}:"width"===e?o.get=function(){const t=this[r];return void 0===t?this.__naturalWidth||s:t}:"height"===e&&(o.get=function(){const t=this[r];return void 0===t?this.__naturalHeight||s:t});const a=qi(i,e);a&&a.set&&(o.set=a.set),i[n]&&(o.set=i[n],delete i[n]),Object.defineProperty(i,e,o)}const gr=new Z("rewrite"),fr=[],yr=["destroy","constructor"];function vr(t){return(e,s)=>{fr.push({name:e.constructor.name+"."+s,run:()=>{e[s]=t}})}}function mr(){return t=>{wr()}}function wr(t){fr.length&&(fr.forEach((e=>{t&&gr.error(e.name,"需在Class上装饰@rewriteAble()"),e.run()})),fr.length=0)}function xr(t,e){return s=>{var i;(t.prototype?(i=t.prototype,Object.getOwnPropertyNames(i)):Object.keys(t)).forEach((i=>{if(!(yr.includes(i)||e&&e.includes(i)))if(t.prototype){qi(t.prototype,i).writable&&(s.prototype[i]=t.prototype[i])}else s.prototype[i]=t[i]}))}}function Er(){return t=>{st.register(t)}}function br(){return t=>{nt.register(t)}}setTimeout((()=>wr(!0))),t.PointerEvent=class extends Gi{},t.PointerEvent.POINTER="pointer",t.PointerEvent.BEFORE_DOWN="pointer.before_down",t.PointerEvent.BEFORE_MOVE="pointer.before_move",t.PointerEvent.BEFORE_UP="pointer.before_up",t.PointerEvent.DOWN="pointer.down",t.PointerEvent.MOVE="pointer.move",t.PointerEvent.UP="pointer.up",t.PointerEvent.OVER="pointer.over",t.PointerEvent.OUT="pointer.out",t.PointerEvent.ENTER="pointer.enter",t.PointerEvent.LEAVE="pointer.leave",t.PointerEvent.TAP="tap",t.PointerEvent.DOUBLE_TAP="double_tap",t.PointerEvent.CLICK="click",t.PointerEvent.DOUBLE_CLICK="double_click",t.PointerEvent.LONG_PRESS="long_press",t.PointerEvent.LONG_TAP="long_tap",t.PointerEvent=gt([br()],t.PointerEvent);const Br={};var Cr;t.DragEvent=class extends t.PointerEvent{getInnerMove(t,e){return t||(t=this.current),this.assignMove(e),t.getInnerPoint(Br,null,!0)}getLocalMove(t,e){return t||(t=this.current),this.assignMove(e),t.getLocalPoint(Br,null,!0)}getInnerTotal(t){return this.getInnerMove(t,!0)}getLocalTotal(t){return this.getLocalMove(t,!0)}assignMove(t){Br.x=t?this.totalX:this.moveX,Br.y=t?this.totalY:this.moveY}},t.DragEvent.BEFORE_DRAG="drag.before_drag",t.DragEvent.START="drag.start",t.DragEvent.DRAG="drag",t.DragEvent.END="drag.end",t.DragEvent.OVER="drag.over",t.DragEvent.OUT="drag.out",t.DragEvent.ENTER="drag.enter",t.DragEvent.LEAVE="drag.leave",t.DragEvent=gt([br()],t.DragEvent),t.DropEvent=Cr=class extends t.PointerEvent{static setList(t){Cr.dragList=t instanceof ht?t:new ht(t)}static setData(t){this.dragData=t}},t.DropEvent.DROP="drop",t.DropEvent=Cr=gt([br()],t.DropEvent),t.MoveEvent=class extends t.DragEvent{},t.MoveEvent.BEFORE_MOVE="move.before_move",t.MoveEvent.START="move.start",t.MoveEvent.MOVE="move",t.MoveEvent.END="move.end",t.MoveEvent=gt([br()],t.MoveEvent),t.RotateEvent=class extends Gi{},t.RotateEvent.BEFORE_ROTATE="rotate.before_rotate",t.RotateEvent.START="rotate.start",t.RotateEvent.ROTATE="rotate",t.RotateEvent.END="rotate.end",t.RotateEvent=gt([br()],t.RotateEvent),t.SwipeEvent=class extends t.DragEvent{},t.SwipeEvent.SWIPE="swipe",t.SwipeEvent.LEFT="swipe.left",t.SwipeEvent.RIGHT="swipe.right",t.SwipeEvent.UP="swipe.up",t.SwipeEvent.DOWN="swipe.down",t.SwipeEvent=gt([br()],t.SwipeEvent),t.ZoomEvent=class extends Gi{},t.ZoomEvent.BEFORE_ZOOM="zoom.before_zoom",t.ZoomEvent.START="zoom.start",t.ZoomEvent.ZOOM="zoom",t.ZoomEvent.END="zoom.end",t.ZoomEvent=gt([br()],t.ZoomEvent),t.KeyEvent=class extends Gi{},t.KeyEvent.DOWN="key.down",t.KeyEvent.HOLD="key.hold",t.KeyEvent.UP="key.up",t.KeyEvent=gt([br()],t.KeyEvent);class Rr{constructor(t){this.interaction=t}move(e){const{interaction:s}=this;if(!this.moveData){const{path:i}=s.selector.getByPoint(e,s.hitRadius);e.path=i,this.moveData=Object.assign(Object.assign({},e),{moveX:0,moveY:0}),s.emit(t.MoveEvent.START,this.moveData)}e.path=this.moveData.path,s.emit(t.MoveEvent.BEFORE_MOVE,e),s.emit(t.MoveEvent.MOVE,e),this.transformEndWait()}zoom(e){const{interaction:s}=this;if(!this.zoomData){const{path:i}=s.selector.getByPoint(e,s.hitRadius);e.path=i,this.zoomData=Object.assign(Object.assign({},e),{scale:1}),s.emit(t.ZoomEvent.START,this.zoomData)}e.path=this.zoomData.path,s.emit(t.ZoomEvent.BEFORE_ZOOM,e),s.emit(t.ZoomEvent.ZOOM,e),this.transformEndWait()}rotate(e){const{interaction:s}=this;if(!this.rotateData){const{path:i}=s.selector.getByPoint(e,s.hitRadius);e.path=i,this.rotateData=Object.assign(Object.assign({},e),{rotation:0}),s.emit(t.RotateEvent.START,this.rotateData)}e.path=this.rotateData.path,s.emit(t.RotateEvent.BEFORE_ROTATE,e),s.emit(t.RotateEvent.ROTATE,e),this.transformEndWait()}transformEndWait(){clearTimeout(this.transformTimer),this.transformTimer=setTimeout((()=>{this.transformEnd()}),this.interaction.config.pointer.transformTime)}transformEnd(){this.moveEnd(),this.zoomEnd(),this.rotateEnd(),this.transformMode=null}moveEnd(){this.moveData&&(this.interaction.emit(t.MoveEvent.END,this.moveData),this.moveData=null)}zoomEnd(){this.zoomData&&(this.interaction.emit(t.ZoomEvent.END,this.zoomData),this.zoomData=null)}rotateEnd(){this.rotateData&&(this.interaction.emit(t.RotateEvent.END,this.rotateData),this.rotateData=null)}destroy(){this.zoomData=this.moveData=this.rotateData=null}}const{copy:Tr,translate:kr,toInnerPoint:Pr,scaleOfOuter:Lr,rotateOfOuter:Or,skewOfOuter:Sr}=y,Dr={},Mr={updateAllWorldMatrix(t){if(t.__updateWorldMatrix(),t.isBranch){const{children:e}=t;for(let t=0,s=e.length;t<s;t++)Ar(e[t])}},updateAllWorldOpacity(t){if(t.__updateWorldOpacity(),t.isBranch){const{children:e}=t;for(let t=0,s=e.length;t<s;t++)Wr(e[t])}},updateAllChange(t){if(Wr(t),t.__updateChange(),t.isBranch){const{children:e}=t;for(let t=0,s=e.length;t<s;t++)Ur(e[t])}},worldHittable(t){if(!t.__.hittable)return!1;let{parent:e}=t;for(;e;){if(!e.__.hittable||!e.__.hitChildren)return!1;e=e.parent}return!0},moveWorld(t,e,s){t.__layout.checkUpdate();const i={x:e,y:s};t.parent&&Pr(t.parent.__world,i,i,!0),Ir.moveLocal(t,i.x,i.y)},moveLocal(t,e,s=0){t.x+=e,t.y+=s},zoomOfWorld(t,e,s,i,r){t.__layout.checkUpdate();const n=t.parent?R.tempToInnerOf(e,t.parent.__world):e;this.zoomOfLocal(t,n,s,i,r)},zoomOfLocal(t,e,s,i=s,r){Tr(Dr,t.__local),r&&kr(Dr,r.x,r.y),Lr(Dr,e,s,i),r||(r=t),r.x+=Dr.e-t.__local.e,r.y+=Dr.f-t.__local.f,t.scaleX*=s,t.scaleY*=i},rotateOfWorld(t,e,s,i){t.__layout.checkUpdate();const r=t.parent?R.tempToInnerOf(e,t.parent.__world):e;this.rotateOfLocal(t,r,s,i)},rotateOfLocal(t,e,s,i){Tr(Dr,t.__local),i&&kr(Dr,i.x,i.y),Or(Dr,e,s),i||(i=t),i.x+=Dr.e-t.__local.e,i.y+=Dr.f-t.__local.f,t.rotation=n.formatRotation(t.rotation+s)},skewOfWorld(t,e,s,i,r){t.__layout.checkUpdate();const n=t.parent?R.tempToInnerOf(e,t.parent.__world):e;this.skewOfLocal(t,n,s,i,r)},skewOfLocal(t,e,s,i,r){Tr(Dr,t.__local),r&&kr(Dr,r.x,r.y),Sr(Dr,e,s,i),r||(r=t),r.x=Dr.e-t.__local.e,r.y=Dr.f-t.__local.f,t.skewX=n.formatSkew(t.skewX+s),t.skewY=n.formatSkew(t.skewY+i)},drop(t,e){const s={x:t.x,y:t.y};t.localToWorld(s),e.worldToInner(s),t.set(s),e.add(t)}},Ir=Mr,{updateAllWorldMatrix:Ar,updateAllWorldOpacity:Wr,updateAllChange:Ur}=Ir,Nr={worldBounds:t=>t.__world,localBoxBounds:t=>t.__.isEraser?null:t.__local,localEventBounds:t=>t.__.isEraser?null:t.__layout.localStrokeBounds,localRenderBounds:t=>t.__.isEraser?null:t.__layout.localRenderBounds,maskLocalBoxBounds:t=>t.__.isMask?t.__local:null,maskLocalEventBounds:t=>t.__.isMask?t.__layout.localStrokeBounds:null,maskLocalRenderBounds:t=>t.__.isMask?t.__layout.localRenderBounds:null},Fr={sort:(t,e)=>t.__.zIndex===e.__.zIndex?t.__tempNumber-e.__tempNumber:t.__.zIndex-e.__.zIndex,pushAllChildBranch(t,e){if(t.__tempNumber=1,t.__.__childBranchNumber){const{children:s}=t;for(let i=0,r=s.length;i<r;i++)(t=s[i]).isBranch&&(t.__tempNumber=1,e.push(t),zr(t,e))}},pushAllParent(t,e){const{keys:s}=e;if(s)for(;t.parent&&void 0===s[t.parent.innerId];)e.push(t.parent),t=t.parent;else for(;t.parent;)e.push(t.parent),t=t.parent},pushAllBranchStack(t,e){let s=e.length;const{children:i}=t;for(let t=0,s=i.length;t<s;t++)i[t].isBranch&&e.push(i[t]);for(let t=s,i=e.length;t<i;t++)Yr(e[t],e)},updateWorldBoundsByBranchStack(t){let e;for(let s=t.length-1;s>-1;s--){e=t[s];for(let t=0,s=e.children.length;t<s;t++)e.children[t].__updateWorldBounds()}e.__updateWorldBounds()}},{pushAllChildBranch:zr,pushAllBranchStack:Yr}=Fr,Xr={run(t){for(let e=0,s=t.length;e<s;e++)t[e]();t.length=0}},Hr={getMoveEventData:(t,e,s)=>Object.assign(Object.assign({},s),{x:t.x,y:t.y,moveX:e.x,moveY:e.y}),getRotateEventData:(t,e,s)=>Object.assign(Object.assign({},s),{x:t.x,y:t.y,rotation:e}),getZoomEventData:(t,e,s)=>Object.assign(Object.assign({},s),{x:t.x,y:t.y,scale:e}),getDragEventData:(t,e,s)=>Object.assign(Object.assign({},s),{x:s.x,y:s.y,moveX:s.x-e.x,moveY:s.y-e.y,totalX:s.x-t.x,totalY:s.y-t.y}),getDropEventData:(t,e,s)=>Object.assign(Object.assign({},t),{list:e,data:s}),getSwipeDirection:e=>e<-45&&e>-135?t.SwipeEvent.UP:e>45&&e<135?t.SwipeEvent.DOWN:e<=45&&e>=-45?t.SwipeEvent.RIGHT:t.SwipeEvent.LEFT,getSwipeEventData:(t,e,s)=>Object.assign(Object.assign({},s),{moveX:e.moveX,moveY:e.moveY,totalX:s.x-t.x,totalY:s.y-t.y,type:jr.getSwipeDirection(R.getAngle(t,s))}),getBase:t=>({altKey:t.altKey,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,metaKey:t.metaKey,buttons:void 0===t.buttons?1:t.buttons,origin:t}),pathHasEventType(t,e){const{list:s}=t;for(let t=0,i=s.length;t<i;t++)if(s[t].hasEvent(e))return!0;return!1},filterPathByEventType(t,e){const s=new ht,{list:i}=t;for(let t=0,r=i.length;t<r;t++)i[t].hasEvent(e)&&s.push(i[t]);return s}},jr=Hr,{getDragEventData:Vr,getDropEventData:Gr,getSwipeEventData:Kr,filterPathByEventType:qr}=Hr;class Zr{constructor(t){this.interaction=t}setDragData(t){this.dragData=Vr(t,t,t)}getDragList(){return this.dragging?t.DropEvent.dragList||this.dragList:null}checkDrag(e,s){const{interaction:i}=this,{downData:r}=i;if(this.moving&&!Vi.middle(e)&&!Vi.left(e))return void i.pointerCancel();const{dragData:n}=this;if(!this.moving){const o=i.config.move.dragEmpty&&r.target.isLeafer;this.moving=(Vi.middle(e)||i.moveMode||o)&&s,this.moving&&i.emit(t.MoveEvent.START,n)}this.moving||this.dragStart(e,s);const{path:o,throughPath:a}=r;this.dragData=Vr(r,n,e),a&&(this.dragData.throughPath=a),this.dragData.path=o,this.moving?(i.emit(t.MoveEvent.BEFORE_MOVE,this.dragData),i.emit(t.MoveEvent.MOVE,this.dragData)):this.dragging&&(this.dragDragableList(),i.emit(t.DragEvent.BEFORE_DRAG,this.dragData),i.emit(t.DragEvent.DRAG,this.dragData))}dragStart(e,s){this.dragging||(this.dragging=Vi.left(e)&&s,this.dragging&&(this.interaction.emit(t.DragEvent.START,this.dragData),this.getDragableList(this.dragData.path),this.dragList=qr(this.dragData.path,t.DragEvent.DRAG),!this.dragList.length&&this.dragableList&&this.dragList.pushList(this.dragableList)))}getDragableList(t){let e;for(let s=0,i=t.length;s<i;s++)if(e=t.list[s],e.__.draggable&&e.__.hitSelf){this.dragableList=[e];break}}dragDragableList(){const{running:t}=this.interaction;if(this.dragableList&&t){const{moveX:t,moveY:e}=this.dragData;this.dragableList.forEach((s=>{Mr.moveWorld(s,t,e)}))}}dragOverOrOut(e){const{interaction:s}=this,{dragOverPath:i}=this,{path:r}=e;i?r.indexAt(0)!==i.indexAt(0)&&(s.emit(t.DragEvent.OUT,e,i),s.emit(t.DragEvent.OVER,e,r)):s.emit(t.DragEvent.OVER,e,r),this.dragOverPath=r}dragEnterOrLeave(e){const{interaction:s}=this,{dragEnterPath:i}=this,{path:r}=e;s.emit(t.DragEvent.LEAVE,e,i,r),s.emit(t.DragEvent.ENTER,e,r,i),this.dragEnterPath=r}dragEnd(e){const{interaction:s}=this,{downData:i}=s;if(!i)return;const{path:r,throughPath:n}=i,o=Vr(i,e,e);n&&(o.throughPath=n),o.path=r,this.moving&&s.emit(t.MoveEvent.END,o),this.dragging&&(s.emit(t.DragEvent.END,o),this.swipe(e,o),this.drop(e)),this.autoMoveCancel(),this.dragReset()}swipe(t,e){const{interaction:s}=this,{downData:i}=s;if(R.getDistance(i,t)>s.config.pointer.swipeDistance){const t=Kr(i,this.dragData,e);this.interaction.emit(t.type,t)}}drop(e){const s=Gr(e,this.getDragList(),t.DropEvent.dragData);s.path=this.dragEnterPath,this.interaction.emit(t.DropEvent.DROP,s),this.interaction.emit(t.DragEvent.LEAVE,e,this.dragEnterPath)}dragReset(){t.DropEvent.dragList=null,this.dragList=null,this.dragableList=null,this.dragData=null,this.dragOverPath=null,this.dragEnterPath=null,this.dragging=null,this.moving=null}checkDragOut(t){const{interaction:e}=this;this.autoMoveCancel(),this.dragging&&!e.shrinkCanvasBounds.hitPoint(t)&&this.autoMoveOnDragOut(t)}autoMoveOnDragOut(t){const{interaction:e}=this,{downData:s}=e,{autoDistance:i,dragOut:r}=e.config.move;if(!r||!i)return;const n=e.shrinkCanvasBounds,{x:o,y:a}=n,h=X.right(n),l=X.bottom(n),d=t.x<o?i:h<t.x?-i:0,c=t.y<a?i:l<t.y?-i:0;let u=0,_=0;this.autoMoveTimer=setInterval((()=>{u+=d,_+=c,R.move(s,d,c),R.move(this.dragData,d,c),e.move(Object.assign(Object.assign({},t),{moveX:d,moveY:c,totalX:u,totalY:_})),e.pointerMoveReal(t)}),10)}autoMoveCancel(){this.autoMoveTimer&&(clearInterval(this.autoMoveTimer),this.autoMoveTimer=0)}destroy(){this.dragReset()}}const Qr=["move","zoom","rotate","key"];function $r(t,e,s,i,r){if(Qr.some((t=>e.startsWith(t)))&&t.__.hitChildren&&!tn(t,r)){let n;for(let o=0,a=t.children.length;o<a;o++)n=t.children[o],!s.path.has(n)&&n.__.hittable&&Jr(n,e,s,i,r)}}function Jr(t,e,s,i,r){if(t.destroyed)return!0;if(t.__.hitSelf&&t.hasEvent(e,i)&&!tn(t,r)){s.phase=i?1:t===s.target?2:3;const r=nt.get(e,s);if(t.emitEvent(r,i),r.isStop)return!0}return!1}function tn(t,e){return e&&e.has(t)}const en={getData(t){const e=t[0],s=t[1],i=R.getCenter(e.from,s.from),r=R.getCenter(e.to,s.to),n={x:r.x-i.x,y:r.y-i.y},o=R.getDistance(e.from,s.from);return{move:n,scale:R.getDistance(e.to,s.to)/o,angle:R.getChangeAngle(e.from,s.from,e.to,s.to),center:r}}},{pathHasEventType:sn,getMoveEventData:rn,getZoomEventData:nn,getRotateEventData:on}=Hr;class an{get dragging(){return this.dragger.dragging}get moveMode(){return ji.isHoldSpaceKey()&&this.config.move.holdSpaceKey||this.downData&&Vi.middle(this.downData)}get hitRadius(){return this.config.pointer.hitRadius}constructor(t,s,i,r){this.config={wheel:{zoomMode:!1,zoomSpeed:.5,moveSpeed:.5,rotateSpeed:.5,delta:"Windows"===e.os?{x:37.5,y:37.5}:{x:20,y:8},preventDefault:!0},pointer:{hitRadius:5,through:!1,tapTime:120,longPressTime:800,transformTime:500,dragHover:!0,dragDistance:2,swipeDistance:20,ignoreMove:!1},cursor:{}},this.tapCount=0,this.downKeyMap={},this.target=t,this.canvas=s,this.selector=i,this.defaultPath=new ht(t),this.transformer=new Rr(this),this.dragger=new Zr(this),r&&(this.config=ct.default(r,this.config)),this.__listenEvents()}start(){this.running=!0}stop(){this.running=!1}receive(t){}pointerDown(e,s){e||(e=this.hoverData),e&&(Vi.defaultLeft(e),this.emit(t.PointerEvent.BEFORE_DOWN,e,this.defaultPath),this.updateDownData(e),s&&(e.path=this.defaultPath),this.emit(t.PointerEvent.DOWN,e),this.downTime=Date.now(),this.dragger.setDragData(e),Vi.left(e)&&(this.tapWait(),this.longPressWait(e)),this.updateCursor(e))}pointerMove(t){if(t||(t=this.hoverData),!t)return;this.downData&&Vi.defaultLeft(t);const e=this.canvas.bounds.hitPoint(t);(e||this.downData)&&(e&&!this.downData&&Vi.left(t)&&this.pointerDown(t,!0),this.pointerMoveReal(t),this.dragger.checkDragOut(t))}pointerMoveReal(e){if(this.emit(t.PointerEvent.BEFORE_MOVE,e,this.defaultPath),this.downData){const t=R.getDistance(this.downData,e)>this.config.pointer.dragDistance;this.waitTap&&t&&this.pointerWaitCancel(),this.dragger.checkDrag(e,t)}this.dragger.moving||this.config.pointer.ignoreMove||(this.updateHoverData(e),this.emit(t.PointerEvent.MOVE,e),this.pointerOverOrOut(e),this.pointerEnterOrLeave(e),this.dragger.dragging&&(this.dragger.dragOverOrOut(e),this.dragger.dragEnterOrLeave(e)),this.updateCursor(e))}pointerUp(e){e||(e=this.downData),this.downData&&(Vi.defaultLeft(e),this.emit(t.PointerEvent.BEFORE_UP,e,this.defaultPath),this.findPath(e),this.emit(t.PointerEvent.UP,e),this.emit(t.PointerEvent.UP,this.downData,void 0,e.path),this.touchLeave(e),this.tap(e),this.dragger.dragEnd(e),this.downData=null,this.updateCursor(e))}pointerCancel(){this.pointerUp(this.dragger.dragData)}multiTouch(t,e){const{move:s,angle:i,scale:r,center:n}=en.getData(e);this.rotate(on(n,i,t)),this.zoom(nn(n,r,t)),this.move(rn(n,s,t))}move(t){this.transformer.move(t)}zoom(t){this.transformer.zoom(t)}rotate(t){this.transformer.rotate(t)}transformEnd(){this.transformer.transformEnd()}keyDown(e){const{code:s}=e;this.downKeyMap[s]||(this.downKeyMap[s]=!0,ji.setDownCode(s),this.emit(t.KeyEvent.HOLD,e,this.defaultPath),this.moveMode&&this.updateCursor()),this.emit(t.KeyEvent.DOWN,e,this.defaultPath)}keyUp(e){const{code:s}=e;this.downKeyMap[s]=!1,ji.setUpCode(s),this.emit(t.KeyEvent.UP,e,this.defaultPath),"grab"===this.cursor&&this.updateCursor()}pointerOverOrOut(e){if(this.dragger.moving)return;if(this.dragging&&!this.config.pointer.dragHover)return;const{path:s}=e;this.overPath?s.indexAt(0)!==this.overPath.indexAt(0)&&(this.emit(t.PointerEvent.OUT,e,this.overPath),this.emit(t.PointerEvent.OVER,e,s)):this.emit(t.PointerEvent.OVER,e,s),this.overPath=s}pointerEnterOrLeave(e){if(this.dragger.moving)return;if(this.dragging&&!this.config.pointer.dragHover)return;const{path:s}=e;this.emit(t.PointerEvent.LEAVE,e,this.enterPath,s),this.emit(t.PointerEvent.ENTER,e,s,this.enterPath),this.enterPath=s}touchLeave(e){"touch"===e.pointerType&&this.enterPath&&(this.emit(t.PointerEvent.LEAVE,e),this.dragger.dragging&&this.emit(t.DropEvent.LEAVE,e))}tap(e){const{pointer:s}=this.config,i=this.longTap(e);if(!s.tapMore&&i)return;if(!this.waitTap)return;s.tapMore&&this.emitTap(e);const r=Date.now()-this.downTime,n=[t.PointerEvent.DOUBLE_TAP,t.PointerEvent.DOUBLE_CLICK].some((t=>sn(e.path,t)));r<s.tapTime+50&&n?(this.tapCount++,2===this.tapCount?(this.tapWaitCancel(),this.emitDoubleTap(e)):(clearTimeout(this.tapTimer),this.tapTimer=setTimeout((()=>{s.tapMore||(this.tapWaitCancel(),this.emitTap(e))}),s.tapTime))):s.tapMore||(this.tapWaitCancel(),this.emitTap(e))}findPath(t,e){const{hitRadius:s,through:i}=this.config.pointer,r=this.selector.getByPoint(t,s,e||{through:i});return r.throughPath&&(t.throughPath=r.throughPath),t.path=r.path,r.path}updateDownData(t){t||(t=this.downData),t&&(this.findPath(t),this.downData=t)}updateHoverData(e){e||(e=this.hoverData),e&&(this.findPath(e,{exclude:this.dragger.getDragList(),name:t.PointerEvent.MOVE}),this.hoverData=e)}updateCursor(t){if(this.config.cursor.stop)return;if(t||(this.updateHoverData(),t=this.hoverData),this.dragger.moving)return this.setCursor("grabbing");if(this.moveMode)return this.setCursor(this.downData?"grabbing":"grab");if(!t||this.dragger.dragging)return;let e,s;const{path:i}=t;for(let t=0,r=i.length;t<r&&(e=i.list[t],s=e.cursor,!s);t++);this.setCursor(s)}setCursor(t){this.cursor=t,this.canvas.setCursor(t)}emitTap(e){this.emit(t.PointerEvent.TAP,e),this.emit(t.PointerEvent.CLICK,e)}emitDoubleTap(e){this.emit(t.PointerEvent.DOUBLE_TAP,e),this.emit(t.PointerEvent.DOUBLE_CLICK,e)}pointerWaitCancel(){this.tapWaitCancel(),this.longPressWaitCancel()}tapWait(){clearTimeout(this.tapTimer),this.waitTap=!0}tapWaitCancel(){clearTimeout(this.tapTimer),this.waitTap=!1,this.tapCount=0}longPressWait(e){clearTimeout(this.longPressTimer),this.longPressTimer=setTimeout((()=>{this.longPressed=!0,this.emit(t.PointerEvent.LONG_PRESS,e)}),this.config.pointer.longPressTime)}longTap(e){let s;return this.longPressed&&(this.emit(t.PointerEvent.LONG_TAP,e),sn(e.path,t.PointerEvent.LONG_TAP)&&(s=!0)),this.longPressWaitCancel(),s}longPressWaitCancel(){clearTimeout(this.longPressTimer),this.longPressed=!1}__onResize(){this.shrinkCanvasBounds=new G(this.canvas.bounds),this.shrinkCanvasBounds.spread(-2)}__listenEvents(){const{target:t}=this;this.__eventIds=[t.on_(Wi.RESIZE,this.__onResize,this)],t.once(Xi.READY,(()=>this.__onResize()))}__removeListenEvents(){this.target.off_(this.__eventIds),this.__eventIds.length=0}emit(t,e,s,i){this.running&&function(t,e,s,i){if(!s&&!e.path)return;let r;e.type=t,s?e=Object.assign(Object.assign({},e),{path:s}):s=e.path,e.target=s.indexAt(0);for(let n=s.length-1;n>-1;n--){if(r=s.list[n],Jr(r,t,e,!0,i))return;r.isApp&&$r(r,t,e,!0,i)}for(let n=0,o=s.length;n<o;n++)if(r=s.list[n],r.isApp&&$r(r,t,e,!1,i),Jr(r,t,e,!1,i))return}(t,e,s,i)}destroy(){this.__eventIds.length&&(this.stop(),this.__removeListenEvents(),this.dragger.destroy(),this.transformer.destroy(),this.downData=this.overPath=this.enterPath=null)}}class hn{static set(t,e){this.custom[t]=e}static get(t){return this.custom[t]}}hn.custom={};const{toOuterOf:ln}=X;class dn{constructor(t){this.leaf=t,this.renderBounds=this.strokeBounds=this.boxBounds={x:0,y:0,width:0,height:0},this.localRenderBounds=this.localStrokeBounds=t.__local,this.boxChange(),this.positionChange()}checkUpdate(t){const{leafer:s}=this.leaf;if(s)s.ready?(e.realtimeLayout||t)&&s.watcher.changed&&s.layouter.layout():s.start();else{let t=this.leaf;for(;t.parent;)t=t.parent;e.layout(t)}}getTransform(t){return this.checkUpdate(),"world"===t?this.leaf.__world:this.leaf.__local}getBounds(t,e){if(this.checkUpdate(),"world"===e)switch(t){case"render":return this.leaf.__world;case"content":if(this.contentBounds)return this.getWorldContentBounds();case"margin":case"box":return this.getWorldBoxBounds();case"margin":case"stroke":return this.getWorldStrokeBounds()}else if("inner"===e)switch(t){case"render":return this.renderBounds;case"content":if(this.contentBounds)return this.contentBounds;case"margin":case"box":return this.boxBounds;case"stroke":return this.strokeBounds}else switch(t){case"render":return this.localRenderBounds;case"margin":case"content":case"box":return this.leaf.__local;case"stroke":return this.localStrokeBounds}}getWorldContentBounds(){return this._worldContentBounds||(this._worldContentBounds={}),ln(this.contentBounds,this.leaf.__world,this._worldContentBounds),this._worldContentBounds}getWorldBoxBounds(){return this._worldBoxBounds||(this._worldBoxBounds={}),ln(this.boxBounds,this.leaf.__world,this._worldBoxBounds),this._worldBoxBounds}getWorldStrokeBounds(){return this._worldStrokeBounds||(this._worldStrokeBounds={}),ln(this.strokeBounds,this.leaf.__world,this._worldStrokeBounds),this._worldStrokeBounds}spreadStrokeCancel(){const t=this.renderBounds===this.strokeBounds;this.strokeBounds=this.boxBounds,this.localStrokeBounds=this.leaf.__local,t&&this.spreadRenderCancel()}spreadRenderCancel(){this.renderBounds=this.strokeBounds,this.localRenderBounds=this.localStrokeBounds}spreadStroke(){const{x:t,y:e,width:s,height:i}=this.strokeBounds;this.strokeBounds={x:t,y:e,width:s,height:i},this.localStrokeBounds={x:t,y:e,width:s,height:i},this.renderSpread||this.spreadRenderCancel()}spreadRender(){const{x:t,y:e,width:s,height:i}=this.renderBounds;this.renderBounds={x:t,y:e,width:s,height:i},this.localRenderBounds={x:t,y:e,width:s,height:i}}boxChange(){this.boxChanged=!0,this.localBoxChanged||this.localBoxChange(),this.hitCanvasChanged=!0}localBoxChange(){this.localBoxChanged=!0,this.boundsChanged=!0}strokeChange(){this.strokeChanged=!0,this.strokeSpread||(this.strokeSpread=1),this.boundsChanged=!0,this.hitCanvasChanged=!0}renderChange(){this.renderChanged=!0,this.renderSpread||(this.renderSpread=1),this.boundsChanged=!0}positionChange(){this.positionChanged=!0,this.matrixChanged=!0,this.localBoxChanged||this.localBoxChange()}scaleChange(){this.scaleChanged=!0,this._scaleOrRotationChange()}rotationChange(){this.rotationChanged=!0,this.affectRotation=!0,this._scaleOrRotationChange()}_scaleOrRotationChange(){this.affectScaleOrRotation=!0,this.matrixChanged=!0,this.localBoxChanged||this.localBoxChange()}surfaceChange(){this.surfaceChanged=!0}opacityChange(){this.opacityChanged=!0,this.surfaceChanged||this.surfaceChange()}childrenSortChange(){this.childrenSortChanged||(this.childrenSortChanged=!0,this.leaf.forceUpdate("surface"))}destroy(){}}const cn={},un={on(t,e,s){let i,r,n;s&&("boolean"==typeof s?i=s:(i=s.capture,r=s.once));const o=_n(this,i,!0),a="string"==typeof t?t.split(" "):t,h=r?{listener:e,once:r}:{listener:e};a.forEach((t=>{t&&(n=o[t],n?-1===n.findIndex((t=>t.listener===e))&&n.push(h):o[t]=[h])}))},off(t,e,s){let i,r,n;s&&(i="boolean"==typeof s?s:s.capture);const o=_n(this,i);("string"==typeof t?t.split(" "):t).forEach((t=>{t&&(r=o[t],r&&(n=r.findIndex((t=>t.listener===e)),n>-1&&r.splice(n,1),r.length||delete o[t]))}))},on_(t,e,s,i){return s&&(e=e.bind(s)),this.on(t,e,i),{type:t,listener:e,options:i}},off_(t){if(!t)return;const e=t instanceof Array?t:[t];e.forEach((t=>this.off(t.type,t.listener,t.options))),e.length=0},once(t,e,s){this.on(t,e,{once:!0,capture:s})},emit(t,e,s){!e&&nt.has(t)&&(e=nt.get(t,{type:t,target:this,current:this}));const i=_n(this,s)[t];if(i){let r;for(let n=0,o=i.length;n<o&&(r=i[n],r.listener(e),r.once&&(this.off(t,r.listener,s),n--,o--),!e||!e.isStopNow);n++);}},emitEvent(t,e){t.current=this,this.emit(t.type,t,e)},hasEvent(t,e){const{__bubbleMap:s,__captureMap:i}=this;return void 0===e?!!(i&&i[t]||s&&s[t]):!!(e?i&&i[t]:s&&s[t])}};function _n(t,e,s){if(e){const{__captureMap:e}=t;return e||(s?t.__captureMap={}:cn)}{const{__bubbleMap:e}=t;return e||(s?t.__bubbleMap={}:cn)}}const pn={__setAttr(t,e){if(this.leafer&&this.leafer.created){if("object"==typeof e||this.__.__getInput(t)!==e){this.__[t]=e;const{CHANGE:s}=Ii,i=new Ii(s,this,t,this.__.__get(t),e);this.hasEvent(s)&&!this.isLeafer&&this.emitEvent(i),this.leafer.emitEvent(i)}}else this.__[t]=e},__getAttr(t){return this.__.__get(t)}},{sin:gn,cos:fn}=Math,yn=Object.assign(Object.assign({},y.defaultMatrix),{scaleX:1,scaleY:1,rotation:0,skewX:0,skewY:0}),vn={x:.5,y:.5},mn={__updateWorldMatrix(){const t=this.parent?this.parent.__world:yn,e=this.__local,s=this.__world;if(this.__layout.matrixChanged&&this.__updateLocalMatrix(),this.__layout.affectScaleOrRotation){s.a=e.a*t.a+e.b*t.c,s.b=e.a*t.b+e.b*t.d,s.c=e.c*t.a+e.d*t.c,s.d=e.c*t.b+e.d*t.d,s.e=e.e*t.a+e.f*t.c+t.e,s.f=e.e*t.b+e.f*t.d+t.f;const i=this.__;s.scaleX=t.scaleX*i.scaleX,s.scaleY=t.scaleY*i.scaleY,s.rotation=t.rotation+i.rotation,s.skewX=t.skewX+i.skewX,s.skewY=t.skewY+i.skewY}else s.a=t.a,s.b=t.b,s.c=t.c,s.d=t.d,s.e=e.e*t.a+e.f*t.c+t.e,s.f=e.e*t.b+e.f*t.d+t.f,s.scaleX=t.scaleX,s.scaleY=t.scaleY,s.rotation=t.rotation,s.skewX=t.skewX,s.skewY=t.skewY},__updateLocalMatrix(){const t=this.__local,e=this.__layout;if(e.affectScaleOrRotation){const{scaleX:s,scaleY:i}=this.__;if(e.affectRotation){if(e.scaleChanged||e.rotationChanged){let{rotation:r,skewX:n,skewY:a}=this.__;r||n||a?(r*=o,n&&(n*=o),a&&(a*=o),t.a=s*fn(r+a),t.b=s*gn(r+a),t.c=i*-gn(r-n),t.d=i*fn(r-n)):(t.a=s,t.b=0,t.c=0,t.d=i,e.affectRotation=!1),e.scaleChanged=!1,e.rotationChanged=!1}}else e.scaleChanged&&(t.a=s,t.d=i,e.scaleChanged=!1)}if(e.positionChanged){t.e=this.__.x,t.f=this.__.y;const{width:s,height:i,around:r}=this.__;if(r&&s&&i){const e="center"===r?vn:r,n=s*e.x,o=i*e.y;t.e-=n*t.a+o*t.c,t.f-=n*t.b+o*t.d}e.positionChanged=!1}this.__layout.matrixChanged=!1}},{toOuterOf:wn,copyAndSpread:xn}=X,En={__updateWorldBounds(){var t;if(this.__layout.boundsChanged){let e;const s=this.__layout;s.boxChanged&&(this.__updatePath(),this.__updateRenderPath(),this.__updateBoxBounds(),s.boxChanged=!1,e=!0),s.localBoxChanged&&(this.__updateLocalBoxBounds(),s.localBoxChanged=!1,s.strokeSpread&&(s.strokeChanged=!0),s.renderSpread&&(s.renderChanged=!0),null===(t=this.parent)||void 0===t||t.__layout.boxChange()),s.strokeChanged&&(s.strokeSpread=this.__updateStrokeSpread(),s.strokeSpread?(s.strokeBounds===s.boxBounds&&s.spreadStroke(),this.__updateStrokeBounds(),this.__updateLocalStrokeBounds()):s.spreadStrokeCancel(),s.strokeChanged=!1,s.renderSpread&&(s.renderChanged=!0),this.parent&&this.parent.__layout.strokeChange(),e||(e=!0)),s.renderChanged&&(s.renderSpread=this.__updateRenderSpread(),s.renderSpread?(s.renderBounds!==s.boxBounds&&s.renderBounds!==s.strokeBounds||s.spreadRender(),this.__updateRenderBounds(),this.__updateLocalRenderBounds()):s.spreadRenderCancel(),s.renderChanged=!1,this.parent&&this.parent.__layout.renderChange()),s.boundsChanged=!1,wn(this.__layout.renderBounds,this.__world,this.__world),e&&this.__onUpdateSize()}else wn(this.__layout.renderBounds,this.__world,this.__world)},__updateLocalBoxBounds(){wn(this.__layout.boxBounds,this.__local,this.__local)},__updateLocalStrokeBounds(){wn(this.__layout.strokeBounds,this.__local,this.__layout.localStrokeBounds)},__updateLocalRenderBounds(){wn(this.__layout.renderBounds,this.__local,this.__layout.localRenderBounds)},__updateBoxBounds(){const t=this.__layout.boxBounds,{width:e,height:s}=this.__;t.x=0,t.y=0,t.width=e,t.height=s},__updateNaturalSize(){const{__:t,__layout:e}=this;t.__naturalWidth=e.boxBounds.width,t.__naturalHeight=e.boxBounds.height,this.around&&(e.positionChanged=e.matrixChanged=!0,this.__updateWorldMatrix())},__updateStrokeBounds(){xn(this.__layout.strokeBounds,this.__layout.boxBounds,this.__layout.strokeSpread)},__updateRenderBounds(){xn(this.__layout.renderBounds,this.__layout.strokeBounds,this.__layout.renderSpread)}},{toInnerRadiusPointOf:bn,copy:Bn,setRadius:Cn}=R,Rn={},Tn={__hitWorld(t){return!this.__layout.hitCanvasChanged&&this.__hitCanvas||(this.__updateHitCanvas(),this.__layout.hitCanvasChanged=!1),this.__.hitRadius&&(Bn(Rn,t),Cn(t=Rn,this.__.hitRadius)),bn(t,this.__world,Rn),this.__hit(Rn)},__drawHitPath(t){this.__drawRenderPath(t)}},kn={__render(t,e){if(this.__worldOpacity)if(t.setWorld(this.__world,e.matrix),t.opacity=this.__worldOpacity,this.__.__single){const s=t.getSameCanvas(!0);this.__draw(s,e);const i=this.__.isEraser?"destination-out":this.__.blendMode;this.__hasMirror||e.matrix?t.copyWorldByReset(s,null,null,i):t.copyWorldToInner(s,this.__world,this.__layout.renderBounds,i),s.recycle()}else this.__draw(t,e)},__updateWorldOpacity(){this.__worldOpacity=this.__.visible?this.parent?this.parent.__worldOpacity*this.__.opacity:this.__.opacity:0,this.__layout.opacityChanged&&(this.__layout.opacityChanged=!1)}},Pn={__updateEraser(t){this.__hasEraser=!!t||this.children.some((t=>t.__.isEraser))},__updateMask(t){this.__hasMask=!!t||this.children.some((t=>t.__.isMask))},__renderMask(t,e,s){e.resetTransform(),e.useMask(s),t.resetTransform(),t.opacity=this.__worldOpacity,t.copyWorld(e)},__removeMask(t){if(t)t.isMask=!1,this.remove(t);else{const{children:e}=this;for(let s=0,i=e.length;s<i;s++)(t=e[s]).isMask&&(this.__removeMask(t),i--,s--)}}},Ln={__updateChange(){const{__layout:t}=this;t.childrenSortChanged&&(this.__updateSortChildren(),t.childrenSortChanged=!1),this.__.__checkSingle()},__render(t,e){if(this.__worldOpacity)if(this.__.__single){t.resetTransform();const s=t.getSameCanvas();this.__renderBranch(s,e),t.opacity=this.__worldOpacity;const i=this.__.isEraser?"destination-out":this.__.blendMode;this.__hasMirror||e.matrix?t.copyWorld(s,null,null,i):t.copyWorld(s,this.__world,this.__world,i),s.recycle()}else this.__renderBranch(t,e)},__renderBranch(t,e){let s;const{children:i}=this;if(this.__hasMask&&i.length>1){let r,n=t.getSameCanvas(),o=t.getSameCanvas();for(let a=0,h=i.length;a<h;a++)s=i[a],s.isMask?(r?(this.__renderMask(t,o,n),n.clear(),o.clear()):r=!0,s.__render(n,e)):s.__render(o,e);this.__renderMask(t,o,n),n.recycle(),o.recycle()}else{const{bounds:r,hideBounds:n}=e;for(let o=0,a=i.length;o<a;o++)s=i[o],r&&!r.hit(s.__world,e.matrix)||n&&n.includes(s.__world,e.matrix)||s.__render(t,e)}}},{LEAF:On,create:Sn}=i,{toInnerPoint:Dn,toOuterPoint:Mn}=y,{tempToOuterOf:In,copy:An}=R,{moveLocal:Wn,zoomOfLocal:Un,rotateOfLocal:Nn,skewOfLocal:Fn}=Mr;t.Leaf=class{get tag(){return this.__tag}set tag(t){}get __tag(){return"Leaf"}get innerName(){return this.__.name||this.tag+this.innerId}get __DataProcessor(){return _t}get __LayoutProcessor(){return dn}get worldTransform(){return this.__layout.getTransform("world")}get localTransform(){return this.__layout.getTransform("local")}get boxBounds(){return this.getBounds("box","inner")}get worldBoxBounds(){return this.getBounds("box")}get worldStrokeBounds(){return this.getBounds("stroke")}get worldRenderBounds(){return this.getBounds("render")}get worldOpacity(){return this.__layout.checkUpdate(),this.__worldOpacity}get resizeable(){return!0}get __hasMirror(){return this.__world.scaleX<0||this.__world.scaleY<0}get __onlyHitMask(){return this.__hasMask&&!this.__.hitChildren}get __ignoreHitWorld(){return(this.__hasMask||this.__hasEraser)&&this.__.hitChildren}constructor(t){this.innerId=Sn(On),this.__world={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0,scaleX:1,scaleY:1,rotation:0,skewX:0,skewY:0},this.__local={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0},this.__worldOpacity=1,this.__=new this.__DataProcessor(this),this.__layout=new this.__LayoutProcessor(this),t&&(t.children?this.set(t):Object.assign(this,t))}waitParent(t){this.parent?t():this.__parentWait?this.__parentWait.push(t):this.__parentWait=[t]}waitLeafer(t){this.leafer?t():this.__leaferWait?this.__leaferWait.push(t):this.__leaferWait=[t]}nextRender(t){this.leafer?this.leafer.nextRender(t):this.waitLeafer((()=>this.leafer.nextRender(t)))}__bindLeafer(t){if(this.isLeafer&&null!==t&&(t=this),this.leafer=t,t&&(this.__level=this.parent?this.parent.__level+1:1,this.__leaferWait&&Xr.run(this.__leaferWait)),this.isBranch){const{children:e}=this;for(let s=0,i=e.length;s<i;s++)e[s].__bindLeafer(t)}}set(t){}toJSON(){return this.__.__getInputData()}toString(){return JSON.stringify(this.toJSON())}__setAttr(t,e){}__getAttr(t){}forceUpdate(t){void 0===t?t="scaleX":"surface"===t&&(t="blendMode");const e=this.__.__getInput(t);this.__[t]=void 0===e?null:void 0,this[t]=e}__updateWorldMatrix(){}__updateLocalMatrix(){}__updateWorldBounds(){}__updateLocalBoxBounds(){}__updateLocalStrokeBounds(){}__updateLocalRenderBounds(){}__updateBoxBounds(){}__updateStrokeBounds(){}__updateRenderBounds(){}__updateNaturalSize(){}__updateStrokeSpread(){return 0}__updateRenderSpread(){return 0}__onUpdateSize(){}__updateEraser(t){}__updateMask(t){}__renderMask(t,e,s){}__removeMask(t){}getWorld(t){return this.__layout.checkUpdate(),"x"===t?this.__world.e:"y"===t?this.__world.f:this.__world[t]}getBounds(t,e="world"){return this.__layout.getBounds(t,e)}worldToLocal(t,e,s,i){this.parent?this.parent.worldToInner(t,e,s,i):e&&An(e,t)}localToWorld(t,e,s,i){this.parent?this.parent.innerToWorld(t,e,s,i):e&&An(e,t)}worldToInner(t,e,s,i){i&&(i.innerToWorld(t,e,s),t=e||t),Dn(this.worldTransform,t,e,s)}innerToWorld(t,e,s,i){Mn(this.worldTransform,t,e,s),i&&i.worldToInner(e||t,null,s)}getInnerPoint(t,e,s,i){const r=i?t:{};return this.worldToInner(t,r,s,e),r}getInnerPointByLocal(t,e,s,i){return this.getInnerPoint(t,this.parent,s,i)}getLocalPoint(t,e,s,i){const r=i?t:{};return this.worldToLocal(t,r,s,e),r}getLocalPointByInner(t,e,s,i){return this.getWorldPoint(t,this.parent,s,i)}getWorldPoint(t,e,s,i){const r=i?t:{};return this.innerToWorld(t,r,s,e),r}getWorldPointByLocal(t,e,s,i){const r=i?t:{};return this.localToWorld(t,r,s,e),r}move(t,e){Wn(this,t,e)}scaleOf(t,e,s){Un(this,In(t,this.localTransform),e,s)}rotateOf(t,e){Nn(this,In(t,this.localTransform),e)}skewOf(t,e,s){Fn(this,In(t,this.localTransform),e,s)}__hitWorld(t){return!0}__hit(t){return!0}__drawHitPath(t){}__updateHitCanvas(){}__render(t,e){}__drawFast(t,e){}__draw(t,e){}__renderShape(t,e){}__updateWorldOpacity(){}__updateChange(){}__drawPath(t){}__drawRenderPath(t){}__updatePath(){}__updateRenderPath(){}__updateSortChildren(){}add(t,e){}remove(t,e){this.parent&&this.parent.remove(this,e)}on(t,e,s){}off(t,e,s){}on_(t,e,s,i){}off_(t){}once(t,e,s){}emit(t,e,s){}emitEvent(t,e){}hasEvent(t,e){return!1}destroy(){this.destroyed||(this.parent&&this.remove(),this.children&&this.removeAll(!0),this.__.destroy(),this.__layout.destroy(),this.__captureMap=this.__bubbleMap=this.__parentWait=this.__leaferWait=null,this.destroyed=!0)}},t.Leaf=gt([xr(pn),xr(mn),xr(En),xr(Tn),xr(un),xr(kn)],t.Leaf);const{setByListWithHandle:zn}=X,{sort:Yn}=Fr,{localBoxBounds:Xn,localEventBounds:Hn,localRenderBounds:jn,maskLocalBoxBounds:Vn,maskLocalEventBounds:Gn,maskLocalRenderBounds:Kn}=Nr;t.Branch=class extends t.Leaf{constructor(){super(),this.isBranch=!0,this.children=[]}__updateStrokeSpread(){const{children:t}=this;for(let e=0,s=t.length;e<s;e++)if(t[e].__layout.strokeSpread)return 1;return 0}__updateRenderSpread(){const{children:t}=this;for(let e=0,s=t.length;e<s;e++)if(t[e].__layout.renderSpread)return 1;return 0}__updateBoxBounds(){zn(this.__layout.boxBounds,this.children,this.__hasMask?Vn:Xn)}__updateStrokeBounds(){zn(this.__layout.strokeBounds,this.children,this.__hasMask?Gn:Hn)}__updateRenderBounds(){zn(this.__layout.renderBounds,this.children,this.__hasMask?Kn:jn)}__updateSortChildren(){let t;const{children:e}=this;if(e.length>1){for(let s=0,i=e.length;s<i;s++)e[s].__tempNumber=s,e[s].__.zIndex&&(t=!0);e.sort(Yn),this.__layout.affectChildrenSort=t}}add(t,e){t.parent&&t.parent.remove(t),t.parent=this,void 0===e?this.children.push(t):this.children.splice(e,0,t),t.isBranch&&(this.__.__childBranchNumber=(this.__.__childBranchNumber||0)+1),t.__layout.boundsChanged||t.__layout.positionChange(),t.__parentWait&&Xr.run(t.__parentWait),this.leafer&&(t.__bindLeafer(this.leafer),this.leafer.created&&this.__emitChildEvent(Mi.ADD,t)),this.__layout.affectChildrenSort&&this.__layout.childrenSortChange()}addMany(...t){t.forEach((t=>this.add(t)))}remove(t,e){if(t){const s=this.children.indexOf(t);s>-1&&(this.children.splice(s,1),t.isBranch&&(this.__.__childBranchNumber=(this.__.__childBranchNumber||1)-1),this.__preRemove(),this.__realRemoveChild(t),e&&t.destroy())}else void 0===t&&super.remove(null,e)}removeAll(t){const{children:e}=this;e.length&&(this.children=[],this.__preRemove(),this.__.__childBranchNumber=0,e.forEach((e=>{this.__realRemoveChild(e),t&&e.destroy()})))}__preRemove(){this.__hasMask&&this.__updateMask(),this.__hasEraser&&this.__updateEraser(),this.__layout.boxChange(),this.__layout.affectChildrenSort&&this.__layout.childrenSortChange()}__realRemoveChild(t){t.parent=null,this.leafer&&(t.__bindLeafer(null),this.leafer.created&&(this.__emitChildEvent(Mi.REMOVE,t),this.leafer.hitCanvasManager&&this.leafer.hitCanvasManager.clear()))}__emitChildEvent(t,e){const s=new Mi(t,e,this);e.hasEvent(t)&&e.emitEvent(s),this.hasEvent(t)&&!this.isLeafer&&this.emitEvent(s),this.leafer.emitEvent(s)}},t.Branch=gt([xr(Ln),xr(Pn)],t.Branch);const qn=Z.get("plugin"),Zn={power:{},list:[],onLeafer(t){Zn.list.forEach((e=>{e.onLeafer&&e.onLeafer(t)}))}};class Qn{get childrenChanged(){return this.hasAdd||this.hasRemove||this.hasVisible}get updatedList(){if(this.hasRemove){const t=new ht;return this.__updatedList.list.forEach((e=>{e.leafer&&t.push(e)})),t}return this.__updatedList}constructor(t,e){this.totalTimes=0,this.config={},this.__updatedList=new ht,this.target=t,e&&(this.config=ct.default(e,this.config)),this.__listenEvents()}start(){this.disabled||(this.running=!0)}stop(){this.running=!1}disable(){this.stop(),this.__removeListenEvents(),this.disabled=!0}update(){this.changed=!0,this.running&&this.target.emit(Yi.REQUEST)}__onAttrChange(t){this.__updatedList.push(t.target),this.update()}__onChildEvent(t){t.type===Mi.ADD?(this.hasAdd=!0,this.__pushChild(t.child)):(this.hasRemove=!0,this.__updatedList.push(t.parent)),this.update()}__pushChild(t){this.__updatedList.push(t),t.isBranch&&this.__loopChildren(t)}__loopChildren(t){const{children:e}=t;for(let t=0,s=e.length;t<s;t++)this.__pushChild(e[t])}__onRquestData(){this.target.emitEvent(new Ni(Ni.DATA,{updatedList:this.updatedList})),this.__updatedList=new ht,this.totalTimes++,this.changed=!1,this.hasVisible=!1,this.hasRemove=!1,this.hasAdd=!1}__listenEvents(){const{target:t}=this;this.__eventIds=[t.on_(Ii.CHANGE,this.__onAttrChange,this),t.on_([Mi.ADD,Mi.REMOVE],this.__onChildEvent,this),t.on_(Ni.REQUEST,this.__onRquestData,this)]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.target=null,this.__updatedList=null)}}const{updateAllWorldMatrix:$n,updateAllWorldOpacity:Jn}=Mr,{pushAllChildBranch:to,pushAllParent:eo}=Fr;const{worldBounds:so}=Nr,{setByListWithHandle:io}=X;class ro{constructor(t){this.updatedBounds=new G,this.beforeBounds=new G,this.afterBounds=new G,t instanceof Array&&(t=new ht(t)),this.updatedList=t}setBefore(){io(this.beforeBounds,this.updatedList.list,so)}setAfter(){io(this.afterBounds,this.updatedList.list,so),this.updatedBounds.setByList([this.beforeBounds,this.afterBounds])}merge(t){this.updatedList.pushList(t.updatedList.list),this.beforeBounds.add(t.beforeBounds),this.afterBounds.add(t.afterBounds),this.updatedBounds.add(t.updatedBounds)}destroy(){this.updatedList=null}}const{updateAllWorldMatrix:no,updateAllChange:oo}=Mr,{pushAllBranchStack:ao,updateWorldBoundsByBranchStack:ho}=Fr,lo=Z.get("Layouter");class co{constructor(t,e){this.totalTimes=0,this.config={},this.__levelList=new lt,this.target=t,e&&(this.config=ct.default(e,this.config)),this.__listenEvents()}start(){this.disabled||(this.running=!0)}stop(){this.running=!1}disable(){this.stop(),this.__removeListenEvents(),this.disabled=!0}layout(){if(!this.running)return;const{target:t}=this;this.times=0;try{t.emit(Fi.START),this.layoutOnce(),t.emitEvent(new Fi(Fi.END,this.layoutedBlocks,this.times))}catch(t){lo.error(t)}this.layoutedBlocks=null}layoutAgain(){this.layouting?this.waitAgain=!0:this.layoutOnce()}layoutOnce(){return this.layouting?lo.warn("layouting"):this.times>3?lo.warn("layout max times"):(this.times++,this.totalTimes++,this.layouting=!0,this.target.emit(Ni.REQUEST),this.totalTimes>1?this.partLayout():this.fullLayout(),this.layouting=!1,void(this.waitAgain&&(this.waitAgain=!1,this.layoutOnce())))}partLayout(){var t;if(!(null===(t=this.__updatedList)||void 0===t?void 0:t.length))return;const e=J.start("PartLayout"),{target:s,__updatedList:i}=this,{BEFORE:r,LAYOUT:n,AFTER:o}=Fi,a=this.getBlocks(i);a.forEach((t=>{t.setBefore()})),s.emitEvent(new Fi(r,a,this.times)),i.sort(),function(t,e){let s;t.list.forEach((t=>{s=t.__layout,e.without(t)&&!s.useZoomProxy&&(s.matrixChanged?($n(t),e.push(t),t.isBranch&&to(t,e),eo(t,e)):s.boundsChanged&&(e.push(t),t.isBranch&&(t.__tempNumber=0),eo(t,e)))}))}(i,this.__levelList),function(t){let e,s;t.sort(!0),t.levels.forEach((i=>{e=t.levelMap[i];for(let t=0,i=e.length;t<i;t++){if(s=e[t],s.isBranch&&s.__tempNumber)for(let t=0,e=s.children.length;t<e;t++)s.children[t].isBranch||s.children[t].__updateWorldBounds();s.__updateWorldBounds()}}))}(this.__levelList),function(t){t.list.forEach((t=>{t.__layout.opacityChanged&&Jn(t),t.__updateChange()}))}(i),a.forEach((t=>t.setAfter())),s.emitEvent(new Fi(n,a,this.times)),s.emitEvent(new Fi(o,a,this.times)),this.addBlocks(a),this.__levelList.reset(),this.__updatedList=null,J.end(e)}fullLayout(){const t=J.start("FullLayout"),{target:e}=this,{BEFORE:s,LAYOUT:i,AFTER:r}=Fi,n=this.getBlocks(new ht(e));e.emitEvent(new Fi(s,n,this.times)),co.fullLayout(e),n.forEach((t=>{t.setAfter()})),e.emitEvent(new Fi(i,n,this.times)),e.emitEvent(new Fi(r,n,this.times)),this.addBlocks(n),J.end(t)}static fullLayout(t){if(no(t),t.isBranch){const e=[t];ao(t,e),ho(e)}else t.__updateWorldBounds();oo(t)}createBlock(t){return new ro(t)}getBlocks(t){return[this.createBlock(t)]}addBlocks(t){this.layoutedBlocks?this.layoutedBlocks.push(...t):this.layoutedBlocks=t}__onReceiveWatchData(t){this.__updatedList=t.data.updatedList}__listenEvents(){const{target:t}=this;this.__eventIds=[t.on_(Fi.REQUEST,this.layout,this),t.on_(Fi.AGAIN,this.layoutAgain,this),t.on_(Ni.DATA,this.__onReceiveWatchData,this)]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.target=null,this.config=null)}}const uo=Z.get("Renderer");class _o{get needFill(){return!(this.canvas.allowBackgroundColor||!this.config.fill)}constructor(t,e,s){this.FPS=60,this.totalTimes=0,this.times=0,this.config={usePartRender:!0,maxFPS:60},this.target=t,this.canvas=e,s&&(this.config=ct.default(s,this.config)),this.__listenEvents(),this.__requestRender()}start(){this.running=!0}stop(){this.running=!1}update(){this.changed=!0}requestLayout(){this.target.emit(Fi.REQUEST)}render(t){if(!this.running||!this.canvas.view)return void(this.changed=!0);const{target:e}=this;this.times=0,this.totalBounds=new G,uo.log(e.innerName,"---\x3e");try{this.emitRender(Yi.START),this.renderOnce(t),this.emitRender(Yi.END,this.totalBounds),ki.clearRecycled()}catch(t){this.rendering=!1,uo.error(t)}uo.log("-------------|")}renderAgain(){this.rendering?this.waitAgain=!0:this.renderOnce()}renderOnce(t){return this.rendering?uo.warn("rendering"):this.times>3?uo.warn("render max times"):(this.times++,this.totalTimes++,this.rendering=!0,this.changed=!1,this.renderBounds=new G,this.renderOptions={},t?(this.emitRender(Yi.BEFORE),t()):(this.requestLayout(),this.emitRender(Yi.BEFORE),this.config.usePartRender&&this.totalTimes>1?this.partRender():this.fullRender()),this.emitRender(Yi.RENDER,this.renderBounds,this.renderOptions),this.emitRender(Yi.AFTER,this.renderBounds,this.renderOptions),this.updateBlocks=null,this.rendering=!1,void(this.waitAgain&&(this.waitAgain=!1,this.renderOnce())))}partRender(){const{canvas:t,updateBlocks:e}=this;if(!e)return uo.warn("PartRender: need update attr");e.some((t=>t.includes(this.target.__world)))&&this.mergeBlocks(),e.forEach((e=>{t.bounds.hit(e)&&!e.isEmpty()&&this.clipRender(e)}))}clipRender(t){const e=J.start("PartRender"),{canvas:s}=this,i=t.getIntersect(s.bounds),r=t.includes(this.target.__world),n=(new G).copy(i);s.save(),r&&!Z.showRepaint?s.clear():(i.spread(1+1/this.canvas.pixelRatio).ceil(),s.clearWorld(i,!0),s.clipWorld(i,!0)),this.__render(i,n),s.restore(),J.end(e)}fullRender(){const t=J.start("FullRender"),{canvas:e}=this;e.save(),e.clear(),this.__render(e.bounds),e.restore(),J.end(t)}__render(t,e){const s=(null==t?void 0:t.includes(this.target.__world))?{}:{bounds:t};this.needFill&&this.canvas.fillWorld(t,this.config.fill),Z.showRepaint&&this.canvas.strokeWorld(t,"red"),this.target.__render(this.canvas,s),this.renderBounds=e||t,this.renderOptions=s,this.totalBounds.isEmpty()?this.totalBounds=this.renderBounds:this.totalBounds.add(this.renderBounds),Z.showHitView&&this.renderHitView(s),Z.showBoundsView&&this.renderBoundsView(s),this.canvas.updateRender()}renderHitView(t){}renderBoundsView(t){}addBlock(t){this.updateBlocks||(this.updateBlocks=[]),this.updateBlocks.push(t)}mergeBlocks(){const{updateBlocks:t}=this;if(t){const e=new G;e.setByList(t),t.length=0,t.push(e)}}__requestRender(){const t=Date.now();e.requestRender((()=>{this.FPS=Math.min(60,Math.ceil(1e3/(Date.now()-t))),this.changed&&this.running&&this.canvas.view&&this.render(),this.running&&this.target.emit(zi.FRAME),this.target&&this.__requestRender()}))}__onResize(t){if(!this.canvas.unreal&&(t.bigger||!t.samePixelRatio)){const{width:e,height:s}=t.old;new G(0,0,e,s).includes(this.target.__world)&&!this.needFill&&t.samePixelRatio||(this.addBlock(this.canvas.bounds),this.target.forceUpdate("blendMode"))}}__onLayoutEnd(t){t.data&&t.data.map((t=>{let e;t.updatedList&&t.updatedList.list.some((t=>(e=!t.__world.width||!t.__world.height,e&&(t.isLeafer||uo.warn(t.innerName,": empty"),e=!t.isBranch||t.isBranchLeaf),e))),this.addBlock(e?this.canvas.bounds:t.updatedBounds)}))}emitRender(t,e,s){this.target.emitEvent(new Yi(t,this.times,e,s))}__listenEvents(){const{target:t}=this;this.__eventIds=[t.on_(Yi.REQUEST,this.update,this),t.on_(Fi.END,this.__onLayoutEnd,this),t.on_(Yi.AGAIN,this.renderAgain,this),t.on_(Wi.RESIZE,this.__onResize,this)]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.target=null,this.canvas=null,this.config=null)}}const{hitRadiusPoint:po}=X;class go{constructor(t,e){this.target=t,this.selector=e}getByPoint(t,e,s){e||(e=0),s||(s={});const i=s.through||!1,r=s.ignoreHittable||!1;this.exclude=s.exclude||null,this.point={x:t.x,y:t.y,radiusX:e,radiusY:e},this.findList=[],this.eachFind(this.target.children,this.target.__onlyHitMask);const n=this.findList,o=this.getBestMatchLeaf(),a=r?this.getPath(o):this.getHitablePath(o);return this.clear(),i?{path:a,leaf:o,throughPath:n.length?this.getThroughPath(n):a}:{path:a,leaf:o}}getBestMatchLeaf(){const{findList:t}=this;if(t.length>1){let e;this.findList=[];const{x:s,y:i}=this.point,r={x:s,y:i,radiusX:0,radiusY:0};for(let s=0,i=t.length;s<i;s++)if(e=t[s],Mr.worldHittable(e)&&(this.hitChild(e,r),this.findList.length))return this.findList[0]}return t[0]}getPath(t){const e=new ht;for(;t;)e.push(t),t=t.parent;return e.push(this.target),e}getHitablePath(t){const e=this.getPath(t);let s,i=new ht;for(let t=e.list.length-1;t>-1&&(s=e.list[t],s.__.hittable)&&(i.unshift(s),s.__.hitChildren);t--);return i}getThroughPath(t){const e=new ht,s=[];for(let e=t.length-1;e>-1;e--)s.push(this.getPath(t[e]));let i,r,n;for(let t=0,o=s.length;t<o;t++){i=s[t],r=s[t+1];for(let t=0,s=i.length;t<s&&(n=i.list[t],!r||!r.has(n));t++)e.push(n)}return e}eachFind(t,e){let s,i;const{point:r}=this;for(let n=t.length-1;n>-1;n--)s=t[n],!s.__.visible||e&&!s.__.isMask||(i=!!s.__.hitRadius||po(s.__world,r),s.isBranch?(i||s.__ignoreHitWorld)&&(this.eachFind(s.children,s.__onlyHitMask),s.isBranchLeaf&&!this.findList.length&&this.hitChild(s,r)):i&&this.hitChild(s,r))}hitChild(t,e){this.exclude&&this.exclude.has(t)||t.__hitWorld(e)&&this.findList.push(t)}clear(){this.point=null,this.findList=null,this.exclude=null}destroy(){this.clear()}}class fo{constructor(t,e){this.config={},this.innerIdList={},this.idList={},this.classNameList={},this.tagNameList={},this.target=t,e&&(this.config=ct.default(e,this.config)),this.findPath=new go(t,this),this.__listenEvents()}getByPoint(t,s,i){return"node"===e.name&&this.target.emit(Fi.CHECK_UPDATE),this.findPath.getByPoint(t,s,i)}find(t,e){return"number"==typeof t?this.getByInnerId(t,e):t.startsWith("#")?this.getById(t.substring(1),e):t.startsWith(".")?this.getByClassName(t.substring(1),e):this.getByTagName(t,e)}getByInnerId(t,e){let s,i=this.innerIdList[t];return i||(e||(e=this.target),this.loopFind(e,(e=>e.innerId===t&&(s=e,this.innerIdList[t]=s,!0))),s)}getById(t,e){let s,i=this.idList[t];return i||(e||(e=this.target),this.loopFind(e,(e=>e.id===t&&(s=e,this.idList[t]=s,!0))),s)}getByClassName(t,e){e||(e=this.target);let s=[];return this.loopFind(e,(e=>(e.className===t&&s.push(e),!1))),s}getByTagName(t,e){e||(e=this.target);let s=[];return this.loopFind(e,(e=>(e.__tag===t&&s.push(e),!1))),s}loopFind(t,e){if(e(t))return;const{children:s}=t;for(let i=0,r=s.length;i<r;i++){if(e(t=s[i]))return;t.isBranch&&this.loopFind(t,e)}}__onRemoveChild(t){const e=t.target;this.idList[e.id]&&(this.idList[e.id]=null),this.innerIdList[e.id]&&(this.innerIdList[e.innerId]=null)}__listenEvents(){this.__eventIds=[this.target.on_(Mi.REMOVE,this.__onRemoveChild,this)]}__removeListenEvents(){this.target.off_(this.__eventIds),this.__eventIds.length=0}destroy(){this.__eventIds.length&&(this.__removeListenEvents(),this.findPath.destroy(),this.innerIdList={},this.idList={},this.classNameList={},this.tagNameList={})}}Object.assign(s,{watcher:(t,e)=>new Qn(t,e),layouter:(t,e)=>new co(t,e),renderer:(t,e,s)=>new _o(t,e,s),selector:(t,e)=>new fo(t,e)}),e.layout=co.fullLayout;const yo=Z.get("LeaferCanvas");class vo extends Rt{init(){const{view:t}=this.config;t?this.__createViewFrom(t):this.__createView();const{style:s}=this.view;s.display||(s.display="block"),this.parentView=this.view.parentElement,e.syncDomFont&&!this.parentView&&(this.view.style.display="none",document.body.appendChild(this.view)),this.__createContext(),this.autoLayout||this.resize(this.config)}set backgroundColor(t){this.view.style.backgroundColor=t}get backgroundColor(){return this.view.style.backgroundColor}set hittable(t){this.view.style.pointerEvents=t?"auto":"none"}get hittable(){return"none"!==this.view.style.pointerEvents}__createView(){this.view=document.createElement("canvas")}setCursor(t){const e=[];this.eachCursor(t,e),"object"==typeof e[e.length-1]&&e.push("default"),this.view.style.cursor=e.map((t=>"object"==typeof t?`url(${t.url}) ${t.x||0} ${t.y||0}`:t)).join(",")}eachCursor(t,e,s=0){if(s++,t instanceof Array)t.forEach((t=>this.eachCursor(t,e,s)));else{const i="string"==typeof t&&hn.get(t);i&&s<2?this.eachCursor(i,e,s):e.push(t)}}__createViewFrom(t){let e="string"==typeof t?document.getElementById(t):t;if(e)if(e instanceof HTMLCanvasElement)this.view=e;else{let t=e;if(e===window||e===document){const e=document.createElement("div"),{style:s}=e;s.position="absolute",s.top=s.bottom=s.left=s.right="0px",document.body.appendChild(e),t=e}this.__createView();const s=this.view;if(t.hasChildNodes()){const{style:e}=s;e.position="absolute",e.top=e.left="0px",t.style.position||(t.style.position="relative")}t.appendChild(s)}else yo.error(`no id: ${t}`),this.__createView()}updateViewSize(){const{width:t,height:e,pixelRatio:s}=this,{style:i}=this.view;i.width=t+"px",i.height=e+"px",this.view.width=t*s,this.view.height=e*s}updateClientBounds(){this.clientBounds=this.view.getBoundingClientRect()}startAutoLayout(t,e){this.autoBounds=t,this.resizeListener=e;try{this.resizeObserver=new ResizeObserver((t=>{this.updateClientBounds();for(const e of t)this.checkAutoBounds(e.contentRect)}));const t=this.parentView;t&&(this.resizeObserver.observe(t),this.checkAutoBounds(t.getBoundingClientRect()))}catch(t){this.imitateResizeObserver()}}imitateResizeObserver(){this.autoLayout&&(this.parentView&&this.checkAutoBounds(this.parentView.getBoundingClientRect()),e.requestRender(this.imitateResizeObserver.bind(this)))}checkAutoBounds(t){const e=this.view,{x:s,y:i,width:r,height:n}=this.autoBounds.getBoundsFrom(t);if(r!==this.width||n!==this.height){const{style:t}=e,{pixelRatio:o}=this;t.marginLeft=s+"px",t.marginTop=i+"px";const a={width:r,height:n,pixelRatio:o},h={};ct.copyAttrs(h,this,Ct),this.resize(a),void 0!==this.width&&this.resizeListener(new Wi(a,h))}}stopAutoLayout(){this.autoLayout=!1,this.resizeListener=null,this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null)}unrealCanvas(){if(!this.unreal&&this.parentView){const t=this.view;t&&t.remove(),this.view=this.parentView,this.unreal=!0}}destroy(){if(this.view){if(this.stopAutoLayout(),!this.unreal){const t=this.view;t.parentElement&&t.remove()}super.destroy()}}}Bi(CanvasRenderingContext2D.prototype),Bi(Path2D.prototype);const mo={convert(t,e){const s=Hr.getBase(t),i=Object.assign(Object.assign({},s),{x:e.x,y:e.y,width:t.width,height:t.height,pointerType:t.pointerType,pressure:t.pressure});return"pen"===i.pointerType&&(i.tangentialPressure=t.tangentialPressure,i.tiltX=t.tiltX,i.tiltY=t.tiltY,i.twist=t.twist),i},convertMouse(t,e){const s=Hr.getBase(t);return Object.assign(Object.assign({},s),{x:e.x,y:e.y,width:1,height:1,pointerType:"mouse",pressure:.5})},convertTouch(t,e){const s=mo.getTouch(t),i=Hr.getBase(t);return Object.assign(Object.assign({},i),{x:e.x,y:e.y,width:1,height:1,pointerType:"touch",pressure:s.force})},getTouch:t=>t.targetTouches[0]||t.changedTouches[0]},wo={getMove(t,e){let{moveSpeed:s}=e,{deltaX:i,deltaY:r}=t;return t.shiftKey&&!i&&(i=r,r=0),i>50&&(i=Math.max(50,i/3)),r>50&&(r=Math.max(50,r/3)),{x:-i*s*2,y:-r*s*2}},getScale(t,s){let i,r=1,{zoomMode:o,zoomSpeed:a}=s;const h=t.deltaY||t.deltaX;if(o?(i=!t.deltaX&&(e.intWheelDeltaY?Math.abs(h)>17:Math.ceil(h)!==h),(t.shiftKey||t.metaKey||t.ctrlKey)&&(i=!0)):i=!t.shiftKey&&(t.metaKey||t.ctrlKey),i){a=n.within(a,0,1);r=1-h/(25*(t.deltaY?s.delta.y:s.delta.x)*(1-a)+10),r<.5&&(r=.5),r>=1.5&&(r=1.5)}return r}},xo={convert(t){const e=Hr.getBase(t);return Object.assign(Object.assign({},e),{code:t.code,key:t.key})}},{getMoveEventData:Eo,getZoomEventData:bo,getRotateEventData:Bo}=Hr;class Co extends an{__listenEvents(){super.__listenEvents();const t=this.view=this.canvas.view;this.viewEvents={pointerdown:this.onPointerDown,mousedown:this.onMouseDown,touchstart:this.onTouchStart,wheel:this.onWheel,gesturestart:this.onGesturestart,gesturechange:this.onGesturechange,gestureend:this.onGestureend},this.windowEvents={pointermove:this.onPointerMove,pointerup:this.onPointerUp,pointercancel:this.onPointerCancel,mousemove:this.onMouseMove,mouseup:this.onMouseUp,touchmove:this.onTouchMove,touchend:this.onTouchEnd,touchcancel:this.onTouchCancel,keydown:this.onKeyDown,keyup:this.onKeyUp,scroll:this.onScroll};const{viewEvents:e,windowEvents:s}=this;for(let s in e)e[s]=e[s].bind(this),t.addEventListener(s,e[s]);for(let t in s)s[t]=s[t].bind(this),window.addEventListener(t,s[t])}__removeListenEvents(){super.__removeListenEvents();const{viewEvents:t,windowEvents:e}=this;for(let e in t)this.view.removeEventListener(e,t[e]),this.viewEvents={};for(let t in e)window.removeEventListener(t,e[t]),this.windowEvents={}}getLocal(t,e){e&&this.canvas.updateClientBounds();const{clientBounds:s}=this.canvas;return{x:t.clientX-s.x,y:t.clientY-s.y}}getTouches(t){const e=[];for(let s=0,i=t.length;s<i;s++)e.push(t[s]);return e}preventDefaultPointer(t){const{pointer:e}=this.config;e.preventDefault&&t.preventDefault()}preventDefaultWheel(t){const{wheel:e}=this.config;e.preventDefault&&t.preventDefault()}preventWindowPointer(t){return!this.downData&&t.target!==this.view}onKeyDown(t){this.keyDown(xo.convert(t))}onKeyUp(t){this.keyUp(xo.convert(t))}onScroll(){this.canvas.updateClientBounds()}onPointerDown(t){this.preventDefaultPointer(t),this.usePointer||(this.usePointer=!0),this.useMultiTouch||this.pointerDown(mo.convert(t,this.getLocal(t)))}onPointerMove(t){this.usePointer||(this.usePointer=!0),this.useMultiTouch||this.preventWindowPointer(t)||this.pointerMove(mo.convert(t,this.getLocal(t,!0)))}onPointerUp(t){this.downData&&this.preventDefaultPointer(t),this.useMultiTouch||this.preventWindowPointer(t)||this.pointerUp(mo.convert(t,this.getLocal(t)))}onPointerCancel(){this.useMultiTouch||this.pointerCancel()}onMouseDown(t){this.preventDefaultPointer(t),this.useTouch||this.usePointer||this.pointerDown(mo.convertMouse(t,this.getLocal(t)))}onMouseMove(t){this.useTouch||this.usePointer||this.preventWindowPointer(t)||this.pointerMove(mo.convertMouse(t,this.getLocal(t,!0)))}onMouseUp(t){this.downData&&this.preventDefaultPointer(t),this.useTouch||this.usePointer||this.preventWindowPointer(t)||this.pointerUp(mo.convertMouse(t,this.getLocal(t)))}onMouseCancel(){this.useTouch||this.usePointer||this.pointerCancel()}onTouchStart(t){if(t.preventDefault(),this.multiTouchStart(t),this.usePointer)return;this.touchTimer&&(window.clearTimeout(this.touchTimer),this.touchTimer=0),this.useTouch=!0;const e=mo.getTouch(t);this.pointerDown(mo.convertTouch(t,this.getLocal(e,!0)))}onTouchMove(t){if(this.multiTouchMove(t),this.usePointer||this.preventWindowPointer(t))return;const e=mo.getTouch(t);this.pointerMove(mo.convertTouch(t,this.getLocal(e)))}onTouchEnd(t){if(this.multiTouchEnd(),this.usePointer||this.preventWindowPointer(t))return;this.touchTimer&&clearTimeout(this.touchTimer),this.touchTimer=setTimeout((()=>{this.useTouch=!1}),500);const e=mo.getTouch(t);this.pointerUp(mo.convertTouch(t,this.getLocal(e)))}onTouchCancel(){this.usePointer||this.pointerCancel()}multiTouchStart(t){this.useMultiTouch=t.touches.length>=2,this.touches=this.useMultiTouch?this.getTouches(t.touches):void 0,this.useMultiTouch&&this.pointerCancel()}multiTouchMove(t){if(this.useMultiTouch&&t.touches.length>1){const e=this.getTouches(t.touches),s=this.getKeepTouchList(this.touches,e);s.length>1&&(this.multiTouch(Hr.getBase(t),s),this.touches=e)}}multiTouchEnd(){this.touches=null,this.useMultiTouch=!1,this.transformEnd()}getKeepTouchList(t,e){let s;const i=[];return t.forEach((t=>{s=e.find((e=>e.identifier===t.identifier)),s&&i.push({from:this.getLocal(t),to:this.getLocal(s)})})),i}getLocalTouchs(t){return t.map((t=>this.getLocal(t)))}onWheel(t){this.preventDefaultWheel(t);const{wheel:e}=this.config,s=e.getScale?e.getScale(t,e):wo.getScale(t,e),i=this.getLocal(t),r=Hr.getBase(t);1!==s?this.zoom(bo(i,s,r)):this.move(Eo(i,e.getMove?e.getMove(t,e):wo.getMove(t,e),r))}onGesturestart(t){this.preventDefaultWheel(t),this.lastGestureScale=1,this.lastGestureRotation=0}onGesturechange(t){this.preventDefaultWheel(t);const e=this.getLocal(t),s=Hr.getBase(t),i=t.scale/this.lastGestureScale,r=t.rotation-this.lastGestureRotation;let{rotateSpeed:o}=this.config.wheel;o=n.within(o,0,1),this.zoom(bo(e,i*i,s)),this.rotate(Bo(e,r/Math.PI*180*(o/4+.1),s)),this.lastGestureScale=t.scale,this.lastGestureRotation=t.rotation}onGestureend(t){this.preventDefaultWheel(t),this.transformEnd()}destroy(){this.view&&(super.destroy(),this.view=null,this.touches=null)}}const{mineType:Ro,fileType:To}=pt;function ko(t,i){e.origin={createCanvas(t,e){const s=document.createElement("canvas");return s.width=t,s.height=e,s},canvasToDataURL:(t,e,s)=>t.toDataURL(Ro(e),s),canvasToBolb:(t,e,s)=>new Promise((i=>t.toBlob(i,Ro(e),s))),canvasSaveAs:(t,e,s)=>new Promise((i=>{let r=document.createElement("a");r.href=t.toDataURL(Ro(To(e)),s),r.download=e,document.body.appendChild(r),r.click(),document.body.removeChild(r),i()})),loadImage:t=>new Promise(((s,i)=>{const r=new Image;r.setAttribute("crossOrigin","anonymous"),r.crossOrigin="anonymous",r.onload=()=>{s(r)},r.onerror=t=>{i(t)},!t.startsWith("data:")&&e.imageSuffix&&(t+=(t.includes("?")?"&":"?")+e.imageSuffix),r.src=t}))},e.canvas=s.canvas(),e.conicGradientSupport=!!e.canvas.context.createConicGradient}Object.assign(s,{canvas:(t,e)=>new vo(t,e),image:t=>new Si(t),hitCanvas:(t,e)=>new vo(t,e),interaction:(t,e,s,i)=>new Co(t,e,s,i)}),e.name="web",e.isMobile="ontouchstart"in window,e.requestRender=function(t){window.requestAnimationFrame(t)},e.devicePixelRatio=devicePixelRatio,e.realtimeLayout=!0;const{userAgent:Po}=navigator;function Lo(t){const{config:e}=t;e.move.dragOut=!1}Po.indexOf("Firefox")>-1?(e.conicGradientRotate90=!0,e.intWheelDeltaY=!0,e.syncDomFont=!0):Po.indexOf("Safari")>-1&&-1===Po.indexOf("Chrome")&&(e.fullImageShadow=!0),Po.indexOf("Windows")>-1?(e.os="Windows",e.intWheelDeltaY=!0):Po.indexOf("Mac")>-1?e.os="Mac":Po.indexOf("Linux")>-1&&(e.os="Linux");const Oo=Z.get("LeaferTypeCreator"),So={list:{},register(t,e){Do[t]?Oo.repeat(t):Do[t]=e},run(t,e){const s=So.list[t];s?s(e):Oo.error("no",t)}},{list:Do}=So;So.register("draw",Lo),So.register("user",Lo),So.register("design",(function(e){e.isApp||e.__eventIds.push(e.on_(t.MoveEvent.BEFORE_MOVE,(t=>{Mr.moveWorld(e.moveLayer,t.moveX,t.moveY)})),e.on_(t.ZoomEvent.BEFORE_ZOOM,(t=>{const{scaleX:s}=e.zoomLayer.__,{min:i,max:r}=e.config.zoom;let{scale:n}=t;n*Math.abs(s)<i?n=i/s:n*Math.abs(s)>r&&(n=r/s),1!==n&&Mr.zoomOfWorld(e.zoomLayer,t,n)})))}));const Mo={},Io={},Ao={},Wo={},Uo={},No={},Fo=Z.get("UIData");class zo extends _t{setVisible(t){this.__leaf.leafer&&(this.__leaf.leafer.watcher.hasVisible=!0),this._visible=t}setWidth(t){t<0?(this._width=-t,this.__leaf.scaleX*=-1,Fo.warn("width < 0, instead -scaleX ",this)):this._width=t}setHeight(t){t<0?(this._height=-t,this.__leaf.scaleY*=-1,Fo.warn("height < 0, instead -scaleY",this)):this._height=t}setFill(t){this.__naturalWidth&&(this.__naturalWidth=this.__naturalHeight=void 0),"string"!=typeof t&&t?"object"==typeof t&&(this.__setInput("fill",t),this.__leaf.__layout.boxChanged||this.__leaf.__layout.boxChange(),this.__isFills=!0,this._fill||(this._fill=No)):(this.__isFills&&(this.__removeInput("fill"),Io.recycleImage("fill",this),this.__isFills=!1),this._fill=t)}setStroke(t){"string"!=typeof t&&t?"object"==typeof t&&(this.__setInput("stroke",t),this.__leaf.__layout.boxChanged||this.__leaf.__layout.boxChange(),this.__isStrokes=!0,this._stroke||(this._stroke=No)):(this.__isStrokes&&(this.__removeInput("stroke"),Io.recycleImage("stroke",this),this.__isStrokes=!1),this._stroke=t)}setShadow(t){this.__setInput("shadow",t),t instanceof Array?(t.some((t=>!1===t.visible))&&(t=t.filter((t=>!1!==t.visible))),this._shadow=t.length?t:null):this._shadow=t?!1===t.visible?null:[t]:null}setInnerShadow(t){this.__setInput("innerShadow",t),t instanceof Array?(t.some((t=>!1===t.visible))&&(t=t.filter((t=>!1!==t.visible))),this._innerShadow=t.length?t:null):this._innerShadow=t?!1===t.visible?null:[t]:null}}const Yo={number:(t,e)=>"object"==typeof t?"percent"===t.type?t.value/100*e:t.value:t};class Xo extends zo{}class Ho extends Xo{get __boxStroke(){return!0}}class jo extends zo{get __boxStroke(){return!0}}const{parse:Vo}=Ge;const Go={thin:100,"extra-light":200,light:300,normal:400,medium:500,"semi-bold":600,bold:700,"extra-bold":800,black:900};class Ko extends jo{}function qo(t){return(e,s)=>{Zi(e,s,t,{set(t){this.__setAttr(s,t),t&&(this.__.__useEffect=!0),this.__layout.renderChanged||this.__layout.renderChange()}})}}function Zo(t){return(e,s)=>{Zi(e,s,t,{set(t){this.__setAttr(s,t),this.__layout.boxChanged||this.__layout.boxChange(),this.__updateSize()}})}}const Qo={__updateStrokeSpread(){let t=0,e=0;const{stroke:s,hitStroke:i,strokeAlign:r,strokeWidth:n}=this.__;if((s||"all"===i)&&n&&"inside"!==r&&(e=t="center"===r?n/2:n,!this.__.__boxStroke)){const{miterLimit:e,strokeCap:s}=this.__,i="Line"!==this.__tag?1/Math.sin(e*o/2)*Math.sqrt(n)-t:0,r="none"===s?0:n;t+=Math.max(i,r)}return this.__layout.strokeBoxSpread=e,t},__updateRenderSpread(){let t=0;const{shadow:e,innerShadow:s,blur:i,backgroundBlur:r}=this.__;e&&e.forEach((e=>{t=Math.max(t,Math.max(Math.abs(e.y),Math.abs(e.x))+(e.spread>0?e.spread:0)+1.5*e.blur)})),i&&(t=Math.max(t,i));let n=t=Math.ceil(t);return s&&s.forEach((t=>{n=Math.max(n,Math.max(Math.abs(t.y),Math.abs(t.x))+(t.spread<0?-t.spread:0)+1.5*t.blur)})),r&&(n=Math.max(n,r)),this.__layout.renderShapeSpread=n,t}},$o={__updateHitCanvas(){this.__hitCanvas||(this.__hitCanvas=this.leafer.hitCanvasManager.getPathType(this));const t=this.__hitCanvas;this.__drawHitPath(t),t.setStrokeOptions(this.__)},__hit(t){const{__hitCanvas:s}=this;"miniapp"===e.name&&this.__drawHitPath(s);const{fill:i,hitFill:r,windingRule:n}=this.__,o=i&&"path"===r||"all"===r,a=s.hitFill(t,n);if(o&&a)return!0;const{stroke:h,hitStroke:l,strokeWidth:d,strokeAlign:c}=this.__,u=h&&"path"===l||"all"===l,_=2*t.radiusX;let p=_;if(u)switch(c){case"inside":if(p+=2*d,!o&&a&&s.hitStroke(t,p))return!0;p=_;break;case"center":p+=d;break;case"outside":if(p+=2*d,!o){if(!a&&s.hitStroke(t,p))return!0;p=_}}return!!p&&s.hitStroke(t,p)}},Jo={__updateChange(){const t=this.__;if(t.__useEffect){const{shadow:e,innerShadow:s,blur:i,backgroundBlur:r}=this.__;t.__useEffect=!!(e||s||i||r)}t.__checkSingle();t.__isFills||t.__isStrokes||t.cornerRadius||t.__useEffect?t.__complex=!0:t.__complex&&(t.__complex=!1)},__drawFast(t,e){const{fill:s,stroke:i,__drawAfterFill:r}=this.__;this.__drawRenderPath(t),s&&Io.fill(s,this,t),r&&this.__drawAfterFill(t,e),i&&Io.stroke(i,this,t,e)},__draw(t,e){if(this.__.__complex){const{fill:s,stroke:i,__drawAfterFill:r}=this.__;if(this.__drawRenderPath(t),this.__.__useEffect){const n=Io.shape(this,t,e),{shadow:o,innerShadow:a}=this.__;o&&Mo.shadow(this,t,n,e),s&&(this.__.__isFills?Io.fills(s,this,t):Io.fill(s,this,t)),r&&this.__drawAfterFill(t,e),a&&Mo.innerShadow(this,t,n,e),i&&(this.__.__isStrokes?Io.strokes(i,this,t,e):Io.stroke(i,this,t,e)),n.worldCanvas&&n.worldCanvas.recycle(),n.canvas.recycle()}else s&&(this.__.__isFills?Io.fills(s,this,t):Io.fill(s,this,t)),r&&this.__drawAfterFill(t,e),i&&(this.__.__isStrokes?Io.strokes(i,this,t,e):Io.stroke(i,this,t,e))}else this.__drawFast(t,e)},__renderShape(t,e){if(!this.__worldOpacity)return;t.setWorld(this.__world,e.matrix);const{fill:s,stroke:i}=this.__;this.__drawRenderPath(t),s&&Io.fill("#000000",this,t),i&&Io.stroke("#000000",this,t,e)}},ta={__drawFast(t,e){const{width:s,height:i,fill:r,stroke:n,__drawAfterFill:o}=this.__;if(r&&(t.fillStyle=r,t.fillRect(0,0,s,i)),o&&this.__drawAfterFill(t,e),n){const{strokeAlign:e,strokeWidth:r}=this.__;t.setStroke(n,r,this.__);const o=r/2;switch(e){case"center":t.strokeRect(0,0,s,i);break;case"inside":t.strokeRect(o,o,s-r,i-r);break;case"outside":t.strokeRect(-o,-o,s+r,i+r)}}}};var ea;t.UI=ea=class extends t.Leaf{set scale(t){"number"==typeof t?this.scaleX=this.scaleY=t:(this.scaleX=t.x,this.scaleY=t.y)}get scale(){const{scaleX:t,scaleY:e}=this;return t!==e?{x:t,y:e}:t}constructor(t){super(t)}set(t){Object.assign(this,t)}get(){return this.__.__getInputData()}getPath(t){const e=this.__.path;return e?t?Ge.toCanvasData(e,!0):e:[]}getPathString(t){return Ge.stringify(this.getPath(t))}__onUpdateSize(){if(this.__.__input){const{fill:t,stroke:e}=this.__.__input;t&&Io.compute("fill",this),e&&Io.compute("stroke",this)}}__updateRenderPath(){if(this.__.path){const{__:t}=this;t.__pathForRender=t.cornerRadius?Ei.smooth(t.path,t.cornerRadius,t.cornerSmoothing):t.path}}__drawRenderPath(t){t.beginPath(),this.__drawPathByData(t,this.__.__pathForRender)}__drawPath(t){t.beginPath(),this.__drawPathByData(t,this.__.path)}__drawPathByData(t,e){}export(t,e){return Uo.export(this,t,e)}clone(){return ea.one(this.toJSON())}static one(t,e,s,i,r){return st.get(t.tag||this.prototype.__tag,t,e,s,i,r)}destroy(){this.fill=this.stroke=null,super.destroy()}},gt([_r(zo)],t.UI.prototype,"__",void 0),gt([Qi("")],t.UI.prototype,"id",void 0),gt([Qi("")],t.UI.prototype,"name",void 0),gt([Qi("")],t.UI.prototype,"className",void 0),gt([or("pass-through")],t.UI.prototype,"blendMode",void 0),gt([ar(1)],t.UI.prototype,"opacity",void 0),gt([ar(!0)],t.UI.prototype,"visible",void 0),gt([lr(!1)],t.UI.prototype,"isMask",void 0),gt([dr(!1)],t.UI.prototype,"isEraser",void 0),gt([hr(0)],t.UI.prototype,"zIndex",void 0),gt([Qi()],t.UI.prototype,"locked",void 0),gt([$i(0)],t.UI.prototype,"x",void 0),gt([$i(0)],t.UI.prototype,"y",void 0),gt([er(100)],t.UI.prototype,"width",void 0),gt([er(100)],t.UI.prototype,"height",void 0),gt([Ji(1)],t.UI.prototype,"scaleX",void 0),gt([Ji(1)],t.UI.prototype,"scaleY",void 0),gt([tr(0)],t.UI.prototype,"rotation",void 0),gt([tr(0)],t.UI.prototype,"skewX",void 0),gt([tr(0)],t.UI.prototype,"skewY",void 0),gt([$i()],t.UI.prototype,"around",void 0),gt([Qi(!1)],t.UI.prototype,"draggable",void 0),gt([cr(!0)],t.UI.prototype,"hittable",void 0),gt([cr("path")],t.UI.prototype,"hitFill",void 0),gt([rr("path")],t.UI.prototype,"hitStroke",void 0),gt([cr(!0)],t.UI.prototype,"hitChildren",void 0),gt([cr(!0)],t.UI.prototype,"hitSelf",void 0),gt([cr()],t.UI.prototype,"hitRadius",void 0),gt([ur("")],t.UI.prototype,"cursor",void 0),gt([or()],t.UI.prototype,"fill",void 0),gt([rr()],t.UI.prototype,"stroke",void 0),gt([rr("inside")],t.UI.prototype,"strokeAlign",void 0),gt([rr(1)],t.UI.prototype,"strokeWidth",void 0),gt([rr("none")],t.UI.prototype,"strokeCap",void 0),gt([rr("miter")],t.UI.prototype,"strokeJoin",void 0),gt([rr()],t.UI.prototype,"dashPattern",void 0),gt([rr()],t.UI.prototype,"dashOffset",void 0),gt([rr(10)],t.UI.prototype,"miterLimit",void 0),gt([sr()],t.UI.prototype,"cornerRadius",void 0),gt([sr()],t.UI.prototype,"cornerSmoothing",void 0),gt([qo()],t.UI.prototype,"shadow",void 0),gt([qo()],t.UI.prototype,"innerShadow",void 0),gt([qo()],t.UI.prototype,"blur",void 0),gt([qo()],t.UI.prototype,"backgroundBlur",void 0),gt([qo()],t.UI.prototype,"grayscale",void 0),gt([vr(Xs.drawPathByData)],t.UI.prototype,"__drawPathByData",null),t.UI=ea=gt([xr(Qo),xr($o),xr(Jo),mr()],t.UI),t.Group=class extends t.UI{get __tag(){return"Group"}get resizeable(){return!1}set mask(t){this.__hasMask&&this.__removeMask(),t&&(t.isMask=!0,this.addAt(t,0))}get mask(){return this.children.find((t=>t.isMask))}constructor(t){super(t),this.__setBranch()}__setBranch(){this.isBranch=!0,this.children||(this.children=[])}set(t){if(t.children){const{children:e}=t;let s;delete t.children,this.children||this.__setBranch(),super.set(t),e.forEach((t=>{s=st.get(t.tag,t),this.add(s)})),t.children=e}else super.set(t)}toJSON(){const t=super.toJSON();return t.children=this.children.map((t=>t.toJSON())),t}addAt(t,e){this.add(t,e)}addAfter(t,e){this.add(t,this.children.indexOf(e)+1)}addBefore(t,e){this.add(t,this.children.indexOf(e))}add(t,e){}addMany(...t){}remove(t,e){}removeAll(t){}},gt([_r(Xo)],t.Group.prototype,"__",void 0),t.Group=gt([xr(t.Branch),Er()],t.Group),t.Rect=class extends t.UI{get __tag(){return"Rect"}constructor(t){super(t)}__drawPathByData(t,e){const{width:s,height:i,cornerRadius:r}=this.__;r?t.roundRect(0,0,s,i,r):t.rect(0,0,s,i)}},gt([_r(jo)],t.Rect.prototype,"__",void 0),t.Rect=gt([xr(ta),Er()],t.Rect);const sa=t.Rect.prototype,ia=t.Group.prototype,ra={},{copy:na,add:oa}=X;t.Box=class extends t.Group{get __tag(){return"Box"}get resizeable(){return!0}constructor(t){super(t),this.isBranchLeaf=!0,this.__layout.renderChanged||this.__layout.renderChange()}__updateStrokeSpread(){return 0}__updateRectRenderSpread(){return 0}__updateRenderSpread(){let t=this.__updateRectRenderSpread()||super.__updateRenderSpread();return this.__.__drawAfterFill="hide"===this.__.overflow,t||(t=this.__.__drawAfterFill?0:1),t}__updateBoxBounds(){}__updateStrokeBounds(){}__updateRenderBounds(){if(this.__updateRectRenderBounds(),!this.__.__drawAfterFill){const{renderBounds:t}=this.__layout;na(ra,t),super.__updateRenderBounds(),oa(t,ra)}}__updateRectRenderBounds(){}__updateRectChange(){}__updateChange(){super.__updateChange(),this.__updateRectChange()}__drawPathByData(t,e){}__renderRect(t,e){}__renderGroup(t,e){}__render(t,e){this.__.__drawAfterFill?this.__renderRect(t,e):(this.__renderRect(t,e),this.__renderGroup(t,e))}__drawAfterFill(t,e){t.save(),t.clip(),this.__renderGroup(t,e),t.restore(),this.__.stroke&&this.__drawRenderPath(t)}},gt([_r(Ho)],t.Box.prototype,"__",void 0),gt([nr("show")],t.Box.prototype,"overflow",void 0),gt([vr(sa.__updateStrokeSpread)],t.Box.prototype,"__updateStrokeSpread",null),gt([vr(sa.__updateRenderSpread)],t.Box.prototype,"__updateRectRenderSpread",null),gt([vr(sa.__updateBoxBounds)],t.Box.prototype,"__updateBoxBounds",null),gt([vr(sa.__updateStrokeBounds)],t.Box.prototype,"__updateStrokeBounds",null),gt([vr(sa.__updateRenderBounds)],t.Box.prototype,"__updateRectRenderBounds",null),gt([vr(sa.__updateChange)],t.Box.prototype,"__updateRectChange",null),gt([vr(sa.__drawPathByData)],t.Box.prototype,"__drawPathByData",null),gt([vr(sa.__render)],t.Box.prototype,"__renderRect",null),gt([vr(ia.__render)],t.Box.prototype,"__renderGroup",null),t.Box=gt([mr(),Er()],t.Box),t.Frame=class extends t.Box{get __tag(){return"Frame"}constructor(t){super(t),this.__.fill||(this.__.fill="#FFFFFF")}},gt([_r(class extends Ho{})],t.Frame.prototype,"__",void 0),gt([nr("hide")],t.Frame.prototype,"overflow",void 0),t.Frame=gt([Er()],t.Frame);const{moveTo:aa,closePath:ha,ellipse:la}=cs;t.Ellipse=class extends t.UI{get __tag(){return"Ellipse"}constructor(t){super(t)}__updatePath(){const{width:t,height:e,innerRadius:s,startAngle:i,endAngle:r}=this.__,n=t/2,o=e/2,a=this.__.path=[];s?i||r?(s<1&&la(a,n,o,n*s,o*s,0,i,r,!1),la(a,n,o,n,o,0,r,i,!0),s<1&&ha(a)):(s<1&&(la(a,n,o,n*s,o*s),aa(a,t,o)),la(a,n,o,n,o,0,0,360,!0)):i||r?(aa(a,n,o),la(a,n,o,n,o,0,i,r,!1),ha(a)):la(a,n,o,n,o)}},gt([_r(class extends zo{get __boxStroke(){return!0}})],t.Ellipse.prototype,"__",void 0),gt([sr(0)],t.Ellipse.prototype,"innerRadius",void 0),gt([sr(0)],t.Ellipse.prototype,"startAngle",void 0),gt([sr(0)],t.Ellipse.prototype,"endAngle",void 0),t.Ellipse=gt([Er()],t.Ellipse);const{sin:da,cos:ca,PI:ua}=Math,{moveTo:_a,lineTo:pa,closePath:ga,drawPoints:fa}=cs,{toBounds:ya}=xi;t.Polygon=class extends t.UI{get __tag(){return"Polygon"}get resizeable(){return!this.points}constructor(t){super(t)}__updatePath(){const t=this.__.path=[];if(this.__.points)fa(t,this.__.points,!1,!0);else{const{width:e,height:s,sides:i}=this.__,r=e/2,n=s/2;_a(t,r,0);for(let e=1;e<i;e++)pa(t,r+r*da(2*e*ua/i),n-n*ca(2*e*ua/i))}ga(t)}__updateRenderPath(){this.__.points&&this.__.curve?fa(this.__.__pathForRender=[],this.__.points,this.__.curve,!0):super.__updateRenderPath()}__updateBoxBounds(){this.__.points?(ya(this.__.__pathForRender,this.__layout.boxBounds),this.__updateNaturalSize()):super.__updateBoxBounds()}},gt([_r(class extends zo{})],t.Polygon.prototype,"__",void 0),gt([sr(3)],t.Polygon.prototype,"sides",void 0),gt([sr()],t.Polygon.prototype,"points",void 0),gt([sr(0)],t.Polygon.prototype,"curve",void 0),t.Polygon=gt([Er()],t.Polygon);const{sin:va,cos:ma,PI:wa}=Math,{moveTo:xa,lineTo:Ea,closePath:ba}=cs;t.Star=class extends t.UI{get __tag(){return"Star"}constructor(t){super(t)}__updatePath(){const{width:t,height:e,corners:s,innerRadius:i}=this.__,r=t/2,n=e/2,o=this.__.path=[];xa(o,r,0);for(let t=1;t<2*s;t++)Ea(o,r+(t%2==0?r:r*i)*va(t*wa/s),n-(t%2==0?n:n*i)*ma(t*wa/s));ba(o)}},gt([_r(class extends zo{})],t.Star.prototype,"__",void 0),gt([sr(5)],t.Star.prototype,"corners",void 0),gt([sr(.382)],t.Star.prototype,"innerRadius",void 0),t.Star=gt([Er()],t.Star);const{moveTo:Ba,lineTo:Ca,drawPoints:Ra}=cs,{rotate:Ta,getAngle:ka,getDistance:Pa,defaultPoint:La}=R,{toBounds:Oa}=xi;t.Line=class extends t.UI{get __tag(){return"Line"}get resizeable(){return!this.points}get toPoint(){const{width:t,rotation:e}=this.__,s={x:0,y:0};return t&&(s.x=t),e&&Ta(s,e),s}set toPoint(t){this.width=Pa(La,t),this.rotation=ka(La,t),this.height&&(this.height=0)}constructor(t){super(t)}__updatePath(){const t=this.__.path=[];this.__.points?Ra(t,this.__.points,!1):(Ba(t,0,0),Ca(t,this.width,0))}__updateRenderPath(){this.__.points&&this.__.curve?Ra(this.__.__pathForRender=[],this.__.points,this.__.curve,!1):super.__updateRenderPath()}__updateBoxBounds(){this.points?(Oa(this.__.__pathForRender,this.__layout.boxBounds),this.__updateNaturalSize()):super.__updateBoxBounds()}},gt([_r(class extends zo{})],t.Line.prototype,"__",void 0),gt([ir("center")],t.Line.prototype,"strokeAlign",void 0),gt([er(0)],t.Line.prototype,"height",void 0),gt([sr()],t.Line.prototype,"points",void 0),gt([sr(0)],t.Line.prototype,"curve",void 0),t.Line=gt([Er()],t.Line),t.Image=class extends t.Rect{get __tag(){return"Image"}get ready(){return!!this.image&&this.image.ready}constructor(t){super(t)}__updateBoxBounds(){let t;const{url:e}=this,s=this.fill;s?s.url!==e&&(t=!0):e&&(t=!0),t&&(this.image&&(this.image=null),this.fill=e?{type:"image",mode:"strench",url:e}:void 0,this.once(Ai.LOADED,(t=>this.image=t.image))),super.__updateBoxBounds()}destroy(){this.image=null,super.destroy()}},gt([_r(Ko)],t.Image.prototype,"__",void 0),gt([er("")],t.Image.prototype,"url",void 0),t.Image=gt([Er()],t.Image),t.Canvas=class extends t.Rect{get __tag(){return"Canvas"}constructor(t){super(t),this.canvas=s.canvas(this.__),this.context=this.canvas.context,this.__.__drawAfterFill=!0}draw(t,e,s,i){t.__layout.checkUpdate();const r=new P(t.__world);r.invert();const n=new P;e&&n.translate(e.x,e.y),s&&("number"==typeof s?n.scale(s):n.scale(s.x,s.y)),i&&n.rotate(i),r.preMultiply(n),t.__render(this.canvas,{matrix:r}),this.paint()}paint(){this.forceUpdate("fill")}__drawAfterFill(t,e){const s=this.canvas.view,{width:i,height:r}=this;this.__.cornerRadius?(t.save(),t.clip(),t.drawImage(this.canvas.view,0,0,s.width,s.height,0,0,i,r),t.restore()):t.drawImage(this.canvas.view,0,0,s.width,s.height,0,0,i,r)}__updateSize(){const{canvas:t}=this;if(t){const{smooth:e}=this.__;t.smooth!==e&&(t.smooth=e),t.resize(this.__)}}destroy(){this.canvas&&(this.canvas.destroy(),this.canvas=null,this.context=null),super.destroy()}},gt([_r(Ko)],t.Canvas.prototype,"__",void 0),gt([Zo(100)],t.Canvas.prototype,"width",void 0),gt([Zo(100)],t.Canvas.prototype,"height",void 0),gt([Zo(e.devicePixelRatio)],t.Canvas.prototype,"pixelRatio",void 0),gt([Zo(!0)],t.Canvas.prototype,"smooth",void 0),gt([cr("all")],t.Canvas.prototype,"hitFill",void 0),t.Canvas=gt([Er()],t.Canvas);const{copyAndSpread:Sa,includes:Da,spread:Ma}=X;t.Text=class extends t.UI{get __tag(){return"Text"}get textDrawData(){return this.__layout.checkUpdate(),this.__.__textDrawData}constructor(t){super(t)}__drawHitPath(t){const{__lineHeight:e,__baseLine:s,__textDrawData:i}=this.__;t.beginPath(),this.__.__letterSpacing<0?this.__drawPathByData(t):i.rows.forEach((i=>t.rect(i.x,i.y-s,i.width,e)))}__drawPathByData(t,e){const{x:s,y:i,width:r,height:n}=this.__layout.boxBounds;t.rect(s,i,r,n)}__drawRenderPath(t){t.font=this.__.__font}__updateTextDrawData(){const t=this.__;t.__textDrawData=Ao.getDrawData(t.text,this.__)}__updateBoxBounds(){const t=this.__,e=this.__layout,{lineHeight:s,letterSpacing:i,fontFamily:r,fontSize:n,fontWeight:o,italic:a,textCase:h}=t;t.__lineHeight=Yo.number(s,n),t.__letterSpacing=Yo.number(i,n),t.__baseLine=t.__lineHeight-(t.__lineHeight-.7*n)/2,t.__font=`${a?"italic ":""}${"small-caps"===h?"small-caps ":""}${"normal"!==o?o+" ":""}${n}px ${r}`,this.__updateTextDrawData();const{bounds:l}=t.__textDrawData,d=e.boxBounds;t.__lineHeight<n&&Ma(l,n/2);const c=t.__getInput("width"),u=t.__getInput("height");c&&u?super.__updateBoxBounds():(d.x=c?0:l.x,d.y=u?0:l.y,d.width=c||l.width,d.height=u||l.height,this.__updateNaturalSize());const _=Da(d,l)?d:l;_!==e.contentBounds&&(e.contentBounds=_,e.renderChanged=!0)}__updateRenderSpread(){let t=super.__updateRenderSpread();return t||(t=this.__layout.boxBounds===this.__layout.contentBounds?0:1),t}__updateRenderBounds(){Sa(this.__layout.renderBounds,this.__layout.contentBounds,this.__layout.renderSpread)}},gt([_r(class extends zo{setFontWeight(t){"string"==typeof t?(this.__setInput("fontWeight",t),this._fontWeight=Go[t]||400):(this.__input&&this.__removeInput("fontWeight"),this._fontWeight=t)}})],t.Text.prototype,"__",void 0),gt([er(0)],t.Text.prototype,"width",void 0),gt([er(0)],t.Text.prototype,"height",void 0),gt([er(0)],t.Text.prototype,"padding",void 0),gt([ir("outside")],t.Text.prototype,"strokeAlign",void 0),gt([er("")],t.Text.prototype,"text",void 0),gt([er("L")],t.Text.prototype,"fontFamily",void 0),gt([er(12)],t.Text.prototype,"fontSize",void 0),gt([er("normal")],t.Text.prototype,"fontWeight",void 0),gt([er(!1)],t.Text.prototype,"italic",void 0),gt([er("none")],t.Text.prototype,"textCase",void 0),gt([er("none")],t.Text.prototype,"textDecoration",void 0),gt([er(0)],t.Text.prototype,"letterSpacing",void 0),gt([er({type:"percent",value:150})],t.Text.prototype,"lineHeight",void 0),gt([er(0)],t.Text.prototype,"paraIndent",void 0),gt([er(0)],t.Text.prototype,"paraSpacing",void 0),gt([er("left")],t.Text.prototype,"textAlign",void 0),gt([er("top")],t.Text.prototype,"verticalAlign",void 0),gt([er("show")],t.Text.prototype,"textOverflow",void 0),t.Text=gt([Er()],t.Text);const{toBounds:Ia}=xi;t.Path=class extends t.UI{get __tag(){return"Path"}get resizeable(){return!1}constructor(t){super(t)}__updateBoxBounds(){Ia(this.__.path,this.__layout.boxBounds),this.__updateNaturalSize()}},gt([_r(class extends zo{setPath(t){"string"==typeof t?(this.__setInput("path",t),this._path=Vo(t)):(this.__input&&this.__removeInput("path"),this._path=t)}})],t.Path.prototype,"__",void 0),gt([sr()],t.Path.prototype,"path",void 0),gt([sr()],t.Path.prototype,"windingRule",void 0),gt([ir("center")],t.Path.prototype,"strokeAlign",void 0),t.Path=gt([Er()],t.Path),t.Pen=class extends t.Group{get __tag(){return"Pen"}constructor(t){super(t)}setStyle(e){const s=this.pathElement=new t.Path(e);return this.pathStyle=e,this.path=s.path||(s.path=[]),this.add(s),this}beginPath(){return this.path.length=0,this.paint(),this}moveTo(t,e){return this}lineTo(t,e){return this}bezierCurveTo(t,e,s,i,r,n){return this}quadraticCurveTo(t,e,s,i){return this}closePath(){return this}rect(t,e,s,i){return this}roundRect(t,e,s,i,r){return this}ellipse(t,e,s,i,r,n,o,a){return this}arc(t,e,s,i,r,n){return this}arcTo(t,e,s,i,r){return this}drawEllipse(t,e,s,i,r,n,o,a){return this}drawArc(t,e,s,i,r,n){return this}drawPoints(t,e,s){return this}paint(){this.pathElement.forceUpdate("path")}clear(){this.removeAll(!0)}},gt([_r(class extends Xo{})],t.Pen.prototype,"__",void 0),t.Pen=gt([xr(ks,["beginPath"]),Er()],t.Pen);const Aa=Z.get("Leafer");t.Leafer=class extends t.Group{get __tag(){return"Leafer"}get isApp(){return!1}get app(){return this.parent||this}constructor(t,e){super(e),this.zoomLayer=this,this.moveLayer=this,this.config={type:"design",start:!0,hittable:!0,smooth:!0,zoom:{min:.02,max:256},move:{holdSpaceKey:!0,dragOut:!0,autoDistance:2}},this.__eventIds=[],this.__controllers=[],this.__readyWait=[],this.__viewReadyWait=[],this.__viewCompletedWait=[],this.__nextRenderWait=[],this.userConfig=t,t&&(t.view||t.width)&&this.init(t)}init(t,e){if(this.canvas)return;let i;this.__setLeafer(this),t&&ct.assign(this.config,t);const{config:r}=this;So.run(r.type,this),this.canvas=s.canvas(r),this.__controllers.push(this.renderer=s.renderer(this,this.canvas,r),this.watcher=s.watcher(this,r),this.layouter=s.layouter(this,r)),this.isApp&&this.__setApp(),this.__checkAutoLayout(r),this.view=this.canvas.view,e?(this.__bindApp(e),i=e.running):(this.selector=s.selector(this),this.__controllers.unshift(this.interaction=s.interaction(this,this.canvas,this.selector,r)),this.canvasManager=new at,this.hitCanvasManager=new dt,i=r.start),this.hittable=r.hittable,this.fill=r.fill,this.canvasManager.add(this.canvas),this.__listenEvents(),i&&(this.__startTimer=setTimeout(this.start.bind(this))),Zn.onLeafer(this)}set(t){this.children?super.set(t):setTimeout((()=>{super.set(t)}))}start(){clearTimeout(this.__startTimer),!this.running&&this.canvas&&(this.ready?this.emitLeafer(Xi.RESTART):this.emitLeafer(Xi.START),this.__controllers.forEach((t=>t.start())),this.isApp||this.renderer.render(),this.running=!0)}stop(){clearTimeout(this.__startTimer),this.running&&this.canvas&&(this.__controllers.forEach((t=>t.stop())),this.running=!1,this.emitLeafer(Xi.STOP))}resize(t){const e=ct.copyAttrs({},t,Ct);Object.keys(e).forEach((t=>this[t]=e[t]))}forceLayout(){this.__layout.checkUpdate(!0)}forceFullRender(){this.renderer.addBlock(this.canvas.bounds),this.viewReady&&this.renderer.update()}updateCursor(){this.interaction&&this.interaction.updateCursor()}__doResize(t){if(!this.canvas||this.canvas.isSameSize(t))return;const e=ct.copyAttrs({},this.canvas,Ct);this.canvas.resize(t),this.__onResize(new Wi(t,e))}__onResize(t){this.emitEvent(t),ct.copyAttrs(this.__,t,Ct),setTimeout((()=>{this.canvasManager&&this.canvasManager.clearRecycled()}),0)}__setApp(){}__bindApp(t){this.selector=t.selector,this.interaction=t.interaction,this.canvasManager=t.canvasManager,this.hitCanvasManager=t.hitCanvasManager}__setLeafer(t){this.leafer=t,this.isLeafer=!!t,this.__level=1}setZoomLayer(t,e){this.zoomLayer=t,this.moveLayer=e||t}__checkAutoLayout(t){t.width&&t.height||(this.autoLayout=new K(t),this.canvas.startAutoLayout(this.autoLayout,this.__onResize.bind(this)))}__setAttr(t,e){this.canvas&&(Ct.includes(t)?this.__changeCanvasSize(t,e):"fill"===t?this.__changeFill(e):"hittable"===t&&(this.canvas.hittable=e)),super.__setAttr(t,e)}__getAttr(t){return this.canvas&&Ct.includes(t)?this.canvas[t]:super.__getAttr(t)}__changeCanvasSize(t,e){const s=ct.copyAttrs({},this.canvas,Ct);s[t]=this.config[t]=e,e&&this.canvas.stopAutoLayout(),this.__doResize(s)}__changeFill(t){this.config.fill=t,this.canvas.allowBackgroundColor?this.canvas.backgroundColor=t:this.forceFullRender()}__onCreated(){this.created=!0}__onReady(){this.ready||(this.ready=!0,this.emitLeafer(Xi.BEFORE_READY),this.emitLeafer(Xi.READY),this.emitLeafer(Xi.AFTER_READY),Xr.run(this.__readyWait))}__onViewReady(){this.viewReady||(this.viewReady=!0,this.emitLeafer(Xi.VIEW_READY),Xr.run(this.__viewReadyWait))}__onRenderEnd(t){this.viewReady||this.__onViewReady();const e=this.__checkViewCompleted();e&&this.__onViewCompleted(),this.viewCompleted=e,Xr.run(this.__nextRenderWait)}__checkViewCompleted(){return this.viewReady&&!this.watcher.changed&&ki.isComplete}__onViewCompleted(){this.viewCompleted||(this.emitLeafer(Xi.VIEW_COMPLETED),Xr.run(this.__viewCompletedWait))}__onWatchData(){this.watcher.childrenChanged&&this.interaction&&this.nextRender((()=>this.interaction.updateCursor()))}waitReady(t){this.ready?t():this.__readyWait.push(t)}waitViewReady(t){this.viewReady?t():this.__viewReadyWait.push(t)}waitViewCompleted(t){this.viewCompleted?t():(this.__viewCompletedWait.push(t),this.running||this.start())}nextRender(t){this.watcher&&!this.watcher.changed?t():this.__nextRenderWait.push(t)}__checkUpdateLayout(){this.__layout.checkUpdate()}emitLeafer(t){this.emitEvent(new Xi(t,this))}__listenEvents(){const t=J.start("FirstCreate "+this.innerName);this.once(Xi.START,(()=>J.end(t))),this.once(Fi.END,(()=>this.__onReady())),this.once(Yi.START,(()=>this.__onCreated())),this.__eventIds.push(this.on_(Ni.DATA,this.__onWatchData,this),this.on_(Yi.END,this.__onRenderEnd,this),this.on_(Fi.CHECK_UPDATE,this.__checkUpdateLayout,this))}__removeListenEvents(){this.off_(this.__eventIds),this.__eventIds.length=0}destroy(){setTimeout((()=>{if(!this.destroyed)try{this.stop(),this.emitEvent(new Xi(Xi.END,this)),this.__removeListenEvents(),this.__controllers.forEach((t=>{this.parent&&t===this.interaction||t.destroy()})),this.__controllers.length=0,this.parent||(this.selector.destroy(),this.canvasManager.destroy(),this.hitCanvasManager.destroy()),this.canvas.destroy(),this.config.view=this.view=null,this.userConfig&&(this.userConfig.view=null),super.destroy(),setTimeout((()=>{ki.clearRecycled()}),100)}catch(t){Aa.error(t)}}))}},gt([_r(class extends Xo{})],t.Leafer.prototype,"__",void 0),gt([er()],t.Leafer.prototype,"pixelRatio",void 0),t.Leafer=gt([Er()],t.Leafer),t.App=class extends t.Leafer{get __tag(){return"App"}get isApp(){return!0}__setApp(){const{canvas:t}=this,{realCanvas:e,view:s}=this.config;e||s===this.canvas.view||!t.parentView?this.realCanvas=!0:t.unrealCanvas(),this.leafer=this,this.watcher.disable(),this.layouter.disable(),this.__eventIds.push(this.on_(Ii.CHANGE,this.__onPropertyChange,this))}start(){super.start(),this.children.forEach((t=>{t.start()}))}stop(){this.children.forEach((t=>{t.stop()})),super.stop()}addLeafer(e){const s=new t.Leafer(e);return this.add(s),s}add(t){if(!t.view){if(this.realCanvas&&!this.canvas.bounds)return void setTimeout((()=>this.add(t)),10);t.init(this.__getChildConfig(t.userConfig),this)}super.add(t),this.__listenChildEvents(t)}__onPropertyChange(){Z.showHitView&&this.children.forEach((t=>{t.forceUpdate("surface")}))}__onCreated(){this.created=this.children.every((t=>t.created))}__onReady(){this.children.every((t=>t.ready))&&super.__onReady()}__onViewReady(){this.children.every((t=>t.viewReady))&&super.__onViewReady()}__checkViewCompleted(){return this.children.every((t=>t.viewCompleted))}__onChildRenderEnd(t){this.renderer.addBlock(t.renderBounds),this.viewReady&&this.renderer.update()}__render(t,e){this.children.forEach((e=>{t.copyWorld(e.canvas)}))}__onResize(t){this.children.forEach((e=>{e.resize(t)})),super.__onResize(t)}__checkUpdateLayout(){this.children.forEach((t=>{t.__layout.checkUpdate()}))}__getChildConfig(t){let e=Object.assign({},this.config);return e.hittable=e.realCanvas=void 0,t&&ct.assign(e,t),this.autoLayout&&ct.copyAttrs(e,this,Ct),e.view=this.realCanvas?void 0:this.view,e.fill=void 0,e}__listenChildEvents(t){t.once(Fi.END,(()=>this.__onReady())),t.once(Yi.START,(()=>this.__onCreated())),t.once(Yi.END,(t=>this.__onRenderEnd(t))),this.realCanvas&&this.__eventIds.push(t.on_(Yi.END,this.__onChildRenderEnd,this))}},t.App=gt([Er()],t.App);const{get:Wa,rotateOfOuter:Ua,translate:Na,scaleOfOuter:Fa,scale:za,rotate:Ya}=y;const{get:Xa,translate:Ha}=y;function ja(t,e,s,i){let{width:r,height:n}=e;const{opacity:o,mode:a,offset:h,scale:l,rotation:d,blendMode:c}=s,u=i.width===r&&i.height===n;c&&(t.blendMode=c);const _=t.data={mode:a};switch(a){case"strench":u||(r=i.width,n=i.height),(i.x||i.y)&&(_.transform=Xa(),Ha(_.transform,i.x,i.y));break;case"clip":(h||l||d)&&function(t,e,s,i,r){const n=Wa();Na(n,e.x,e.y),s&&Na(n,s.x,s.y),i&&("number"==typeof i?za(n,i):za(n,i.x,i.y),t.scaleX=n.a,t.scaleY=n.d),r&&Ya(n,r),t.transform=n}(_,i,h,l,d);break;case"repeat":(!u||l||d)&&function(t,e,s,i,r,n){const o=Wa();if(n)switch(Ya(o,n),n){case 90:Na(o,i,0);break;case 180:Na(o,s,i);break;case 270:Na(o,0,s)}Na(o,e.x,e.y),r&&(Fa(o,e,r),t.scaleX=t.scaleY=r),t.transform=o}(_,i,r,n,l,d);break;default:u&&!d||function(t,e,s,i,r,n){const o=Wa(),a=n&&180!==n,h=s.width/(a?r:i),l=s.height/(a?i:r),d="fit"===e?Math.min(h,l):Math.max(h,l),c=s.x+(s.width-i*d)/2,u=s.y+(s.height-r*d)/2;Na(o,c,u),za(o,d),n&&Ua(o,{x:s.x+s.width/2,y:s.y+s.height/2},n),t.scaleX=t.scaleY=d,t.transform=o}(_,a,i,r,n,d)}_.width=r,_.height=n,o&&(_.opacity=o)}function Va(t,e,s){if("fill"===e&&!t.__.__naturalWidth){const{__:e}=t;if(e.__naturalWidth=s.width,e.__naturalHeight=s.height,!e.__getInput("width")||!e.__getInput("height"))return t.forceUpdate("width"),!1}return!0}function Ga(t,e){e.target.hasEvent(t)&&e.target.emitEvent(new Ai(t,e))}const{get:Ka,scale:qa,copy:Za}=y;function Qa(t,s,i){let{scaleX:r,scaleY:n}=t.__world;const o=r+"-"+n;if(s.patternId===o||t.destroyed)return!1;{s.patternId=o,r=Math.abs(r),n=Math.abs(n);const{image:t,data:a}=s,h=t.isSVG?4096:Math.min(t.width,4096),l=t.isSVG?4096:Math.min(t.height,4096);let d,c,{width:u,height:_,scaleX:p,scaleY:g,opacity:f,transform:y,mode:v}=a;p&&(c=Ka(),Za(c,y),qa(c,1/p,1/g),r*=p,n*=g),r*=i,n*=i,u*=r,_*=n,(u>h||_>l)&&(d=Math.max(u/h,_/l)),d&&(r/=d,n/=d,u/=d,_/=d),p&&(r/=p,n/=g),(y||1!==r||1!==n)&&(c||(c=Ka(),y&&Za(c,y)),qa(c,1/r,1/n));const m=e.canvas.createPattern(t.getCanvas(u<1?1:u,_<1?1:_,f),"repeat"===v?"repeat":e.origin.noRepeat||"no-repeat");try{s.transform&&(s.transform=null),c&&(m.setTransform?m.setTransform(c):s.transform=c)}catch(t){s.transform=c}return s.style=m,!0}}function $a(t,e,s,i){const{scaleX:r,scaleY:n}=t.__world;if(s.data&&s.patternId!==r+"-"+n){if(i)if(s.image.isSVG&&"repeat"!==s.data.mode){let{width:t,height:o}=s.data;t*=r*e.pixelRatio,o*=n*e.pixelRatio,i=t>4096||o>4096}else i=!1;if(i){e.save(),e.clip();const{data:t}=s;return s.blendMode&&(e.blendMode=s.blendMode),t.opacity&&(e.opacity*=t.opacity),t.transform&&e.transform(t.transform),e.drawImage(s.image.view,0,0,t.width,t.height),e.restore(),!0}return s.style?ki.patternTasker.add((()=>ft(this,void 0,void 0,(function*(){e.bounds.hit(t.__world)&&Qa(t,s,e.pixelRatio)&&t.forceUpdate("surface")}))),300):Qa(t,s,e.pixelRatio),!1}return!1}function Ja(t,e){const s="fill"===t?e._fill:e._stroke;if(s instanceof Array){let i,r,n,o;for(let a=0,h=s.length;a<h;a++)i=s[a].image,o=i&&i.url,o&&(r||(r={}),r[o]=!0,ki.recycle(i),i.loading&&(n||(n=e.__input&&e.__input[t]||[],n instanceof Array||(n=[n])),i.unload(s[a].loadId,!n.some((t=>t.url===o)))));return r}return null}function th(t,e){let s;const{rows:i,decorationY:r,decorationHeight:n}=t.__.__textDrawData;for(let t=0,o=i.length;t<o;t++)s=i[t],s.text?e.fillText(s.text,s.x,s.y):s.data&&s.data.forEach((t=>{e.fillText(t.char,t.x,s.y)})),r&&e.fillRect(s.x,s.y+r,s.width,n)}function eh(t,e,s,i){const{strokeAlign:r}=e.__,n="string"!=typeof t;switch(r){case"center":s.setStroke(n?void 0:t,e.__.strokeWidth,e.__),n?rh(t,!0,e,s):ih(e,s);break;case"inside":sh("inside",t,n,e,s,i);break;case"outside":sh("outside",t,n,e,s,i)}}function sh(t,e,s,i,r,n){const{strokeWidth:o,__font:a}=i.__,h=r.getSameCanvas(!0);h.setStroke(s?void 0:e,2*o,i.__),h.font=a,s?rh(e,!0,i,h):ih(i,h),h.blendMode="outside"===t?"destination-out":"destination-in",th(i,h),h.blendMode="normal",i.__hasMirror||n.matrix?r.copyWorldByReset(h):r.copyWorldToInner(h,i.__world,i.__layout.renderBounds),h.recycle()}function ih(t,e){let s;const{rows:i,decorationY:r,decorationHeight:n}=t.__.__textDrawData;for(let t=0,o=i.length;t<o;t++)s=i[t],s.text?e.strokeText(s.text,s.x,s.y):s.data&&s.data.forEach((t=>{e.strokeText(t.char,t.x,s.y)})),r&&e.strokeRect(s.x,s.y+r,s.width,n)}function rh(t,e,s,i){let r;for(let n=0,o=t.length;n<o;n++)r=t[n],r.image&&$a(s,i,r,!1)||r.style&&(i.strokeStyle=r.style,r.blendMode?(i.saveBlendMode(r.blendMode),e?ih(s,i):i.stroke(),i.restoreBlendMode()):e?ih(s,i):i.stroke())}const{getSpread:nh,getOuterOf:oh,getByMove:ah,getIntersectData:hh}=X;const lh={x:.5,y:0},dh={x:.5,y:1};function ch(t,e,s){let i;for(let r=0,n=e.length;r<n;r++)i=e[r],t.addColorStop(i.offset,Wo.string(i.color,s))}const{set:uh,getAngle:_h,getDistance:ph}=R,{get:gh,rotateOfOuter:fh,scaleOfOuter:yh}=y,vh={x:.5,y:.5},mh={x:.5,y:1},wh={},xh={};const{set:Eh,getAngle:bh,getDistance:Bh}=R,{get:Ch,rotateOfOuter:Rh,scaleOfOuter:Th}=y,kh={x:.5,y:.5},Ph={x:.5,y:1},Lh={},Oh={};let Sh;function Dh(t,s,i){if("object"!=typeof s||!1===s.visible||0===s.opacity)return;const{boxBounds:r}=i.__layout;switch(s.type){case"solid":let{type:n,blendMode:o,color:a,opacity:h}=s;return{type:n,blendMode:o,style:Wo.string(a,h)};case"image":return function(t,e,s,i,r){const n={type:s.type},o=n.image=ki.get(s),a=(r||o.loading)&&{target:t,image:o,attrName:e,attrValue:s};return o.ready?(Va(t,e,o)&&ja(n,o,s,i),r&&(Ga(Ai.LOAD,a),Ga(Ai.LOADED,a))):o.error?r&&(t.forceUpdate("surface"),a.error=o.error,Ga(Ai.ERROR,a)):(r&&Ga(Ai.LOAD,a),n.loadId=o.load((()=>{t.destroyed||(Va(t,e,o)&&(ja(n,o,s,i),t.forceUpdate("surface")),Ga(Ai.LOADED,a))}),(e=>{t.forceUpdate("surface"),a.error=e,Ga(Ai.ERROR,a)}))),n}(i,t,s,r,!Sh||!Sh[s.url]);case"linear":return function(t,s){let{from:i,to:r,type:n,blendMode:o,opacity:a}=t;i||(i=lh),r||(r=dh);const h=e.canvas.createLinearGradient(s.x+i.x*s.width,s.y+i.y*s.height,s.x+r.x*s.width,s.y+r.y*s.height);ch(h,t.stops,a);const l={type:n,style:h};return o&&(l.blendMode=o),l}(s,r);case"radial":return function(t,s){let{from:i,to:r,type:n,opacity:o,blendMode:a,stretch:h}=t;i||(i=vh),r||(r=mh);const{x:l,y:d,width:c,height:u}=s;let _;uh(wh,l+i.x*c,d+i.y*u),uh(xh,l+r.x*c,d+r.y*u),(c!==u||h)&&(_=gh(),yh(_,wh,c/u*(h||1),1),fh(_,wh,_h(wh,xh)+90));const p=e.canvas.createRadialGradient(wh.x,wh.y,0,wh.x,wh.y,ph(wh,xh));ch(p,t.stops,o);const g={type:n,style:p,transform:_};return a&&(g.blendMode=a),g}(s,r);case"angular":return function(t,s){let{from:i,to:r,type:n,opacity:o,blendMode:a,stretch:h}=t;i||(i=kh),r||(r=Ph);const{x:l,y:d,width:c,height:u}=s;Eh(Lh,l+i.x*c,d+i.y*u),Eh(Oh,l+r.x*c,d+r.y*u);const _=Ch(),p=bh(Lh,Oh);e.conicGradientRotate90?(Th(_,Lh,c/u*(h||1),1),Rh(_,Lh,p+90)):(Th(_,Lh,1,c/u*(h||1)),Rh(_,Lh,p));const g=e.conicGradientSupport?e.canvas.createConicGradient(0,Lh.x,Lh.y):e.canvas.createRadialGradient(Lh.x,Lh.y,0,Lh.x,Lh.y,Bh(Lh,Oh));ch(g,t.stops,o);const f={type:n,style:g,transform:_};return a&&(f.blendMode=a),f}(s,r);default:return s.r?{type:"solid",style:Wo.string(s)}:void 0}}var Mh=Object.freeze({__proto__:null,compute:function(t,e){const s=[];let i,r=e.__.__input[t];r instanceof Array||(r=[r]),Sh=Ja(t,e.__);for(let n=0,o=r.length;n<o;n++)i=Dh(t,r[n],e),i&&s.push(i);e.__["_"+t]=s.length?s:void 0},drawTextStroke:ih,fill:function(t,e,s){s.fillStyle=t,e.__.__font?th(e,s):e.__.windingRule?s.fill(e.__.windingRule):s.fill()},fillText:th,fills:function(t,e,s){let i;const{windingRule:r,__font:n}=e.__;for(let o=0,a=t.length;o<a;o++)i=t[o],i.image&&$a(e,s,i,!n)||i.style&&(s.fillStyle=i.style,i.transform?(s.save(),s.transform(i.transform),i.blendMode&&(s.blendMode=i.blendMode),n?th(e,s):r?s.fill(r):s.fill(),s.restore()):i.blendMode?(s.saveBlendMode(i.blendMode),n?th(e,s):r?s.fill(r):s.fill(),s.restoreBlendMode()):n?th(e,s):r?s.fill(r):s.fill())},recycleImage:Ja,shape:function(t,e,s){const i=e.getSameCanvas();let r,n,o,a;const{__world:h}=t;let{scaleX:l,scaleY:d}=h;if(l<0&&(l=-l),d<0&&(d=-d),e.bounds.includes(h,s.matrix))s.matrix?(l*=s.matrix.a,d*=s.matrix.d,r=o=oh(h,s.matrix)):r=o=h,a=i;else{const{renderShapeSpread:i}=t.__layout,c=hh(i?nh(e.bounds,i*l,i*d):e.bounds,h,s.matrix);n=e.bounds.getFitMatrix(c),n.a<1&&(a=e.getSameCanvas(),t.__renderShape(a,s),l*=n.a,d*=n.d),o=oh(h,n),r=ah(o,-n.e,-n.f),s.matrix&&n.multiply(s.matrix),s=Object.assign(Object.assign({},s),{matrix:n})}return t.__renderShape(i,s),{canvas:i,matrix:n,bounds:r,worldCanvas:a,shapeBounds:o,scaleX:l,scaleY:d}},stroke:function(t,e,s,i){const r=e.__,{strokeWidth:n,strokeAlign:o,__font:a}=r;if(n)if(a)eh(t,e,s,i);else switch(o){case"center":s.setStroke(t,n,r),s.stroke();break;case"inside":s.save(),s.setStroke(t,2*n,r),r.windingRule?s.clip(r.windingRule):s.clip(),s.stroke(),s.restore();break;case"outside":const o=s.getSameCanvas(!0);o.setStroke(t,2*n,e.__),e.__drawRenderPath(o),o.stroke(),r.windingRule?o.clip(r.windingRule):o.clip(),o.clearWorld(e.__layout.renderBounds),e.__hasMirror||i.matrix?s.copyWorldByReset(o):s.copyWorldToInner(o,e.__world,e.__layout.renderBounds),o.recycle()}},strokeText:eh,strokes:function(t,e,s,i){const r=e.__,{strokeWidth:n,strokeAlign:o,__font:a}=r;if(n)if(a)eh(t,e,s,i);else switch(o){case"center":s.setStroke(void 0,n,r),rh(t,!1,e,s);break;case"inside":s.save(),s.setStroke(void 0,2*n,r),r.windingRule?s.clip(r.windingRule):s.clip(),rh(t,!1,e,s),s.restore();break;case"outside":const{renderBounds:o}=e.__layout,a=s.getSameCanvas(!0);e.__drawRenderPath(a),a.setStroke(void 0,2*n,e.__),rh(t,!1,e,a),r.windingRule?a.clip(r.windingRule):a.clip(),a.clearWorld(o),e.__hasMirror||i.matrix?s.copyWorldByReset(a):s.copyWorldToInner(a,e.__world,o),a.recycle()}}});const{copy:Ih,toOffsetOutBounds:Ah}=X,Wh={},Uh={};function Nh(t,s,i,r){const{bounds:n,shapeBounds:o}=r;if(e.fullImageShadow){if(Ih(Wh,t.bounds),Wh.x+=s.x-o.x,Wh.y+=s.y-o.y,i){const{matrix:t}=r;Wh.x-=(n.x+(t?t.e:0)+n.width/2)*(i-1),Wh.y-=(n.y+(t?t.f:0)+n.height/2)*(i-1),Wh.width*=i,Wh.height*=i}t.copyWorld(r.canvas,t.bounds,Wh)}else i&&(Ih(Wh,s),Wh.x-=s.width/2*(i-1),Wh.y-=s.height/2*(i-1),Wh.width*=i,Wh.height*=i),t.copyWorld(r.canvas,o,i?Wh:s)}const{toOffsetOutBounds:Fh}=X,zh={};var Yh=Object.freeze({__proto__:null,blur:function(t,e,s){const{blur:i}=t.__;s.setWorldBlur(i*t.__world.a),s.copyWorldToInner(e,t.__world,t.__layout.renderBounds),s.filter="none"},innerShadow:function(t,e,s,i){let r,n;const{__world:o,__layout:a}=t,{innerShadow:h}=t.__,{worldCanvas:l,bounds:d,shapeBounds:c,scaleX:u,scaleY:_}=s,p=e.getSameCanvas(),g=h.length-1;Fh(d,zh),h.forEach(((h,f)=>{p.save(),p.setWorldShadow(zh.offsetX+h.x*u,zh.offsetY+h.y*_,h.blur*u),n=h.spread?1-2*h.spread/(a.boxBounds.width+2*(a.strokeBoxSpread||0)):0,Nh(p,zh,n,s),p.restore(),l?(p.copyWorld(p,d,o,"copy"),p.copyWorld(l,o,o,"source-out"),r=o):(p.copyWorld(s.canvas,c,d,"source-out"),r=d),p.fillWorld(r,h.color,"source-in"),t.__hasMirror||i.matrix?e.copyWorldByReset(p,r,o,h.blendMode):e.copyWorldToInner(p,r,a.renderBounds,h.blendMode),g&&f<g&&p.clear()})),p.recycle()},shadow:function(t,e,s,i){let r,n;const{__world:o,__layout:a}=t,{shadow:h}=t.__,{worldCanvas:l,bounds:d,shapeBounds:c,scaleX:u,scaleY:_}=s,p=e.getSameCanvas(),g=h.length-1;Ah(d,Uh),h.forEach(((h,f)=>{p.setWorldShadow(Uh.offsetX+h.x*u,Uh.offsetY+h.y*_,h.blur*u,h.color),n=h.spread?1+2*h.spread/(a.boxBounds.width+2*(a.strokeBoxSpread||0)):0,Nh(p,Uh,n,s),r=d,h.box&&(p.restore(),p.save(),l&&(p.copyWorld(p,d,o,"copy"),r=o),l?p.copyWorld(l,o,o,"destination-out"):p.copyWorld(s.canvas,c,d,"destination-out")),t.__hasMirror||i.matrix?e.copyWorldByReset(p,r,o,h.blendMode):e.copyWorldToInner(p,r,a.renderBounds,h.blendMode),g&&f<g&&p.clear()})),p.recycle()}});const Xh=">)]}%!?,.:;'\"》）」〉』〗】〕｝┐＞’”！？，、。：；‰",Hh=Xh+"_#~&*+\\=|≮≯≈≠＝…",jh=new RegExp([[19968,40959],[13312,19903],[131072,173791],[173824,177983],[177984,178207],[178208,183983],[183984,191471],[196608,201551],[201552,205743],[11904,12031],[12032,12255],[12272,12287],[12288,12351],[12736,12783],[12800,13055],[13056,13311],[63744,64255],[65072,65103],[127488,127743],[194560,195103]].map((([t,e])=>`[\\u${t.toString(16)}-\\u${e.toString(16)}]`)).join("|"));function Vh(t){const e={};return t.split("").forEach((t=>e[t]=!0)),e}const Gh=Vh("ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz"),Kh=Vh("{[(<'\"《（「〈『〖【〔｛┌＜‘“＝¥￥＄€£￡¢￠"),qh=Vh(Xh),Zh=Vh(Hh),Qh=Vh("- —／～｜┆·");var $h;!function(t){t[t.Letter=0]="Letter",t[t.Single=1]="Single",t[t.Before=2]="Before",t[t.After=3]="After",t[t.Symbol=4]="Symbol",t[t.Break=5]="Break"}($h||($h={}));const{Letter:Jh,Single:tl,Before:el,After:sl,Symbol:il,Break:rl}=$h;function nl(t){return Gh[t]?Jh:Qh[t]?rl:Kh[t]?el:qh[t]?sl:Zh[t]?il:jh.test(t)?tl:Jh}const ol={trimRight(t){const{words:e}=t;let s,i=0,r=e.length;for(let n=r-1;n>-1&&(s=e[n].data[0]," "===s.char);n--)i++,t.width-=s.width;i&&e.splice(r-i,i)}};function al(t,e,s){switch(e){case"title":return s?t.toUpperCase():t;case"upper":return t.toUpperCase();case"lower":return t.toLowerCase();default:return t}}const{trimRight:hl}=ol,{Letter:ll,Single:dl,Before:cl,After:ul,Symbol:_l,Break:pl}=$h;let gl,fl,yl,vl,ml,wl,xl,El,bl,Bl,Cl,Rl,Tl,kl,Pl,Ll,Ol=[];function Sl(t,e){bl&&!El&&(El=bl),gl.data.push({char:t,width:e}),yl+=e}function Dl(){vl+=yl,gl.width=yl,fl.words.push(gl),gl={data:[]},yl=0}function Ml(){kl&&(Pl.paraNumber++,fl.paraStart=!0,kl=!1),bl&&(fl.startCharSize=El,fl.endCharSize=bl,El=0),fl.width=vl,Ll.width&&hl(fl),Ol.push(fl),fl={words:[]},vl=0}const Il={getDrawData(t,s){"string"!=typeof t&&(t=String(t));let i=0,r=0,o=s.__getInput("width")||0,a=s.__getInput("height")||0;const{textDecoration:h,textOverflow:l,__font:d,padding:c}=s;if(c){const[t,e,s,h]=n.fourNumber(c);o&&(i=h,o-=e+h),a&&(r=t,a-=t+s)}const u={bounds:{x:i,y:r,width:o,height:a},rows:[],paraNumber:0,font:e.canvas.font=d};return function(t,s,i){Pl=t,Ol=t.rows,Ll=t.bounds;const{__letterSpacing:r,paraIndent:n,textCase:o}=i,{canvas:a}=e,{width:h,height:l}=Ll;if(h||l||r||"none"!==o){kl=!0,Cl=null,El=xl=bl=yl=vl=0,gl={data:[]},fl={words:[]};for(let t=0,e=s.length;t<e;t++)wl=s[t],"\n"===wl?(yl&&Dl(),fl.paraEnd=!0,Ml(),kl=!0):(Bl=nl(wl),Bl===ll&&"none"!==o&&(wl=al(wl,o,!yl)),xl=a.measureText(wl).width,r&&(r<0&&(bl=xl),xl+=r),Rl=Bl===dl&&(Cl===dl||Cl===ll)||Cl===dl&&Bl!==ul,Tl=!(Bl!==cl&&Bl!==dl||Cl!==_l&&Cl!==ul),ml=kl&&n?h-n:h,h&&vl+yl+xl>ml&&(Tl||(Tl=Bl===ll&&Cl==ul),Rl||Tl||Bl===pl||Bl===cl||Bl===dl||yl+xl>ml?(yl&&Dl(),Ml()):Ml())," "===wl&&!0!==kl&&vl+yl===0||(Bl===pl?(" "===wl&&yl&&Dl(),Sl(wl,xl),Dl()):Rl||Tl?(yl&&Dl(),Sl(wl,xl)):Sl(wl,xl)),Cl=Bl);yl&&Dl(),vl&&Ml(),Ol.length>0&&(Ol[Ol.length-1].paraEnd=!0)}else s.split("\n").forEach((t=>{Pl.paraNumber++,Ol.push({x:n||0,text:t,width:a.measureText(t).width,paraStart:!0})}))}(u,t,s),function(t,e){const{rows:s,bounds:i}=t,{__lineHeight:r,__baseLine:n,__letterSpacing:o,textAlign:a,verticalAlign:h,paraSpacing:l,textOverflow:d}=e;let c,u,_,{x:p,y:g,width:f,height:y}=i,v=r*s.length+(l?l*(t.paraNumber-1):0),m=n;if("show"!==d&&v>y)v=Math.max(y,r),t.overflow=s.length;else switch(h){case"middle":g+=(y-v)/2;break;case"bottom":g+=y-v}m+=g;for(let n=0,h=s.length;n<h;n++){switch(c=s[n],c.x=p,a){case"center":c.x+=(f-c.width)/2;break;case"right":c.x+=f-c.width}c.paraStart&&l&&n>0&&(m+=l),c.y=m,m+=r,t.overflow>n&&m>v&&(c.isOverflow=!0,t.overflow=n+1),u=c.x,_=c.width,o<0&&(c.width<0?(_=-c.width+e.fontSize+o,u-=_,_+=e.fontSize):_-=o),u<i.x&&(i.x=u),_>i.width&&(i.width=_)}i.y=g,i.height=v}(u,s),function(t,e,s,i){const{rows:r}=t,{textAlign:n,paraIndent:o,letterSpacing:a}=e;let h,l,d,c,u;r.forEach((t=>{t.words&&(d=o&&t.paraStart?o:0,l=s&&"justify"===n&&t.words.length>1?(s-t.width-d)/(t.words.length-1):0,c=a||t.isOverflow?0:l>.01?1:2,2===c?(t.text="",t.x+=d,t.words.forEach((e=>{e.data.forEach((e=>{t.text+=e.char}))}))):(t.x+=d,h=t.x,t.data=[],t.words.forEach((e=>{1===c?(u={char:"",x:h},h=function(t,e,s){return t.forEach((t=>{s.char+=t.char,e+=t.width})),e}(e.data,h,u)," "!==u.char&&t.data.push(u)):h=function(t,e,s){return t.forEach((t=>{" "!==t.char&&(t.x=e,s.push(t)),e+=t.width})),e}(e.data,h,t.data),!t.paraEnd&&l&&(h+=l,t.width+=l)}))),t.words=null)}))}(u,s,o),u.overflow&&function(t,s){const{rows:i,overflow:r}=t;if(i.splice(r),"hide"!==s){"ellipsis"===s&&(s="...");const n=e.canvas.measureText(s).width,o=i[r-1];let a,h,l=o.data.length-1;const{x:d,width:c}=t.bounds,u=d+c-n;for(let t=l;t>-1&&(a=o.data[t],h=a.x+a.width,!(t===l&&h<u));t--){if(h<u&&" "!==a.char){o.data.splice(t+1),o.width-=a.width;break}o.width-=a.width}o.width+=n,o.data.push({char:s,x:h})}}(u,l),"none"!==h&&function(t,e){const{fontSize:s}=e;switch(t.decorationHeight=s/11,e.textDecoration){case"under":t.decorationY=.15*s;break;case"delete":t.decorationY=.35*-s}}(u,s),u}},Al={string(t,e){if("string"==typeof t)return t;let s=void 0===t.a?1:t.a;e&&(s*=e);const i=t.r+","+t.g+","+t.b;return 1===s?"rgb("+i+")":"rgba("+i+","+s+")"}},Wl={export(t,e,s){return function(t){Ul||(Ul=new Ti);return new Promise((e=>{Ul.add((()=>ft(this,void 0,void 0,(function*(){return yield t(e)}))),{parallel:!1})}))}((i=>new Promise((r=>{const{leafer:n}=t;n?n.waitViewCompleted((()=>ft(this,void 0,void 0,(function*(){let t,o,a,{canvas:h}=n,{unreal:l}=h;switch(l&&(h=h.getSameCanvas(),h.backgroundColor=n.config.fill,n.__render(h,{})),typeof s){case"object":s.quality&&(t=s.quality),s.blob&&(o=!0);break;case"number":t=s;break;case"boolean":o=s}a=e.includes(".")?yield h.saveAs(e,t):o?yield h.toBlob(e,t):yield h.toDataURL(e,t),i({data:a}),r(),l&&h.recycle()})))):(i({data:!1}),r())}))))}};let Ul;return Object.assign(Io,Mh),Object.assign(Mo,Yh),Object.assign(Ao,Il),Object.assign(Wo,Al),Object.assign(Uo,Wl),ko(),t.Animate={},t.AnimateEvent=zi,t.AutoBounds=K,t.BezierHelper=te,t.Bounds=G,t.BoundsHelper=X,t.BranchHelper=Fr,t.BranchRender=Ln,t.CanvasManager=at,t.ChildEvent=Mi,t.ColorConvert=Wo,t.Creator=s,t.Cursor=hn,t.DataHelper=ct,t.Debug=Z,t.Effect=Mo,t.EllipseHelper=le,t.Event=Di,t.EventCreator=nt,t.Export=Uo,t.FileHelper=pt,t.HitCanvasManager=dt,t.ImageEvent=Ai,t.ImageManager=ki,t.IncrementId=i,t.Interaction=Co,t.InteractionBase=an,t.InteractionHelper=Hr,t.Keyboard=ji,t.LayoutEvent=Fi,t.Layouter=co,t.LeafBounds=En,t.LeafBoundsHelper=Nr,t.LeafData=_t,t.LeafDataProxy=pn,t.LeafEventer=un,t.LeafHelper=Mr,t.LeafHit=Tn,t.LeafLayout=dn,t.LeafLevelList=lt,t.LeafList=ht,t.LeafMask=Pn,t.LeafMatrix=mn,t.LeafRender=kn,t.LeaferCanvas=vo,t.LeaferCanvasBase=Rt,t.LeaferEvent=Xi,t.LeaferImage=Si,t.LeaferTypeCreator=So,t.MathHelper=n,t.Matrix=P,t.MatrixHelper=y,t.MultiTouchHelper=en,t.NeedConvertToCanvasCommandMap=Ot,t.OneRadian=o,t.PI2=a,t.PI_2=h,t.Paint=Io,t.PathBounds=xi,t.PathCommandDataHelper=cs,t.PathCommandMap=Pt,t.PathConvert=Ge,t.PathCorner=Ei,t.PathCreator=ks,t.PathDrawer=Xs,t.PathHelper=Tt,t.PathNumberCommandLengthMap=It,t.PathNumberCommandMap=Mt,t.Platform=e,t.PluginManager=Zn,t.Point=k,t.PointHelper=R,t.PointerButton=Vi,t.PropertyEvent=Ii,t.RectHelper=At,t.RectRender=ta,t.RenderEvent=Yi,t.Renderer=_o,t.ResizeEvent=Wi,t.Run=J,t.Selector=fo,t.StringNumberMap=q,t.TaskItem=Ri,t.TaskProcessor=Ti,t.TextConvert=Ao,t.TransformEvent=Ui,t.TwoPointBounds=class{constructor(t,e){L.setPoint(this,t,e)}addPoint(t,e){L.addPoint(this,t,e)}addBounds(t,e,s,i){L.addBounds(this,t,e,s,i)}add(t){L.add(this,t)}},t.TwoPointBoundsHelper=L,t.UIBounds=Qo,t.UICreator=st,t.UIEvent=Gi,t.UIHit=$o,t.UIRender=Jo,t.WaitHelper=Xr,t.WatchEvent=Ni,t.Watcher=Qn,t.affectRenderBoundsType=nr,t.affectStrokeBoundsType=ir,t.aliasType=function(t){return(e,s)=>{Ki(e,s,{get(){return this.__getAttr(t)},set(e){this.__setAttr(t,e)}})}},t.boundsType=er,t.canvasPatch=Bi,t.canvasSizeAttrs=Ct,t.cursorType=ur,t.dataProcessor=_r,t.dataType=Qi,t.defineDataProcessor=pr,t.defineKey=Ki,t.defineLeafAttr=Zi,t.effectType=qo,t.eraserType=dr,t.getDescriptor=qi,t.hitType=cr,t.layoutProcessor=function(t){return(e,s)=>{Ki(e,"__LayoutProcessor",{get:()=>t})}},t.maskType=lr,t.opacityType=ar,t.pathType=sr,t.positionType=$i,t.registerUI=Er,t.registerUIEvent=br,t.resizeType=Zo,t.rewrite=vr,t.rewriteAble=mr,t.rotationType=tr,t.scaleType=Ji,t.setDefaultValue=function(t,e,s){pr(t.prototype,e,s)},t.sortType=hr,t.strokeType=rr,t.surfaceType=or,t.useCanvas=ko,t.useModule=xr,t.usePlugin=function(t,e){const s={},{power:i,list:r}=Zn;if(i||qn.error("need add PluginManager.power = LeaferUI"),r.includes(t))qn.warn("repeat run",t.name);else{r.push(t),t.import?t.import.forEach((t=>{i[t]?s[t]=i[t]:qn.error(t+" non-existent")})):qn.warn("no import");try{t.run(s,e)}catch(t){qn.error(t)}}},t}({});
