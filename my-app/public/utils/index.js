function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(t,e){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).json2image=e()}(this,(function(){"use strict";return Object.assign||(Object.assign=function(t){null==t&&(t={}),t=Object(t);for(var e=1;e<arguments.length;e++){var n=arguments[e];if(null!=n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}),function(t,e,n,i){var o=i||document.createElement("canvas"),r=Object.assign({},{width:750,height:200,output:"jpeg",quality:.6,lineHeight:1.5,color:"#263238",textAlign:"left",fontSize:14,fontFamily:'"PingFang SC",tahoma,arial,"helvetica neue","hiragino sans gb","microsoft yahei",sans-serif',autoHeight:!1,ratio:2,bgColor:"rgba(255, 255, 255, 0)",elements:[]},t),a=o.getContext("2d"),f=r.ratio,u=function(t){return t*f},l=0,c=0,h=0,g=0,s=0;r.width*=f,r.height*=f,o.width=r.width,o.height=r.height,a.fillStyle=r.bgColor,a.fillRect(0,0,r.width,r.height),a.textBaseline="middle";var d=function(t){return"center"===t},m=function(t){return"right"===t||"end"===t},y=function(t){return a.measureText(t).width},p=function(t,e,n){var i=t+"px "+e;return n&&(i=n+" "+i),i},v=function(t,e,n,i,o,f){var u=function(t,e,n){for(var i=t.length,o="",r=[],a=0;a<i;a++){var f="\n"===t[a];y(o)<e&&!f?o+=t[a]:(r.push(o),o=f?"":t[a])}return o&&r.push(o),r}(t,i),c=(u.length+1)*f;r.autoHeight&&c>o&&(l+=o-c),u.forEach((function(t,i){return a.fillText(t,e,n+i*f)}))},b=function(){++c===g&&function(){if(r.output){var t=r.width,n=r.height;r.autoHeight&&(n+=l);var i=a.getImageData(0,0,t,n);o.width=t,o.height=n,a.clearRect(0,0,t,r.height),a.putImageData(i,0,0);var f=o.toDataURL("image/"+r.output,r.quality);setTimeout((function(){e&&e(f)}),0)}else e&&e(null)}()},w=function(t){return"undefined"!=typeof navigator&&/Android/.test(navigator.userAgent)?t+6:t},x=function(t){var e=u(t.x||0),n=u(t.width||0),i=u(t.y||0),o=u(t.height||0);0!==l&&(i+=l);var f=t.imgObj,c=t.textAlign;if(a.save(),t.autoHeight){var h=f.height*(n/f.width);r.autoHeight&&(l+=h-o),o=h}d(c)?function(t,e,n,i,o){var f=e+(r.width-i)/2;a.drawImage(t,f,n,i,o)}(f,e,i,n,o):m(c)?function(t,e,n,i,o){var f=e+r.width-i;a.drawImage(t,f,n,i,o)}(f,e,i,n,o):a.drawImage(f,e,i,n,o),a.restore(),t.radius>0&&function(t,e,n,i,o){a.save(),a.beginPath(),a.moveTo(t+o,e),a.arcTo(t+n,e,t+n,e+o,o),a.arcTo(t+n,e+i,t+n-o,e+i,o),a.arcTo(t,e+i,t,e+i-o,o),a.arcTo(t,e,t+o,e,o),a.closePath(),a.clip()}(e,i,n,o,t.radius),b()},T=function(t){var e=t.fontfamily||r.fontFamily,n=u(t.fontSize||r.fontSize),i=t.textAlign||r.textAlign,o=u(t.width)||r.width,f=u(t.height||0),c=t.color||r.color,h=t.lineHeight||r.lineHeight,g=p(n,e,t.bold),s=t.content,x=u(t.x||0),T=u(t.y||0),S=h*n;switch(i){case"center":x+=o/2||r.width/2;break;case"right":case"end":x+=o||r.width}if(0!==l&&(T+=l),t.maxWidth&&(s=function(t,e){for(var n=t.length,i=0;i<n;i++)if(y(t.substr(0,i+1))>e)return"".concat(t.substr(0,i),"...");return t}(s,t.maxWidth)),T+=S/2,a.beginPath(),a.fillStyle=c,a.font=g,a.textAlign=i,"string"!=typeof s)!function(t,e,n,i,o,f,c,h,g){if(t&&t.length){var s=e,v=n,b=0,x=[],T=a.textAlign,S=[],j=0;t.forEach((function(t){var e=t.content,n=u(t.fontSize)||c,d=t.fontfamily||h,m=p(n,d,t.bold);a.font=m;for(var w=0;w<e.length;w++){var T="\n"===e[w],H=y(e[w]);if((b+=H)>i&&g||T){v+=o,r.autoHeight&&(l+=o);var O=T?0:H;x.push(b-O),b=O,j+=1}S[j]||(S[j]=[]),S[j].push({content:e[w],x:s+b-H,y:v,color:t.color||f,font:m})}})),b&&x.push(b),a.textAlign="left",S.forEach((function(t,e){var n=x[e];t.forEach((function(t){a.fillStyle=t.color,a.font=t.font;var e=t.x;d(T)&&(e-=n/2),m(T)&&(e-=n),a.fillText(t.content,e,w(t.y))}))}))}}(s,x,w(T),o,S,c,n,e,t.autoHeight);else if(t.autoHeight)v(s,x,T,o,T+f,S);else if(t.rotate){var j=r.width-(t.width||0);a.translate(j/2,T),a.rotate(Math.PI/180*t.rotate),a.fillText(s,0,0),a.fill(),a.setTransform(1,0,0,1,0,0)}else a.fillText(s,x,T),a.fill();a.closePath(),b()},S=r.elements;if(S&&S.length){g=S.length;var j=S.map((function(t){if("img"===t.type)return s++,t}));!function(t,e){0!==s?t.forEach((function(t){if(t){var i=new Image;i.crossOrigin="anonymous",i.onload=function(){t.imgObj=i,++h===s&&e&&e()},i.onerror=function(t){return n&&n(t),!1},i.src=t.content}})):e&&e()}(j,(function(){S.forEach((function(t,e){"img"===t.type?(t.imgObj=j[e].imgObj,x(t)):T(t)}))}))}}}));
